
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Visualization &#8212; Tree Sequence Tutorials</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'viz';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Working with Metadata" href="metadata.html" />
    <link rel="prev" title="Simplification" href="simplification.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/tskit_logo.svg" class="logo__image only-light" alt="Tree Sequence Tutorials - Home"/>
    <script>document.write(`<img src="_static/tskit_logo.svg" class="logo__image only-dark" alt="Tree Sequence Tutorials - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="what_is.html">What is a tree sequence?</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tree sequence basics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="terminology_and_concepts.html">Terminology &amp; concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started with <strong class="program">tskit</strong></a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Statistics and Analysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="analysing_tree_sequences.html"><em>Analysing tree sequences</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="analysing_trees.html">Analysing trees</a></li>
<li class="toctree-l1"><a class="reference internal" href="incremental_algorithms.html"><em>Incremental algorithms</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="counting_topologies.html">Counting topologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="parallelization.html"><em>Parallelization</em></a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Further tskit tutorials</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="tables_and_editing.html">Tables and editing</a></li>
<li class="toctree-l1"><a class="reference internal" href="simplification.html"><em>Simplification</em></a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">Working with Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="args.html">ARGs as tree sequences</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Simulation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="simulation_overview.html">Tree sequences and simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="no_mutations.html">Do you really need mutations?</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="advanced_msprime.html">Advanced <strong class="program">msprime</strong> topics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="demography.html">Demography</a></li>
<li class="toctree-l2"><a class="reference internal" href="bottlenecks.html">Instantaneous Bottlenecks</a></li>
<li class="toctree-l2"><a class="reference internal" href="introgression.html">Introgression</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="completing_forward_sims.html">Completing forwards simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="forward_sims.html">Building a forward simulator</a></li>
<li class="toctree-l1"><a class="reference internal" href="more_forward_sims.html"><em>Advanced forward simulations</em></a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Other languages</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="tskitr.html">Tskit and R</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="tutorial_development.html"><em>Developing new tutorials</em></a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tskit for ...</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="popgen.html"><code class="docutils literal notranslate"><span class="pre">Tskit</span></code> for population genetics</a></li>
<li class="toctree-l1"><a class="reference internal" href="phylogen.html"><code class="docutils literal notranslate"><span class="pre">Tskit</span></code> for phylogenetics</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/viz.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Visualization</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#text-format">Text format</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#svg-format">SVG format</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#axes-and-scales">Axes and scales</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#larger-tree-sequences">Larger tree sequences</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-mutations">Plotting mutations</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#which-mutations-are-shown">Which mutations are shown?</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#labelling">Labelling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#styling">Styling</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#available-css-classes">Available css classes</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#within-the-plotting-area">Within the plotting area</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#outside-the-plotting-area">Outside the plotting area</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id-based-classes">ID-based classes</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#css-selector-quick-reference">CSS selector quick reference</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#styling-graphical-elements">Styling graphical elements</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-effects">Dynamic effects</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#transforming-and-masking-elements">Transforming and masking elements</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#styling-and-svg-structure">Styling and SVG structure</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#styling-subtrees">Styling subtrees</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#restricting-styling">Restricting styling</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#more-about-styling">More about styling</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#converting-and-editing-svg">Converting and editing SVG</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#converting">Converting</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#editing-the-svg">Editing the SVG</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#examples">Examples</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#text-examples">Text examples</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#tree-orientation">Tree orientation</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#svg-examples">SVG examples</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#a-standard-ts-plot">A standard ts plot</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#highlighted-mutations">Highlighted mutations</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#leaf-sample-isolated-nodes">Leaf, sample &amp; isolated nodes</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#a-fancy-formatted-plot">A fancy formatted plot</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ticks-labels-and-gridlines">Ticks, labels, and gridlines</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#simplifying-larger-plots">Simplifying larger plots</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#d-effects">3D effects</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#animation">Animation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#other-visualizations">Other visualizations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#graph-representations">Graph representations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#demographic-processes">Demographic processes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#geography">Geography</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="visualization">
<span id="sec-tskit-viz"></span><h1>Visualization<a class="headerlink" href="#visualization" title="Link to this heading">#</a></h1>
<p><strong>Yan Wong</strong></p>
<p>It is often helpful to visualize a single tree — or multiple trees along a tree
sequence — together with sites and mutations. <a class="reference external" href="https://tskit.dev/tskit/docs/stable/introduction.html#sec-introduction" title="(in Project name not set)"><span class="xref std std-ref">Tskit</span></a>
provides methods to do this, outputting either plain ascii or unicode text, or the more
flexible <a class="reference external" href="https://www.w3.org/TR/SVG11/">Scalable Vector Graphics</a> (SVG) format.
The first two sections of this tutorial give details of these methods, using a few 50kb
tree sequences generated by <a class="reference external" href="https://tskit.dev/msprime/docs/stable/intro.html#sec-intro" title="(in Project name not set)"><span class="xref std std-ref">msprime</span></a> as examples: one in which
selection has occurred, and others which involve subdivision into 3 populations
(labelled <em>A</em>, <em>B</em>, and <em>C</em>).</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">tskit</span>
<span class="c1"># To see how these tree sequences were made, inspect the removed cell at the top of this</span>
<span class="c1"># notebook, visible in e.g. the `.md` (markdown) version downloadable from the menubar</span>
<span class="n">ts_tiny</span> <span class="o">=</span> <span class="n">tskit</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;data/viz_ts_tiny.trees&quot;</span><span class="p">)</span>
<span class="n">ts_small</span> <span class="o">=</span> <span class="n">tskit</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;data/viz_ts_small.trees&quot;</span><span class="p">)</span>
<span class="n">ts_full</span> <span class="o">=</span> <span class="n">tskit</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;data/viz_ts_full.trees&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>If you just want a quick look at visualization possibilities, you might want to skip
the explanations and just browse some <a class="reference internal" href="#sec-tskit-viz-examples"><span class="std std-ref">Examples</span></a>, which contain fully
reproduceable code.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This tutorial is primarily focussed on showing a tree sequence as a set of marginal
trees along a genome. The section titled <a class="reference internal" href="#sec-tskit-viz-other"><span class="std std-ref">Other visualizations</span></a>
provides examples of other representations of tree sequences, or the processes that
can create them.</p>
</div>
<section id="text-format">
<h2>Text format<a class="headerlink" href="#text-format" title="Link to this heading">#</a></h2>
<p>The <a class="reference external" href="https://tskit.dev/tskit/docs/stable/python-api.html#tskit.TreeSequence.draw_text" title="(in Project name not set)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TreeSequence.draw_text()</span></code></a> and
<a class="reference external" href="https://tskit.dev/tskit/docs/stable/python-api.html#tskit.Tree.draw_text" title="(in Project name not set)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Tree.draw_text()</span></code></a> methods provide
a quick way to print out a tree sequence, or an individual tree within it. They are
primarily useful for looking at topologies in small datasets (e.g. fewer than 20 sampled
genomes), and do not display mutations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print a tree sequence</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ts_tiny</span><span class="o">.</span><span class="n">draw_text</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The first tree in the tree sequence above, but replacing some node ids with names:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ts_tiny</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">draw_text</span><span class="p">(</span>
    <span class="c1"># An example of how to change or omit node labels: unspecified nodes are omitted</span>
    <span class="c1"># The same convention applies to SVG graphics</span>
    <span class="n">node_labels</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;Alice&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;Bob&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="s2">&quot;Chris&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;Dora&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span> <span class="s2">&quot;MRCA&quot;</span><span class="p">}</span>
<span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>11428.48┊         ┊         ┊         ┊         ┊   13    ┊         ┊         ┊         ┊  
        ┊         ┊         ┊         ┊         ┊  ┏━┻━┓  ┊         ┊         ┊         ┊  
11144.74┊         ┊         ┊         ┊         ┊  ┃   ┃  ┊   12    ┊         ┊         ┊  
        ┊         ┊         ┊         ┊         ┊  ┃   ┃  ┊  ┏━┻━┓  ┊         ┊         ┊  
9753.69 ┊         ┊         ┊         ┊         ┊  ┃   ┃  ┊  ┃   ┃  ┊   11    ┊         ┊  
        ┊         ┊         ┊         ┊         ┊  ┃   ┃  ┊  ┃   ┃  ┊  ┏━┻━┓  ┊         ┊  
6204.42 ┊         ┊         ┊         ┊   10    ┊  ┃   ┃  ┊  ┃   ┃  ┊  ┃   ┃  ┊         ┊  
        ┊         ┊         ┊         ┊  ┏━┻━┓  ┊  ┃   ┃  ┊  ┃   ┃  ┊  ┃   ┃  ┊         ┊  
3893.05 ┊         ┊         ┊         ┊  ┃   ┃  ┊  ┃   ┃  ┊  ┃   ┃  ┊  ┃   ┃  ┊    9    ┊  
        ┊         ┊         ┊         ┊  ┃   ┃  ┊  ┃   ┃  ┊  ┃   ┃  ┊  ┃   ┃  ┊  ┏━┻━┓  ┊  
3378.92 ┊         ┊    8    ┊    8    ┊  ┃   ┃  ┊  ┃   ┃  ┊  ┃   ┃  ┊  ┃   ┃  ┊  ┃   ┃  ┊  
        ┊         ┊  ┏━┻━┓  ┊  ┏━┻━┓  ┊  ┃   ┃  ┊  ┃   ┃  ┊  ┃   ┃  ┊  ┃   ┃  ┊  ┃   ┃  ┊  
2076.43 ┊         ┊  ┃   ┃  ┊  7   ┃  ┊  7   ┃  ┊  7   ┃  ┊  7   ┃  ┊  7   ┃  ┊  7   ┃  ┊  
        ┊         ┊  ┃   ┃  ┊ ┏┻┓  ┃  ┊ ┏┻┓  ┃  ┊ ┏┻┓  ┃  ┊ ┏┻┓  ┃  ┊ ┏┻┓  ┃  ┊ ┏┻┓  ┃  ┊  
1941.72 ┊   6     ┊  6   ┃  ┊ ┃ ┃  ┃  ┊ ┃ ┃  ┃  ┊ ┃ ┃  ┃  ┊ ┃ ┃  ┃  ┊ ┃ ┃  ┃  ┊ ┃ ┃  ┃  ┊  
        ┊ ┏━┻━┓   ┊ ┏┻┓  ┃  ┊ ┃ ┃  ┃  ┊ ┃ ┃  ┃  ┊ ┃ ┃  ┃  ┊ ┃ ┃  ┃  ┊ ┃ ┃  ┃  ┊ ┃ ┃  ┃  ┊  
1439.14 ┊ ┃   5   ┊ ┃ ┃  ┃  ┊ ┃ ┃  ┃  ┊ ┃ ┃  ┃  ┊ ┃ ┃  ┃  ┊ ┃ ┃  ┃  ┊ ┃ ┃  ┃  ┊ ┃ ┃  ┃  ┊  
        ┊ ┃ ┏━┻┓  ┊ ┃ ┃  ┃  ┊ ┃ ┃  ┃  ┊ ┃ ┃  ┃  ┊ ┃ ┃  ┃  ┊ ┃ ┃  ┃  ┊ ┃ ┃  ┃  ┊ ┃ ┃  ┃  ┊  
33.99   ┊ ┃ ┃  4  ┊ ┃ ┃  4  ┊ ┃ ┃  4  ┊ ┃ ┃  4  ┊ ┃ ┃  4  ┊ ┃ ┃  4  ┊ ┃ ┃  4  ┊ ┃ ┃  4  ┊  
        ┊ ┃ ┃ ┏┻┓ ┊ ┃ ┃ ┏┻┓ ┊ ┃ ┃ ┏┻┓ ┊ ┃ ┃ ┏┻┓ ┊ ┃ ┃ ┏┻┓ ┊ ┃ ┃ ┏┻┓ ┊ ┃ ┃ ┏┻┓ ┊ ┃ ┃ ┏┻┓ ┊  
0.00    ┊ 0 1 2 3 ┊ 0 1 2 3 ┊ 0 1 2 3 ┊ 0 1 2 3 ┊ 0 1 2 3 ┊ 0 1 2 3 ┊ 0 1 2 3 ┊ 0 1 2 3 ┊  
        0       9855      13901     21285     23424     25213     30463     46237     50000

The first tree in the tree sequence above, but replacing some node ids with names:
    MRCA            
  ┏━━━┻━━━━┓        
  ┃        ┃        
  ┃    ┏━━━┻━━━┓    
  ┃    ┃       ┃    
  ┃    ┃    ┏━━┻━━┓ 
Alice Bob Chris Dora
</pre></div>
</div>
</div>
</div>
</section>
<section id="svg-format">
<h2>SVG format<a class="headerlink" href="#svg-format" title="Link to this heading">#</a></h2>
<p>Most users will want to use the SVG drawing functions
<a class="reference external" href="https://tskit.dev/tskit/docs/stable/python-api.html#tskit.TreeSequence.draw_svg" title="(in Project name not set)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TreeSequence.draw_svg()</span></code></a> and
<a class="reference external" href="https://tskit.dev/tskit/docs/stable/python-api.html#tskit.Tree.draw_svg" title="(in Project name not set)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Tree.draw_svg()</span></code></a> for visualization. Being a vectorised
format, SVG files are suitable for presentations, publication, and
<a class="reference internal" href="#sec-tskit-viz-converting"><span class="std std-ref">editing or converting</span></a> to other graphic formats; some
basic forms of animation are also possible. Both functions produce an SVG string which is
automatically drawn if the string is the result of the last call in a Jupyter notebook:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">display</span>
<span class="n">svg_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span> <span class="c1"># Height and width for the SVG: optional but useful for this notebook</span>
<span class="n">svg_string</span> <span class="o">=</span> <span class="n">ts_tiny</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span>
    <span class="n">size</span><span class="o">=</span><span class="n">svg_size</span><span class="p">,</span>
    <span class="n">y_axis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span>  <span class="c1"># optional: show a time scale on the left</span>
    <span class="n">time_scale</span><span class="o">=</span><span class="s2">&quot;rank&quot;</span><span class="p">,</span> <span class="n">x_scale</span><span class="o">=</span><span class="s2">&quot;treewise&quot;</span><span class="p">,</span>  <span class="c1"># Force same axis settings as the text view</span>
<span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">svg_string</span><span class="p">)</span>  <span class="c1"># If the last line in a cell, wrapping this in display() is not needed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1783a5735e4f73e2e4847bf76b0cf7657b3c4341d8b7756a8ec1c10117ae1018.svg" src="_images/1783a5735e4f73e2e4847bf76b0cf7657b3c4341d8b7756a8ec1c10117ae1018.svg" />
</div>
</div>
<p>By default, sample nodes are drawn as black squares, and non-sample nodes are drawn as
black circles (but see below for ways to e.g. hide or colour these node symbols - NB.
apologies to US readers: the British spelling of “colour” will be used in the rest of
this tutorial).</p>
<section id="axes-and-scales">
<h3>Axes and scales<a class="headerlink" href="#axes-and-scales" title="Link to this heading">#</a></h3>
<p>For ease of drawing, the text representation and the SVG image above use unconventional
non-linear X and Y coordinate systems. By default, the SVG output uses a more
conventional linear scale for both time (Y) and genome position (X), and indicates the
position of each tree along the genome by an alternating shaded background. Although
more intuitive, linear scales can obscure some features of the trees, for example
causing labels to overlap:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_tiny</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">svg_size</span><span class="p">,</span> <span class="n">y_axis</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/09750bca385fff64098ae3ede08103dbb1f9c5bcad2746b8afef70d1471545ba.svg" src="_images/09750bca385fff64098ae3ede08103dbb1f9c5bcad2746b8afef70d1471545ba.svg" />
</div>
</div>
<p>One way to avoid overlapping labels on the Y axis is to use the <code class="docutils literal notranslate"><span class="pre">y_ticks</span></code> parameter,
which will be used in most subsequent examples in this tutorial.</p>
</section>
<section id="larger-tree-sequences">
<span id="sec-tskit-viz-larger-tree-sequences"></span><h3>Larger tree sequences<a class="headerlink" href="#larger-tree-sequences" title="Link to this heading">#</a></h3>
<p>So far, we have plotted only very small tree sequences. To visualize larger tree
sequences it is sometimes advisable to focus on a small region of the genome, possibly
even a single tree. The <code class="docutils literal notranslate"><span class="pre">x_lim</span></code> parameter allows you to plot the part of a tree
sequence that spans a particular genomic region: here’s a slighly larger tree sequence
with 8 samples, but where we’ve restricted the amount of the tree sequence we plot:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_limits</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">15000</span><span class="p">]</span>
<span class="c1"># Create evenly-spaced y tick positions to avoid overlap</span>
<span class="n">y_tick_pos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="mi">4000</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The tree sequence between positions </span><span class="si">{}</span><span class="s2"> and </span><span class="si">{}</span><span class="s2"> ...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">x_limits</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">ts_small</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span><span class="n">y_axis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">y_ticks</span><span class="o">=</span><span class="n">y_tick_pos</span><span class="p">,</span> <span class="n">x_lim</span><span class="o">=</span><span class="n">x_limits</span><span class="p">))</span>

<span class="n">third_tree</span> <span class="o">=</span> <span class="n">ts_small</span><span class="o">.</span><span class="n">at_index</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;... or just look at (say) the third tree&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">third_tree</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:root:Ticks {4000: &#39;4000&#39;} lie outside the plotted axis
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The tree sequence between positions 5000 and 15000 ...
</pre></div>
</div>
<img alt="_images/f66ab7082d212c1b76ffe064e27d97070212b6a5fca701902d74c88babf0057f.svg" src="_images/f66ab7082d212c1b76ffe064e27d97070212b6a5fca701902d74c88babf0057f.svg" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>... or just look at (say) the third tree
</pre></div>
</div>
<img alt="_images/5e19073282810d621916d5f1bd59927390496cc66246c3a97b24fc7e35467919.svg" src="_images/5e19073282810d621916d5f1bd59927390496cc66246c3a97b24fc7e35467919.svg" />
</div>
</div>
<p>As the number of sample nodes increases, internal nodes often bunch up at recent time
points, obscuring relationships. Setting <code class="docutils literal notranslate"><span class="pre">time_scale=&quot;rank&quot;</span></code>, as in the first SVG plot,
is one way to solve this. Another is to use a log-scale on the time axis, which can be
done by specifying <code class="docutils literal notranslate"><span class="pre">time_scale=&quot;log_time&quot;</span></code>, as below. To compare node times across the
plot, this example also uses the <code class="docutils literal notranslate"><span class="pre">y_gridlines</span></code> option, which puts a very faint grid
line at each y tick (if you are finding the lines difficult to see, note that the line
intensity, along with many other plot features, can be modified through
<a class="reference internal" href="#sec-tskit-viz-styling"><span class="std std-ref">styling</span></a>, which we also use in this example to avoid
overlapping text by shrinking the node labels and rotating those associated with leaves;
styling is detailed <a class="reference internal" href="#sec-tskit-viz-styling"><span class="std std-ref">later in this tutorial</span></a>).</p>
<div class="cell docutils container" id="sec-tskit-viz-large-tree-sequence">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;A larger tree, on a log timescale&quot;</span><span class="p">)</span>
<span class="n">wide_fmt</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1200</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
<span class="c1"># Create a stylesheet that shrinks labels and rotates leaf labels, to avoid overlap</span>
<span class="n">node_label_style</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;.node &gt; .lab {font-size: 80%}&quot;</span>
    <span class="s2">&quot;.leaf &gt; .lab {text-anchor: start; transform: rotate(90deg) translate(6px)}&quot;</span>
<span class="p">)</span>
<span class="n">ts_full</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span>
    <span class="n">size</span><span class="o">=</span><span class="n">wide_fmt</span><span class="p">,</span>
    <span class="n">time_scale</span><span class="o">=</span><span class="s2">&quot;log_time&quot;</span><span class="p">,</span>
    <span class="n">y_gridlines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">y_axis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">y_ticks</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span>
    <span class="n">style</span><span class="o">=</span><span class="n">node_label_style</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A larger tree, on a log timescale
</pre></div>
</div>
<img alt="_images/e217d21b82346e0d470867066238747b123bfdb99a5d5237391f9a641666ee9b.svg" src="_images/e217d21b82346e0d470867066238747b123bfdb99a5d5237391f9a641666ee9b.svg" />
</div>
</div>
<p>For even larger numbers of samples, you can plot the trees for a subset of samples
by applying the <a class="reference external" href="https://tskit.dev/tskit/docs/stable/python-api.html#tskit.TreeSequence.simplify" title="(in Project name not set)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TreeSequence.simplify()</span></code></a> method (make sure to specify
<code class="docutils literal notranslate"><span class="pre">filter_nodes=False</span></code> to retain the same node IDs). For a fancier solution, see
<a class="reference internal" href="#sec-tskit-viz-svg-examples-larger-plots"><span class="std std-ref">Simplifying larger plots</span></a> below.</p>
</section>
<section id="plotting-mutations">
<h3>Plotting mutations<a class="headerlink" href="#plotting-mutations" title="Link to this heading">#</a></h3>
<p>By default the SVG visualization also plots sites and mutations on the tree or
tree sequence (this can be disabled using the <code class="docutils literal notranslate"><span class="pre">omit_sites</span></code> parameter). For example,
adding mutations to the 8-sample tree sequence above gives the following plot: each
mutation is marked by a red cross on the branch where it occurs. Symbols are
either placed at the mutation’s known time, or (if the mutation time is unknown or
the <code class="docutils literal notranslate"><span class="pre">time_scale</span></code> parameter has been set to <code class="docutils literal notranslate"><span class="pre">&quot;rank&quot;</span></code>) spaced evenly along the branch.
By default, each mutation is also labelled with its <a class="reference external" href="https://tskit.dev/tskit/docs/stable/python-api.html#tskit.Mutation" title="(in Project name not set)"><code class="xref py py-class docutils literal notranslate"><span class="pre">mutation</span> <span class="pre">ID</span></code></a>.</p>
<p>If the X axis is shown (which it is by default when drawing a tree sequence, but not
when drawing an individual tree) then the sites are plotted using a black tickmark above
the axis line. Each plotted mutation at the site is then overlaid on top of this
as a red downwards-pointing chevron.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_mutated</span> <span class="o">=</span> <span class="n">msprime</span><span class="o">.</span><span class="n">sim_mutations</span><span class="p">(</span><span class="n">ts_small</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">342</span><span class="p">)</span>
<span class="n">ts_mutated</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span><span class="n">y_axis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">y_ticks</span><span class="o">=</span><span class="n">y_tick_pos</span><span class="p">,</span> <span class="n">x_lim</span><span class="o">=</span><span class="n">x_limits</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:root:Ticks {4000: &#39;4000&#39;} lie outside the plotted axis
</pre></div>
</div>
<img alt="_images/064b0eebdd4b711c58be790750734b140d1a46c85c2f5914185f403cf6659697.svg" src="_images/064b0eebdd4b711c58be790750734b140d1a46c85c2f5914185f403cf6659697.svg" />
</div>
</div>
<p>Note that, unusually, the rightmost site on the axis has more than one stacked chevron,
indicating that multiple mutations in the tree occur at the same site. These could be
mutations to different allelic states, or recurrent/back mutations. In this case the
mutations, 14 and 15 (above nodes 1 and 6) are recurrent mutations from T to G.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_mutated</span> <span class="o">=</span> <span class="n">tskit</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;data/viz_ts_small_mutated.trees&quot;</span><span class="p">)</span>
<span class="n">site_descr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">ts_mutated</span><span class="o">.</span><span class="n">at_index</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sites</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">site_descr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="s2">&quot;[</span><span class="se">\n</span><span class="s2">  &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;),&quot;</span><span class="p">,</span> <span class="s2">&quot;),</span><span class="se">\n</span><span class="s2"> &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;],&quot;</span><span class="p">,</span> <span class="s2">&quot;],</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Site(id=14, position=13963.0, ancestral_state=&#39;T&#39;, mutations=[
  Mutation(id=14, site=14, node=1, derived_state=&#39;G&#39;, parent=-1, metadata=b&#39;&#39;, time=619.6499091610359, edge=14, inherited_state=&#39;T&#39;),
  Mutation(id=15, site=14, node=6, derived_state=&#39;G&#39;, parent=-1, metadata=b&#39;&#39;, time=370.24979591084764, edge=4, inherited_state=&#39;T&#39;)],
 metadata=b&#39;&#39;)
</pre></div>
</div>
</div>
</div>
<section id="which-mutations-are-shown">
<h4>Which mutations are shown?<a class="headerlink" href="#which-mutations-are-shown" title="Link to this heading">#</a></h4>
<p>When using the <code class="docutils literal notranslate"><span class="pre">x_lim</span></code> parameter, only the mutations in the plotted region are shown.
For the third tree in the tree sequence visualization above, we thus haven’t plotted
mutations above position 15000. We can see <em>all</em> the mutations in the tree by changing the
plot region, or simply plotting the tree itself:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">third_tree</span> <span class="o">=</span> <span class="n">ts_mutated</span><span class="o">.</span><span class="n">at_index</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The third tree in the mutated tree sequence, which covers </span><span class="si">{</span><span class="n">third_tree</span><span class="o">.</span><span class="n">interval</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">third_tree</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The third tree in the mutated tree sequence, which covers Interval(left=13901.0, right=21285.0)
</pre></div>
</div>
<img alt="_images/89700da02b0e2e00595a24e4af07a342cef7b3d88e63649e25e8eade5a67d6e0.svg" src="_images/89700da02b0e2e00595a24e4af07a342cef7b3d88e63649e25e8eade5a67d6e0.svg" />
</div>
</div>
<p id="sec-tskit-viz-extra-mutations">However, when plotting a single tree it may not be evident that identical branches
may exist in several adjacent trees, indicating an <a class="reference external" href="https://tskit.dev/tskit/docs/stable/introduction.html#sec-introduction" title="(in Project name not set)"><span class="xref std std-ref">edge</span></a>
that persists across adjacent trees. For instance the rightmost branch in the tree above,
from node 10 down to 7, exists in the previous two trees too. Indeed, this edge has a
mutation on it at position 6295, in the first tree. This mutation is not plotted in the
tree above, but if you want <em>all</em> the mutations on each edge to be plotted, you can set
the <code class="docutils literal notranslate"><span class="pre">all_edge_mutations</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">True</span></code>. This adds any extra mutations that are
associated with an edge in the tree but which fall outside the interval of that tree; by
default these mutations are drawn in a slightly different shade (e.g. mutation 64 below).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">third_tree</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span> <span class="n">all_edge_mutations</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/57a1c360e18f1556b97cdcbc9ec5192f214219f86196d8f5ebdce95fc9c52d14.svg" src="_images/57a1c360e18f1556b97cdcbc9ec5192f214219f86196d8f5ebdce95fc9c52d14.svg" />
</div>
</div>
</section>
</section>
<section id="labelling">
<span id="sec-tskit-viz-labelling"></span><h3>Labelling<a class="headerlink" href="#labelling" title="Link to this heading">#</a></h3>
<p>Although the default node and mutation labels show unique identifiers, they are’t
terribly intuituive. The <code class="docutils literal notranslate"><span class="pre">node_labels</span></code> and <code class="docutils literal notranslate"><span class="pre">mutation_labels</span></code> parameters can be used
to set more meaningful labels (for example from the tree sequence <a class="reference external" href="https://tskit.dev/tskit/docs/stable/metadata.html#sec-metadata" title="(in Project name not set)"><span>Metadata</span></a>).
See <a class="reference internal" href="#sec-tskit-viz-dynamic-effects"><span class="std std-ref">Dynamic effects</span></a> if you want to dynamically hide and show such
labels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nd_labels</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># An array of labels for the nodes</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ts_mutated</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
    <span class="c1"># Set sample node labels from metadata. Here we use the population name, but you might want</span>
    <span class="c1"># to use the *individual* name instead, if the individuals in your tree sequence have names</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">is_sample</span><span class="p">():</span>
        <span class="n">nd_labels</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts_mutated</span><span class="o">.</span><span class="n">population</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">population</span><span class="p">)</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

<span class="n">mut_labels</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># An array of labels for the mutations</span>
<span class="k">for</span> <span class="n">mut</span> <span class="ow">in</span> <span class="n">ts_mutated</span><span class="o">.</span><span class="n">mutations</span><span class="p">():</span>  <span class="c1"># Make pretty labels showing the change in state</span>
    <span class="n">site</span> <span class="o">=</span> <span class="n">ts_mutated</span><span class="o">.</span><span class="n">site</span><span class="p">(</span><span class="n">mut</span><span class="o">.</span><span class="n">site</span><span class="p">)</span>
    <span class="n">older_mut</span> <span class="o">=</span> <span class="n">mut</span><span class="o">.</span><span class="n">parent</span> <span class="o">&gt;=</span> <span class="mi">0</span>  <span class="c1"># is there an older mutation at the same position?</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="n">ts_mutated</span><span class="o">.</span><span class="n">mutation</span><span class="p">(</span><span class="n">mut</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">derived_state</span> <span class="k">if</span> <span class="n">older_mut</span> <span class="k">else</span> <span class="n">site</span><span class="o">.</span><span class="n">ancestral_state</span>
    <span class="n">mut_labels</span><span class="p">[</span><span class="n">mut</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prev</span><span class="si">}</span><span class="s2">→</span><span class="si">{</span><span class="n">mut</span><span class="o">.</span><span class="n">derived_state</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="n">ts_mutated</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span>
    <span class="n">y_axis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">y_ticks</span><span class="o">=</span><span class="n">y_tick_pos</span><span class="p">,</span> <span class="n">x_lim</span><span class="o">=</span><span class="n">x_limits</span><span class="p">,</span>
    <span class="n">node_labels</span><span class="o">=</span><span class="n">nd_labels</span><span class="p">,</span>
    <span class="n">mutation_labels</span><span class="o">=</span><span class="n">mut_labels</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:root:Ticks {4000: &#39;4000&#39;} lie outside the plotted axis
</pre></div>
</div>
<img alt="_images/1b4fd14a23f9f578a6163a199241209babc14b51b396bf5ceb9e0246f35e613d.svg" src="_images/1b4fd14a23f9f578a6163a199241209babc14b51b396bf5ceb9e0246f35e613d.svg" />
</div>
</div>
</section>
<section id="styling">
<span id="sec-tskit-viz-styling"></span><h3>Styling<a class="headerlink" href="#styling" title="Link to this heading">#</a></h3>
<p>The SVG output produced by tskit contains a large number of
<a class="reference external" href="https://www.w3.org/TR/SVG2/styling.html#ClassAttribute">classes</a> which can be used to
target different elements of the drawing, allowing them to be hidden, styled, or
otherwise manipulated. This is done by passing a
<a class="reference external" href="https://www.w3.org/TR/SVG/styling.html">cascading style sheet (CSS)</a> string to
<code class="docutils literal notranslate"><span class="pre">draw_svg</span></code>. A common use of styles is to colour nodes by their population:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">styles</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># Create a style for each population, programmatically (or just type the string by hand)</span>
<span class="k">for</span> <span class="n">colour</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">],</span> <span class="n">ts_full</span><span class="o">.</span><span class="n">populations</span><span class="p">()):</span>
    <span class="c1"># target the symbols only (class &quot;sym&quot;)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;.node.p</span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> &gt; .sym &quot;</span> <span class="o">+</span> <span class="s2">&quot;{&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;fill: </span><span class="si">{</span><span class="n">colour</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
    <span class="n">styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s1">&quot; applies to nodes from population </span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> (id </span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
<span class="n">css_string</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">styles</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;CSS string applied:</span><span class="se">\n</span><span class="s1">    &quot;</span><span class="si">{</span><span class="n">css_string</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>

<span class="n">ts_full</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span>
    <span class="n">size</span><span class="o">=</span><span class="n">wide_fmt</span><span class="p">,</span>
    <span class="n">node_labels</span><span class="o">=</span><span class="p">{},</span>    <span class="c1"># Remove all node labels for a clearer viz</span>
    <span class="n">style</span><span class="o">=</span><span class="n">css_string</span><span class="p">,</span>  <span class="c1"># Apply the stylesheet</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&quot;.node.p0 &gt; .sym {fill: red}&quot; applies to nodes from population A (id 0)
&quot;.node.p1 &gt; .sym {fill: green}&quot; applies to nodes from population B (id 1)
&quot;.node.p2 &gt; .sym {fill: blue}&quot; applies to nodes from population C (id 2)
CSS string applied:
    &quot;.node.p0 &gt; .sym {fill: red} .node.p1 &gt; .sym {fill: green} .node.p2 &gt; .sym {fill: blue}&quot;
</pre></div>
</div>
<img alt="_images/591c591d5a9abd8b3a6930ad575ffde3d5834907b90ea41b7525d95d2ed5dbf4.svg" src="_images/591c591d5a9abd8b3a6930ad575ffde3d5834907b90ea41b7525d95d2ed5dbf4.svg" />
</div>
</div>
<p>Colouring nodes by population makes it immediately clear that, while the tree structure
does not exactly reflect the population divisions, there’s still considerable
population substructure present in this larger tree.</p>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>The (older) <a class="reference external" href="https://tskit.dev/tskit/docs/stable/python-api.html#tskit.Tree.draw" title="(in Project name not set)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Tree.draw()</span></code></a> function also has a <code class="docutils literal notranslate"><span class="pre">node_colour</span></code> argument that can be
used to colour tree nodes, which is used in some of the other tskit tutorials. Under the
hood, this function simply sets appropriate SVG styles on nodes. We intend to make it
easier to set colours in a similar way: see https://github.com/tskit-dev/tskit/issues/579.</p>
</div>
<p>The CSS string used to style the tree above takes advantage of the general classes defined
in a tskit SVG file: a node symbol always has a class named <code class="docutils literal notranslate"><span class="pre">sym</span></code>, which is contained
within a <a class="reference external" href="https://www.w3.org/TR/SVG2/struct.html#Groups">grouping element</a> of class
<code class="docutils literal notranslate"><span class="pre">node</span></code>. Moreover, elements such as <code class="docutils literal notranslate"><span class="pre">node</span></code> have <em>additional</em> classes, such as <code class="docutils literal notranslate"><span class="pre">p1</span></code>,
indicating that the node in this case belongs to the population with ID 1.</p>
<section id="available-css-classes">
<h4>Available css classes<a class="headerlink" href="#available-css-classes" title="Link to this heading">#</a></h4>
<p>Here are the css classes in a tskit SVG which can be used to style specific elements.</p>
<section id="within-the-plotting-area">
<h5>Within the plotting area<a class="headerlink" href="#within-the-plotting-area" title="Link to this heading">#</a></h5>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tree</span></code>: a grouping element containing each tree</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">node</span></code>: a grouping element within a tree, containing a node and its descendant
elements such as a node symbol, an edge, mutations, and other nodes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mut</span></code>: a grouping element containing a mutation symbol and label</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">extra</span></code>: an extra class for mutations <a class="reference internal" href="#sec-tskit-viz-extra-mutations"><span class="std std-ref">outside the tree</span></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lab</span></code>: a label element (for a node, mutation, axis, tick number, etc.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sym</span></code>: a symbol element (e.g. a node, mutation, or site symbol)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">edge</span></code>: an edge element (i.e. a branch in a tree)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">root</span></code>, <code class="docutils literal notranslate"><span class="pre">leaf</span></code> and <code class="docutils literal notranslate"><span class="pre">sample</span></code>: additional classes applied to a node group if the
node is a root node, a leaf node or a sample node</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unknown_time</span></code>: a class added to <code class="docutils literal notranslate"><span class="pre">mut</span></code> groups if the time of the mutation is
<a class="reference external" href="https://tskit.dev/tskit/docs/stable/python-api.html#tskit.UNKNOWN_TIME" title="(in Project name not set)"><code class="xref py py-data docutils literal notranslate"><span class="pre">tskit.UNKNOWN_TIME</span></code></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rgt</span></code> and <code class="docutils literal notranslate"><span class="pre">lft</span></code>: additional classes applied to labels for left- or
right-justification</p></li>
</ul>
</section>
<section id="outside-the-plotting-area">
<h5>Outside the plotting area<a class="headerlink" href="#outside-the-plotting-area" title="Link to this heading">#</a></h5>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">axes</span></code>: a grouping element containing the X and Y axes, if either are present</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x-axis</span></code>, <code class="docutils literal notranslate"><span class="pre">y-axis</span></code>: more specific grouping elements contained within <code class="docutils literal notranslate"><span class="pre">axes</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tick</span></code>: a single tick on an axis, containing a tickmark line and a label</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">site</span></code>: a grouping element representing a site (plotted on the X axis), containing a
site symbol (a tick line) and zero or more <code class="docutils literal notranslate"><span class="pre">mut</span></code> groups, each containing a
chevron-shaped mutation symbol</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">background</span></code>: the shaded background of a tree sequence plot</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">grid</span></code>: a gridline</p></li>
</ul>
</section>
<section id="id-based-classes">
<h5>ID-based classes<a class="headerlink" href="#id-based-classes" title="Link to this heading">#</a></h5>
<p>Elements have additional classes based on the IDs of trees, nodes, parent (ancestor)
nodes, individuals, populations, mutations, and sites. These class names start with a
single letter (respectively <code class="docutils literal notranslate"><span class="pre">t</span></code>, <code class="docutils literal notranslate"><span class="pre">n</span></code>, <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">i</span></code>, <code class="docutils literal notranslate"><span class="pre">p</span></code>, <code class="docutils literal notranslate"><span class="pre">m</span></code>, and <code class="docutils literal notranslate"><span class="pre">s</span></code>) followed by a
numerical ID. For example, here’s a typical node in an tskit SVG plot:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">g</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;a10 i3 leaf m16 m17 node n7 p2 s15 s16 sample&quot;</span><span class="o">&gt;...&lt;/</span><span class="n">g</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This corresponds to node 7, the rightmost leaf in the third tree in the mutated tree
sequence (plotted in the previous section but one). The classes indicate that it
has an immediate ancestor (parent) node with ID 10 (<code class="docutils literal notranslate"><span class="pre">a10</span></code>), and that the node
belongs to an <a class="reference external" href="https://tskit.dev/tskit/docs/stable/glossary.html#sec-nodes-or-individuals" title="(in Project name not set)"><span class="xref std std-ref">individual</span></a> with ID 3 (<code class="docutils literal notranslate"><span class="pre">i3</span></code>).
The classes <code class="docutils literal notranslate"><span class="pre">n7</span></code> and <code class="docutils literal notranslate"><span class="pre">p2</span></code> tell us that the node ID is 7 and is is from the
population with ID 2 (<code class="docutils literal notranslate"><span class="pre">p2</span></code>). Other ID classes on the node tell us about the mutations
above that node, of which there are two in this case, with
IDs 16 and 17 (<code class="docutils literal notranslate"><span class="pre">m16</span></code>, <code class="docutils literal notranslate"><span class="pre">m17</span></code>); those mutations are associated with
site IDs 15 and 16 (<code class="docutils literal notranslate"><span class="pre">s16</span></code>, <code class="docutils literal notranslate"><span class="pre">s17</span></code>).</p>
<p>Other grouping elements apart from nodes can also contain ID-based classes. For example
the <code class="docutils literal notranslate"><span class="pre">tree</span></code> group contains the ID of the tree (e.g. <code class="docutils literal notranslate"><span class="pre">t0</span></code>), the <code class="docutils literal notranslate"><span class="pre">site</span></code> group on the X axis
contains the site ID (e.g. <code class="docutils literal notranslate"><span class="pre">s15</span></code>) the <code class="docutils literal notranslate"><span class="pre">mut</span></code> class contains the mutation ID (e.g. <code class="docutils literal notranslate"><span class="pre">m16</span></code>),
and so on.</p>
</section>
</section>
<section id="css-selector-quick-reference">
<h4>CSS selector quick reference<a class="headerlink" href="#css-selector-quick-reference" title="Link to this heading">#</a></h4>
<p>If you don’t do this all the time it’s not easy to remember what the various separators
mean, so here’s a quick reference (for more, see
<a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_selectors">these docs</a>):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">abc</span></code> (Type <code class="docutils literal notranslate"><span class="pre">abc</span></code>, like <code class="docutils literal notranslate"><span class="pre">g</span></code> for a <code class="docutils literal notranslate"><span class="pre">&lt;g&gt;...&lt;/g&gt;</span></code> tag)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.xyz</span></code> (Class <code class="docutils literal notranslate"><span class="pre">xyz</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#uvw</span></code> (ID <code class="docutils literal notranslate"><span class="pre">uvw</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">,</span></code> (Selector list, means “or”)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&gt;</span></code> (Child combinator)</p></li>
<li><p>“<code class="docutils literal notranslate"> </code>“ (Descendant combinator, a space)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">+</span></code> (Next-sibling combinator)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">~</span></code> (Subsequent sibling combinator)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">|</span></code> (Namespace separator)</p></li>
</ul>
</section>
<section id="styling-graphical-elements">
<h4>Styling graphical elements<a class="headerlink" href="#styling-graphical-elements" title="Link to this heading">#</a></h4>
<p>The classes above make it easy to target specific nodes or edges in one or multiple
trees. For example, we can colour branches that are shared between trees
(identified below as ones that have the same parent and child):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">css_string</span> <span class="o">=</span> <span class="s2">&quot;.a15.n9 &gt; .edge {stroke: cyan; stroke-width: 2px}&quot;</span>  <span class="c1"># branches from 15-&gt;9</span>
<span class="n">ts_small</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span><span class="n">time_scale</span><span class="o">=</span><span class="s2">&quot;rank&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">wide_fmt</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">css_string</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/313aee8324f776d3f752146476ecde2c7d88e04aee483ecf286c0e028042038e.svg" src="_images/313aee8324f776d3f752146476ecde2c7d88e04aee483ecf286c0e028042038e.svg" />
</div>
</div>
<p>By generating the css string programatically, you can target all the edges present in a
particular tree, and see how they gradually disappear from adjacent trees. Below, for
example the branches in the central tree have been coloured red, as have the identical
branches in adjacent trees. The central tree represents a location in the genome
that has seen a selective sweep, and therefore has short branch lengths: adjacent trees
are not under direct selection and thus the black branches tend to be longer.
These (red) shared branches extending far on either side represent shared haplotypes,
and this shows how long, shared haplotypes can extend much further away from a sweep
than the region of reduced diversity (which is the region spanned by the short tree in the middle).
For visual clarity, node symbols and labels have been turned off.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_selection</span> <span class="o">=</span> <span class="n">tskit</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;data/viz_ts_selection.trees&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">css_edge_targets</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># collect the css targets of all the edges in the selected tree</span>
<span class="n">sweep_location</span> <span class="o">=</span> <span class="n">ts_selection</span><span class="o">.</span><span class="n">sequence_length</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># NB: sweep is in the middle of the ts</span>
<span class="n">focal_tree</span> <span class="o">=</span> <span class="n">ts_selection</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">sweep_location</span><span class="p">)</span>
<span class="k">for</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="n">focal_tree</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">focal_tree</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">parent_id</span> <span class="o">!=</span> <span class="n">tskit</span><span class="o">.</span><span class="n">NULL</span><span class="p">:</span>
        <span class="n">css_edge_targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;.a</span><span class="si">{</span><span class="n">parent_id</span><span class="si">}</span><span class="s2">.n</span><span class="si">{</span><span class="n">node_id</span><span class="si">}</span><span class="s2">&gt;.edge&quot;</span><span class="p">)</span>
<span class="n">css_string</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">css_edge_targets</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;{stroke: red} .sym {display: none}&quot;</span>
<span class="n">css_string</span> <span class="o">+=</span> <span class="p">(</span>  <span class="c1"># Rotate the position labels etc</span>
    <span class="s2">&quot;.x-axis .ticks .lab {text-anchor: start; transform: translate(6px) rotate(90deg)}&quot;</span>
    <span class="s2">&quot;.x-axis .title .lab {text-anchor: start}&quot;</span>
<span class="p">)</span>
<span class="n">wide_tall_fmt</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1200</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
<span class="n">ts_selection</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span>
    <span class="n">style</span><span class="o">=</span><span class="n">css_string</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="n">wide_tall_fmt</span><span class="p">,</span>
    <span class="n">canvas_size</span><span class="o">=</span><span class="p">(</span><span class="n">wide_tall_fmt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">wide_tall_fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">30</span><span class="p">),</span>
    <span class="n">x_lim</span><span class="o">=</span><span class="p">[</span><span class="mf">1e4</span><span class="p">,</span> <span class="mf">4e4</span><span class="p">],</span>
    <span class="n">node_labels</span><span class="o">=</span><span class="p">{},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f41cb4cc9e943ae1324357d971f12ee1479c6a893fc9758a47590ef9904c04ec.svg" src="_images/f41cb4cc9e943ae1324357d971f12ee1479c6a893fc9758a47590ef9904c04ec.svg" />
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Branches in multiple trees that have the same parent and child do not always
correspond to a single <a class="reference external" href="https://tskit.dev/tskit/docs/stable/introduction.html#sec-introduction" title="(in Project name not set)"><span class="xref std std-ref">edge</span></a>
in a tree sequence: for example, edges have the
additional constraint that they must belong to <em>adjacent</em> trees.</p>
</div>
</section>
<section id="dynamic-effects">
<span id="sec-tskit-viz-dynamic-effects"></span><h4>Dynamic effects<a class="headerlink" href="#dynamic-effects" title="Link to this heading">#</a></h4>
<p>In the previous example, the large size of the plotted trees meant that, for clarity,
the node and mutation labels were turned off (in that case by passing empty mappings
to the <code class="docutils literal notranslate"><span class="pre">node_labels</span></code> and <code class="docutils literal notranslate"><span class="pre">mutation_labels</span></code> parameters). Nevertheless, it can be useful
to identify nodes and mutations, and this can be done dynamically (on “mouseover”) by
setting the CSS <a class="reference external" href="https://www.w3.org/TR/SVG2/render.html#VisibilityControl">display</a>
property to <code class="docutils literal notranslate"><span class="pre">none</span></code> vs <code class="docutils literal notranslate"><span class="pre">initial</span></code>, and combining it with the CSS <code class="docutils literal notranslate"><span class="pre">:hover</span></code> pseudoclass.
Here’s an example using a region from within the previous example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">HTML</span>
<span class="c1"># add some mutations</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">msprime</span><span class="o">.</span><span class="n">sim_mutations</span><span class="p">(</span><span class="n">ts_selection</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="mf">2e-8</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">node_label_css</span> <span class="o">=</span> <span class="p">(</span>
    <span class="c1"># hide node labels by default</span>
    <span class="s2">&quot;#hover_example .node &gt; .sym ~ .lab {display: none}&quot;</span>
    <span class="c1"># Unless the adjacent node or the label is hovered over</span>
    <span class="s2">&quot;#hover_example .node &gt; .sym:hover ~ .lab {display: inherit}&quot;</span>
    <span class="s2">&quot;#hover_example .node &gt; .sym ~ .lab:hover {display: inherit}&quot;</span>
<span class="p">)</span>

<span class="n">mut_label_css</span> <span class="o">=</span> <span class="p">(</span>
    <span class="c1"># hide mutation labels by default</span>
    <span class="s2">&quot;#hover_example .mut .sym ~ .lab {display: none}&quot;</span>
    <span class="c1"># Unless the adjacent node or the label is hovered over</span>
    <span class="s2">&quot;#hover_example .mut .sym:hover ~ .lab {display: inherit}&quot;</span>
    <span class="s2">&quot;#hover_example .mut .sym ~ .lab:hover {display: inherit}&quot;</span>
<span class="p">)</span>

<span class="n">optional_css</span> <span class="o">=</span> <span class="p">(</span>
    <span class="c1"># These are optional, but setting e.g. the node label text to bold with grey stroke</span>
    <span class="c1"># and a black fill, serves to make black text readable against a black tree </span>
    <span class="s2">&quot;svg#hover_example {background-color: white}&quot;</span>
    <span class="s2">&quot;#hover_example .tree .plotbox .lab {stroke: #CCC; fill: black; font-weight: bold}&quot;</span>
    <span class="s2">&quot;#hover_example .tree .mut .lab {stroke: #FCC; fill: red; font-weight: bold}&quot;</span>
<span class="p">)</span>

<span class="n">HTML</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span>
    <span class="n">style</span><span class="o">=</span><span class="n">optional_css</span> <span class="o">+</span> <span class="n">node_label_css</span> <span class="o">+</span> <span class="n">mut_label_css</span><span class="p">,</span>
    <span class="n">y_axis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">y_ticks</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="mi">500</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">:</span> <span class="s2">&quot;1000&quot;</span><span class="p">},</span>
    <span class="n">x_lim</span><span class="o">=</span><span class="p">[</span><span class="mf">2.3e4</span><span class="p">,</span> <span class="mf">2.7e4</span><span class="p">],</span>    
    <span class="n">root_svg_attributes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;hover_example&quot;</span><span class="p">},</span>
        <span class="c1"># Label node by name in metadata, if it exists, else node ID</span>
    <span class="n">node_labels</span><span class="o">=</span><span class="p">{</span><span class="n">u</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">u</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;NodeID=</span><span class="si">{</span><span class="n">u</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">ts</span><span class="o">.</span><span class="n">nodes</span><span class="p">()},</span>
    <span class="n">mutation_labels</span><span class="o">=</span><span class="p">{</span>
        <span class="c1"># Label mutation by site position, prev state, and new state</span>
        <span class="n">m</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;pos </span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">position</span><span class="si">:</span><span class="s2">g</span><span class="si">}</span><span class="s2">: &quot;</span> <span class="o">+</span>
            <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">ancestral_state</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">parent</span><span class="o">&lt;</span><span class="mi">0</span> <span class="k">else</span> <span class="n">ts</span><span class="o">.</span><span class="n">mutation</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">derived_state</span><span class="p">)</span> <span class="o">+</span>
            <span class="sa">f</span><span class="s2">&quot;→</span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">derived_state</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">ts</span><span class="o">.</span><span class="n">sites</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">mutations</span>
    <span class="p">},</span>
<span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><svg baseProfile="full" height="200" id="hover_example" version="1.1" width="600" xmlns="http://www.w3.org/2000/svg" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><style type="text/css"><![CDATA[.background path {fill: #808080; fill-opacity: 0}.background path:nth-child(odd) {fill-opacity: .1}.x-regions rect {fill: yellow; stroke: black; opacity: 0.5}.axes {font-size: 14px}.x-axis .tick .lab {font-weight: bold; dominant-baseline: hanging}.axes, .tree {font-size: 14px; text-anchor: middle}.axes line, .edge {stroke: black; fill: none}.axes .ax-skip {stroke-dasharray: 4}.y-axis .grid {stroke: #FAFAFA}.node > .sym {fill: black; stroke: none}.site > .sym {stroke: black}.mut text {fill: red; font-style: italic}.mut.extra text {fill: hotpink}.mut line {fill: none; stroke: none}.mut .sym {fill: none; stroke: red}.mut.extra .sym {stroke: hotpink}.node .mut .sym {stroke-width: 1.5px}.tree text, .tree-sequence text {dominant-baseline: central}.plotbox .lab.lft {text-anchor: end}.plotbox .lab.rgt {text-anchor: start}.polytomy line {stroke: black; stroke-dasharray: 1px, 1px}.polytomy text {paint-order:stroke;stroke-width:0.3em;stroke:white}svg#hover_example {background-color: white}#hover_example .tree .plotbox .lab {stroke: #CCC; fill: black; font-weight: bold}#hover_example .tree .mut .lab {stroke: #FCC; fill: red; font-weight: bold}#hover_example .node > .sym ~ .lab {display: none}#hover_example .node > .sym:hover ~ .lab {display: inherit}#hover_example .node > .sym ~ .lab:hover {display: inherit}#hover_example .mut .sym ~ .lab {display: none}#hover_example .mut .sym:hover ~ .lab {display: inherit}#hover_example .mut .sym ~ .lab:hover {display: inherit}]]></style></defs><g class="tree-sequence"><g class="background"><path d="M56.8,0 l174.4,0 l0,138.2 l-21.8872,25 l0,5 l-152.513,0 l0,-5 l0,-25 l0,-138.2z"/><path d="M231.2,0 l174.4,0 l0,138.2 l-136.773,25 l0,5 l-59.514,0 l0,-5 l21.887,-25 l0,-138.2z"/><path d="M405.6,0 l174.4,0 l0,138.2 l0,25 l0,5 l-311.173,0 l0,-5 l136.773,-25 l0,-138.2z"/></g><g class="axes"><g class="x-axis"><g class="title" transform="translate(318.4 200)"><text class="lab" text-anchor="middle" transform="translate(0 -11)">Genome position</text></g><line class="ax-line" x1="56.8" x2="580" y1="163.2" y2="163.2"/><g class="ticks"><g class="tick" transform="translate(209.313 163.2)"><line x1="0" x2="0" y1="0" y2="5"/><g transform="translate(0 6)"><text class="lab">24166</text></g></g><g class="tick" transform="translate(268.827 163.2)"><line x1="0" x2="0" y1="0" y2="5"/><g transform="translate(0 6)"><text class="lab">24621</text></g></g></g><g class="site s9" transform="translate(221.216 163.2)"><line class="sym" x1="0" x2="0" y1="0" y2="-10"/><g class="mut m9"><polyline class="sym" points="2.5,-6.5 0,-1.5 -2.5,-6.5"/></g></g><g class="site s10" transform="translate(389.032 163.2)"><line class="sym" x1="0" x2="0" y1="0" y2="-10"/><g class="mut m10"><polyline class="sym" points="2.5,-6.5 0,-1.5 -2.5,-6.5"/></g></g><g class="site s11" transform="translate(530.688 163.2)"><line class="sym" x1="0" x2="0" y1="0" y2="-10"/><g class="mut m11"><polyline class="sym" points="2.5,-6.5 0,-1.5 -2.5,-6.5"/></g></g><g class="site s12" transform="translate(554.625 163.2)"><line class="sym" x1="0" x2="0" y1="0" y2="-10"/><g class="mut m12"><polyline class="sym" points="2.5,-6.5 0,-1.5 -2.5,-6.5"/></g></g></g><g class="y-axis"><g class="title" transform="translate(0 65.7)"><text class="lab" text-anchor="middle" transform="translate(11) rotate(-90)">Time ago (generations)</text></g><line class="ax-line" x1="56.8" x2="56.8" y1="121.4" y2="10"/><g class="ticks"><g class="tick" transform="translate(56.8 121.4)"><line x1="0" x2="-5" y1="0" y2="0"/><g transform="translate(-6 0)"><text class="lab" text-anchor="end">0</text></g></g><g class="tick" transform="translate(56.8 77.816)"><line x1="0" x2="-5" y1="0" y2="0"/><g transform="translate(-6 0)"><text class="lab" text-anchor="end"/></g></g><g class="tick" transform="translate(56.8 34.2319)"><line x1="0" x2="-5" y1="0" y2="0"/><g transform="translate(-6 0)"><text class="lab" text-anchor="end">1000</text></g></g></g></g></g><g class="plotbox trees"><g class="tree t8" transform="translate(56.8 0)"><g class="plotbox"><g class="c2 node n28 p0 root" transform="translate(131.825 26.8)"><g class="a28 i5 leaf node n5 p0 sample" transform="translate(16.975 94.6)"><path class="edge e26" d="M 0 0 V -94.6 H -16.975"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample F</text></g><g class="a28 c2 node n27 p0" transform="translate(-16.975 19.707)"><g class="a27 i6 leaf node n6 p0 sample" transform="translate(22.75 74.893)"><path class="edge e24" d="M 0 0 V -74.893 H -22.75"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample G</text></g><g class="a27 c2 node n26 p0" transform="translate(-22.75 3.24352)"><g class="a26 c2 node n24 p0" transform="translate(20.3 4.17273)"><g class="a24 i7 leaf node n7 p0 sample" transform="translate(-8.4 67.4768)"><path class="edge e16" d="M 0 0 V -67.4768 H 8.4"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample H</text></g><g class="a24 c2 node n19 p0" transform="translate(8.4 15.8114)"><g class="a19 i9 leaf node n9 p0 sample" transform="translate(-5.6 51.6654)"><path class="edge e8" d="M 0 0 V -51.6654 H 5.6"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample J</text></g><g class="a19 i10 leaf node n10 p0 sample" transform="translate(5.6 51.6654)"><path class="edge e9" d="M 0 0 V -51.6654 H -5.6"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample K</text></g><path class="edge e18" d="M 0 0 V -15.8114 H -8.4"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab rgt" transform="translate(3 -7)">NodeID=19</text></g><path class="edge e22" d="M 0 0 V -4.17273 H -20.3"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab rgt" transform="translate(3 -7)">NodeID=24</text></g><g class="a26 c2 node n25 p0" transform="translate(-20.3 2.82686)"><g class="a25 c2 node n15 p0" transform="translate(15.4 32.3951)"><g class="a15 i2 leaf node n2 p0 sample" transform="translate(-5.6 36.4275)"><path class="edge e2" d="M 0 0 V -36.4275 H 5.6"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample C</text></g><g class="a15 i4 leaf node n4 p0 sample" transform="translate(5.6 36.4275)"><path class="edge e3" d="M 0 0 V -36.4275 H -5.6"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample E</text></g><path class="edge e20" d="M 0 0 V -32.3951 H -15.4"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab rgt" transform="translate(3 -7)">NodeID=15</text></g><g class="a25 c2 node n21 p0" transform="translate(-15.4 9.56931)"><g class="a21 i3 leaf node n3 p0 sample" transform="translate(14 59.2534)"><path class="edge e12" d="M 0 0 V -59.2534 H -14"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample D</text></g><g class="a21 c2 node n20 p0" transform="translate(-14 5.80278)"><g class="a20 c2 node n12 p0" transform="translate(11.2 47.6356)"><g class="a12 i1 leaf node n1 p0 sample" transform="translate(-5.6 5.81498)"><path class="edge e0" d="M 0 0 V -5.81498 H 5.6"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample B</text></g><g class="a12 i8 leaf node n8 p0 sample" transform="translate(5.6 5.81498)"><path class="edge e1" d="M 0 0 V -5.81498 H -5.6"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample I</text></g><path class="edge e10" d="M 0 0 V -47.6356 H -11.2"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab rgt" transform="translate(3 -7)">NodeID=12</text></g><g class="a20 c2 node n18 p0" transform="translate(-11.2 2.01533)"><g class="a18 i0 leaf node n0 p0 sample" transform="translate(-5.6 51.4353)"><path class="edge e6" d="M 0 0 V -51.4353 H 5.6"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample A</text></g><g class="a18 i11 leaf node n11 p0 sample" transform="translate(5.6 51.4353)"><path class="edge e7" d="M 0 0 V -51.4353 H -5.6"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample L</text></g><path class="edge e11" d="M 0 0 V -2.01533 H 11.2"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">NodeID=18</text></g><path class="edge e13" d="M 0 0 V -5.80278 H 14"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">NodeID=20</text></g><path class="edge e21" d="M 0 0 V -9.56931 H 15.4"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">NodeID=21</text></g><path class="edge e23" d="M 0 0 V -2.82686 H 20.3"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">NodeID=25</text></g><path class="edge e25" d="M 0 0 V -3.24352 H 22.75"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">NodeID=26</text></g><path class="edge e27" d="M 0 0 V -19.707 H 16.975"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">NodeID=27</text></g><circle class="sym" cx="0" cy="0" r="3"/><text class="lab" transform="translate(0 -11)">NodeID=28</text></g></g></g><g class="tree t9" transform="translate(231.2 0)"><g class="plotbox"><g class="c2 node n28 p0 root" transform="translate(131.825 26.8)"><g class="a28 i5 leaf node n5 p0 sample" transform="translate(16.975 94.6)"><path class="edge e26" d="M 0 0 V -94.6 H -16.975"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample F</text></g><g class="a28 c2 node n27 p0" transform="translate(-16.975 19.707)"><g class="a27 i6 leaf node n6 p0 sample" transform="translate(22.75 74.893)"><path class="edge e24" d="M 0 0 V -74.893 H -22.75"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample G</text></g><g class="a27 c2 node n26 p0" transform="translate(-22.75 3.24352)"><g class="a26 c2 node n24 p0" transform="translate(20.3 4.17273)"><g class="a24 i7 leaf node n7 p0 sample" transform="translate(-8.4 67.4768)"><path class="edge e16" d="M 0 0 V -67.4768 H 8.4"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample H</text></g><g class="a24 c2 node n16 p0" transform="translate(8.4 18.2495)"><g class="a16 i9 leaf node n9 p0 sample" transform="translate(-5.6 49.2273)"><path class="edge e4" d="M 0 0 V -49.2273 H 5.6"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample J</text></g><g class="a16 i10 leaf node n10 p0 sample" transform="translate(5.6 49.2273)"><path class="edge e5" d="M 0 0 V -49.2273 H -5.6"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample K</text></g><path class="edge e17" d="M 0 0 V -18.2495 H -8.4"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab rgt" transform="translate(3 -7)">NodeID=16</text></g><path class="edge e22" d="M 0 0 V -4.17273 H -20.3"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab rgt" transform="translate(3 -7)">NodeID=24</text></g><g class="a26 c2 node n25 p0" transform="translate(-20.3 2.82686)"><g class="a25 c2 node n15 p0" transform="translate(15.4 32.3951)"><g class="a15 i2 leaf node n2 p0 sample" transform="translate(-5.6 36.4275)"><path class="edge e2" d="M 0 0 V -36.4275 H 5.6"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample C</text></g><g class="a15 i4 leaf node n4 p0 sample" transform="translate(5.6 36.4275)"><path class="edge e3" d="M 0 0 V -36.4275 H -5.6"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample E</text></g><path class="edge e20" d="M 0 0 V -32.3951 H -15.4"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab rgt" transform="translate(3 -7)">NodeID=15</text></g><g class="a25 c2 node n21 p0" transform="translate(-15.4 9.56931)"><g class="a21 i3 leaf m9 node n3 p0 s9 sample" transform="translate(14 59.2534)"><path class="edge e12" d="M 0 0 V -59.2534 H -14"/><g class="mut m9 s9" transform="translate(0 -47.4468)"><line x1="0" x2="0" y1="0" y2="47.4468"/><path class="sym" d="M -3,-3 l 6,6 M -3,3 l 6,-6"/><text class="lab rgt" transform="translate(5 0)">pos 24257: G→A</text></g><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample D</text></g><g class="a21 c2 node n20 p0" transform="translate(-14 5.80278)"><g class="a20 c2 node n12 p0" transform="translate(11.2 47.6356)"><g class="a12 i1 leaf node n1 p0 sample" transform="translate(-5.6 5.81498)"><path class="edge e0" d="M 0 0 V -5.81498 H 5.6"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample B</text></g><g class="a12 i8 leaf node n8 p0 sample" transform="translate(5.6 5.81498)"><path class="edge e1" d="M 0 0 V -5.81498 H -5.6"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample I</text></g><path class="edge e10" d="M 0 0 V -47.6356 H -11.2"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab rgt" transform="translate(3 -7)">NodeID=12</text></g><g class="a20 c2 node n18 p0" transform="translate(-11.2 2.01533)"><g class="a18 i0 leaf node n0 p0 sample" transform="translate(-5.6 51.4353)"><path class="edge e6" d="M 0 0 V -51.4353 H 5.6"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample A</text></g><g class="a18 i11 leaf node n11 p0 sample" transform="translate(5.6 51.4353)"><path class="edge e7" d="M 0 0 V -51.4353 H -5.6"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample L</text></g><path class="edge e11" d="M 0 0 V -2.01533 H 11.2"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">NodeID=18</text></g><path class="edge e13" d="M 0 0 V -5.80278 H 14"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">NodeID=20</text></g><path class="edge e21" d="M 0 0 V -9.56931 H 15.4"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">NodeID=21</text></g><path class="edge e23" d="M 0 0 V -2.82686 H 20.3"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">NodeID=25</text></g><path class="edge e25" d="M 0 0 V -3.24352 H 22.75"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">NodeID=26</text></g><path class="edge e27" d="M 0 0 V -19.707 H 16.975"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">NodeID=27</text></g><circle class="sym" cx="0" cy="0" r="3"/><text class="lab" transform="translate(0 -11)">NodeID=28</text></g></g></g><g class="tree t10" transform="translate(405.6 0)"><g class="plotbox"><g class="c2 node n28 p0 root" transform="translate(131.825 26.8)"><g class="a28 i5 leaf node n5 p0 sample" transform="translate(16.975 94.6)"><path class="edge e26" d="M 0 0 V -94.6 H -16.975"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample F</text></g><g class="a28 c2 node n27 p0" transform="translate(-16.975 19.707)"><g class="a27 i6 leaf node n6 p0 sample" transform="translate(22.75 74.893)"><path class="edge e24" d="M 0 0 V -74.893 H -22.75"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample G</text></g><g class="a27 c2 node n26 p0" transform="translate(-22.75 3.24352)"><g class="a26 c2 node n24 p0" transform="translate(20.3 4.17273)"><g class="a24 i7 leaf node n7 p0 sample" transform="translate(-8.4 67.4768)"><path class="edge e16" d="M 0 0 V -67.4768 H 8.4"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample H</text></g><g class="a24 c2 node n22 p0" transform="translate(8.4 6.08346)"><g class="a22 i9 leaf m12 node n9 p0 s12 sample" transform="translate(-5.6 61.3933)"><path class="edge e14" d="M 0 0 V -61.3933 H 5.6"/><g class="mut m12 s12" transform="translate(0 -42.504)"><line x1="0" x2="0" y1="0" y2="42.504"/><path class="sym" d="M -3,-3 l 6,6 M -3,3 l 6,-6"/><text class="lab lft" transform="translate(-5 0)">pos 26806: T→G</text></g><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample J</text></g><g class="a22 i10 leaf m10 m11 node n10 p0 s10 s11 sample" transform="translate(5.6 61.3933)"><path class="edge e15" d="M 0 0 V -61.3933 H -5.6"/><g class="mut m11 s11" transform="translate(0 -50.9321)"><line x1="0" x2="0" y1="0" y2="50.9321"/><path class="sym" d="M -3,-3 l 6,6 M -3,3 l 6,-6"/><text class="lab rgt" transform="translate(5 0)">pos 26623: G→A</text></g><g class="mut m10 s10" transform="translate(0 -16.7634)"><line x1="0" x2="0" y1="0" y2="16.7634"/><path class="sym" d="M -3,-3 l 6,6 M -3,3 l 6,-6"/><text class="lab rgt" transform="translate(5 0)">pos 25540: C→G</text></g><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample K</text></g><path class="edge e19" d="M 0 0 V -6.08346 H -8.4"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab rgt" transform="translate(3 -7)">NodeID=22</text></g><path class="edge e22" d="M 0 0 V -4.17273 H -20.3"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab rgt" transform="translate(3 -7)">NodeID=24</text></g><g class="a26 c2 node n25 p0" transform="translate(-20.3 2.82686)"><g class="a25 c2 node n15 p0" transform="translate(15.4 32.3951)"><g class="a15 i2 leaf node n2 p0 sample" transform="translate(-5.6 36.4275)"><path class="edge e2" d="M 0 0 V -36.4275 H 5.6"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample C</text></g><g class="a15 i4 leaf node n4 p0 sample" transform="translate(5.6 36.4275)"><path class="edge e3" d="M 0 0 V -36.4275 H -5.6"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample E</text></g><path class="edge e20" d="M 0 0 V -32.3951 H -15.4"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab rgt" transform="translate(3 -7)">NodeID=15</text></g><g class="a25 c2 node n21 p0" transform="translate(-15.4 9.56931)"><g class="a21 i3 leaf node n3 p0 sample" transform="translate(14 59.2534)"><path class="edge e12" d="M 0 0 V -59.2534 H -14"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample D</text></g><g class="a21 c2 node n20 p0" transform="translate(-14 5.80278)"><g class="a20 c2 node n12 p0" transform="translate(11.2 47.6356)"><g class="a12 i1 leaf node n1 p0 sample" transform="translate(-5.6 5.81498)"><path class="edge e0" d="M 0 0 V -5.81498 H 5.6"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample B</text></g><g class="a12 i8 leaf node n8 p0 sample" transform="translate(5.6 5.81498)"><path class="edge e1" d="M 0 0 V -5.81498 H -5.6"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample I</text></g><path class="edge e10" d="M 0 0 V -47.6356 H -11.2"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab rgt" transform="translate(3 -7)">NodeID=12</text></g><g class="a20 c2 node n18 p0" transform="translate(-11.2 2.01533)"><g class="a18 i0 leaf node n0 p0 sample" transform="translate(-5.6 51.4353)"><path class="edge e6" d="M 0 0 V -51.4353 H 5.6"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample A</text></g><g class="a18 i11 leaf node n11 p0 sample" transform="translate(5.6 51.4353)"><path class="edge e7" d="M 0 0 V -51.4353 H -5.6"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">Sample L</text></g><path class="edge e11" d="M 0 0 V -2.01533 H 11.2"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">NodeID=18</text></g><path class="edge e13" d="M 0 0 V -5.80278 H 14"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">NodeID=20</text></g><path class="edge e21" d="M 0 0 V -9.56931 H 15.4"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">NodeID=21</text></g><path class="edge e23" d="M 0 0 V -2.82686 H 20.3"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">NodeID=25</text></g><path class="edge e25" d="M 0 0 V -3.24352 H 22.75"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">NodeID=26</text></g><path class="edge e27" d="M 0 0 V -19.707 H 16.975"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">NodeID=27</text></g><circle class="sym" cx="0" cy="0" r="3"/><text class="lab" transform="translate(0 -11)">NodeID=28</text></g></g></g></g></g></svg></div></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Above we have wrapped the svg in an IPython <a class="reference external" href="https://ipython.readthedocs.io/en/stable/api/generated/IPython.display.html#IPython.display.HTML" title="(in IPython v9.9.0)"><code class="xref py py-class docutils literal notranslate"><span class="pre">HTML</span></code></a>
class, and given the SVG a unique
id as described below in <a class="reference internal" href="#sec-tskit-viz-styling-more-about"><span class="std std-ref">More about styling</span></a>. This forces the SVG
plot to be rendered inline (rather than inside an <code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code> tag), allowing the hover
functionality to work in all supported Jupyter notebook implementations. However,
depending on your Jupyter setup, the <code class="docutils literal notranslate"><span class="pre">HTML()</span></code> wrapper may not be necessary.</p>
</div>
<p>Using the transformations discussed in the next section, it is also possible to animate
SVG images, as shown in the <a class="reference internal" href="#sec-tskit-viz-svg-examples-animation"><span class="std std-ref">Animation</span></a> code within the
<a class="reference internal" href="#sec-tskit-viz-svg-examples"><span class="std std-ref">SVG examples</span></a> section near the end of this tutorial.</p>
</section>
<section id="transforming-and-masking-elements">
<span id="sec-tskit-viz-styling-transforming-and-masking"></span><h4>Transforming and masking elements<a class="headerlink" href="#transforming-and-masking-elements" title="Link to this heading">#</a></h4>
<p>We can also use styles to transform elements of the drawing, shifting them into different
locations or changing their orientation. For example,
<a class="reference internal" href="#sec-tskit-viz-large-tree-sequence"><span class="std std-ref">earlier in this tutorial</span></a> we used the
following CSS string to rotate leaf labels:</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">leaf</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">.</span><span class="nc">lab</span><span class="w"> </span><span class="p">{</span><span class="n">text-anchor</span><span class="p">:</span><span class="w"> </span><span class="kc">start</span><span class="p">;</span><span class="w"> </span><span class="k">transform</span><span class="p">:</span><span class="w"> </span><span class="nb">rotate</span><span class="p">(</span><span class="mi">90</span><span class="kt">deg</span><span class="p">)</span><span class="w"> </span><span class="nb">translate</span><span class="p">(</span><span class="mi">6</span><span class="kt">px</span><span class="p">)}</span>
</pre></div>
</div>
<p>Transformations not only allow us to shift elements about, but also resize and skew them.
When applied to both symbols and labels this can create rather different formatting styles:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">css_string</span> <span class="o">=</span> <span class="p">(</span>
    <span class="c1"># Draw large yellow circles for nodes ...</span>
    <span class="s2">&quot;.node &gt; .sym {transform: scale(2.2); fill: yellow; stroke: black; stroke-width: 0.5px}&quot;</span>

    <span class="c1"># ...but for leaf nodes, override the yellow circle using a more specific CSS target</span>
    <span class="s2">&quot;.node.leaf &gt; .sym {transform: scale(1); fill:black}&quot;</span>

    <span class="c1"># Override default node text position to be based at (0, 0) relative to the node pos</span>
    <span class="c1"># Note that the .tree specifier is needed to make this more specific than the default</span>
    <span class="c1"># positioning which is targetted at &quot;.lab.lft&quot; and &quot;.lab.rgt&quot;</span>
    <span class="s2">&quot;.tree .node &gt; .lab {transform: translate(0, 0); text-anchor: middle; font-size: 7pt}&quot;</span>

    <span class="c1"># For leaf nodes, override the above positioning using a subsequent CSS style</span>
    <span class="s2">&quot;.node.leaf &gt; .lab {transform: translate(0, 12px); font-size: 10pt}&quot;</span>
<span class="p">)</span>
<span class="n">ts_small</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="n">css_string</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c1d6e3397e440d5eec8cf6ea4d90d7e0124cbc70c94ec278dc9e16bca3fa6ab1.svg" src="_images/c1d6e3397e440d5eec8cf6ea4d90d7e0124cbc70c94ec278dc9e16bca3fa6ab1.svg" />
</div>
</div>
<p>Note that when transforming elements, parts of the drawing may be plotted outsize of
of the standard canvas. You can use the <code class="docutils literal notranslate"><span class="pre">canvas_size</span></code> parameter to increase the size of
the canvas (adding more space to the right and bottom of the plot), without rescaling
the graphics. This is particularly useful when performing more radical CSS
transformations, for example to create <a class="reference internal" href="#sec-tskit-viz-svg-examples-3d"><span class="std std-ref">3D effects</span></a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">skew</span> <span class="o">=</span> <span class="mf">0.8</span>  <span class="c1"># How skewed the trees are, in radians</span>

<span class="c1"># CSS transforms used to skew the trees</span>
<span class="n">style</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;.tree .plotbox </span><span class="se">{{</span><span class="s2">transform: skewY(</span><span class="si">{</span><span class="n">skew</span><span class="si">}</span><span class="s2">rad)</span><span class="se">}}</span><span class="s2">&quot;</span>
<span class="c1"># Shift the x axis to make room for the skewed trees</span>
<span class="n">shift_axis</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">style</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;.x-axis </span><span class="se">{{</span><span class="s2">transform: translate(</span><span class="si">{</span><span class="n">shift_axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">px, </span><span class="si">{</span><span class="n">shift_axis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">px)</span><span class="se">}}</span><span class="s2">&quot;</span>

<span class="c1"># Must define a bigger canvas size so we don&#39;t crop the axis off</span>
<span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span> <span class="c1"># width, height of svg</span>
<span class="n">canvas_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift_axis</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">shift_axis</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">ts_tiny</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">x_scale</span><span class="o">=</span><span class="s2">&quot;treewise&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span> <span class="n">canvas_size</span><span class="o">=</span><span class="n">canvas_size</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/64ce48c7ac6096cb9d9f93757ddaa1b889ae1a8f3dee564df3635180e552bcae.svg" src="_images/64ce48c7ac6096cb9d9f93757ddaa1b889ae1a8f3dee564df3635180e552bcae.svg" />
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">transform</span></code> in styles is an SVG2 feature, and has not yet been implemented in
the software programs Inkscape or librsvg. Therefore if you are
<a class="reference internal" href="#sec-tskit-viz-converting"><span class="std std-ref">converting or editing</span></a> the examples above, the
transformed elements may be positioned incorrectly. For changing symbols, the
<code class="docutils literal notranslate"><span class="pre">symbol_size</span></code> option can be used to simply change the size of all symbols in the plot,
but otherwise you may need to use the <code class="docutils literal notranslate"><span class="pre">chromium</span></code> workaround documented
<a class="reference internal" href="#sec-tskit-viz-converting-note"><span class="std std-ref">here</span></a>.</p>
</div>
<p>Although it is hard to change the style of a node symbol, the visible area of the symbol
can be modified using the <code class="docutils literal notranslate"><span class="pre">clip-path</span></code> CSS property. This can be useful to show, for
instance, a triangle to summarise the descendants of a MRCA.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check that MRCA of 2 &amp; 3 is node 4 in all trees, assumed later</span>
<span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="mi">4</span> <span class="o">==</span> <span class="n">tree</span><span class="o">.</span><span class="n">mrca</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">ts_tiny</span><span class="o">.</span><span class="n">trees</span><span class="p">()])</span>

<span class="n">styles</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Set all node labels to be rotated and small</span>
    <span class="s2">&quot;.node &gt; .lab {text-anchor: start; transform: rotate(90deg) translate(6px); font-size: 8px}&quot;</span><span class="p">,</span>

    <span class="c1"># Hide all nodes descending from node 4. We then treat node 4 as a summary node</span>
    <span class="s2">&quot;.n4 &gt; .node {display: none}&quot;</span><span class="p">,</span>
    
    <span class="c1"># Use clipping &amp; scaling to change the symbol for node 4 into a summary triangle</span>
    <span class="s2">&quot;.n4 &gt; .sym {clip-path: polygon(50</span><span class="si">% 50%</span><span class="s2">, 75</span><span class="si">% 75%</span><span class="s2">, 25</span><span class="si">% 75%</span><span class="s2">); transform: scale(8.0, 8.0)}&quot;</span><span class="p">,</span>
    
    <span class="c1"># Make the font bigger for this summary node label</span>
    <span class="s2">&quot;.n4 &gt; .lab {transform: rotate(90deg) translate(14px); font-size: 16px}&quot;</span>
<span class="p">]</span>

<span class="n">node_labels</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;Nd. 0&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;Nd. 1&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="s2">&quot;Two samples&quot;</span><span class="p">}</span>

<span class="n">ts_tiny</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span>
    <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span>
    <span class="n">x_scale</span><span class="o">=</span><span class="s2">&quot;treewise&quot;</span><span class="p">,</span>
    <span class="n">time_scale</span><span class="o">=</span><span class="s2">&quot;log_time&quot;</span><span class="p">,</span>
    <span class="n">style</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">styles</span><span class="p">),</span>
    <span class="n">node_labels</span><span class="o">=</span><span class="n">node_labels</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/682e8caa34dd0a3d9de4cabb9071747806b85c7dd47f4c4a8480b7eba480a8c2.svg" src="_images/682e8caa34dd0a3d9de4cabb9071747806b85c7dd47f4c4a8480b7eba480a8c2.svg" />
</div>
</div>
<p>In the example above we simply hid the descendant topology for each “summary MRCA”,
meaning more horizontal space was taken up than expected. For a more sophisticated
example, see <a class="reference internal" href="#sec-tskit-viz-svg-examples-larger-plots"><span class="std std-ref">Simplifying larger plots</span></a> in which some
descendant samples are actually removed from the tree sequence entirely, and their MRCA
is changed into a sample node instead.</p>
</section>
<section id="styling-and-svg-structure">
<h4>Styling and SVG structure<a class="headerlink" href="#styling-and-svg-structure" title="Link to this heading">#</a></h4>
<p>To take full advantage of the SVG styling capabilities in tskit, it is worth knowing how
the SVG file is structured. In particular tskit SVGs use a hierarchical grouping
structure that reflects the tree topology. This allows easy styling and manipulation of
both individual elements and entire subtrees. Currently, the hierarchical structure of a
simple 2-tip SVG tree produced by tskit looks something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">g</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;tree t0&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">g</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;plotbox&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">g</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;node n2 root&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">g</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;node n1 a2 i1 p1 m0 s0 sample leaf&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">path</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;edge&quot;</span> <span class="o">...</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">g</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;mut m0 s0&quot;</span> <span class="o">...&gt;</span>
          <span class="o">&lt;</span><span class="n">line</span> <span class="o">.../&gt;</span>
          <span class="o">&lt;</span><span class="n">path</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;sym&quot;</span> <span class="o">.../&gt;</span>
          <span class="o">&lt;</span><span class="n">text</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;lab&quot;</span><span class="o">&gt;</span><span class="n">Mutation</span> <span class="mi">0</span><span class="o">&lt;/</span><span class="n">text</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">g</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">rect</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;sym&quot;</span> <span class="o">...</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">text</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;lab&quot;</span> <span class="o">...&gt;</span><span class="n">Node</span> <span class="mi">1</span><span class="o">&lt;/</span><span class="n">text</span><span class="o">&gt;</span>
      <span class="o">&lt;/</span><span class="n">g</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">g</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;node n0 a2 i2 p1 sample leaf&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">path</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;edge&quot;</span> <span class="o">...</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="n">rect</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;sym&quot;</span> <span class="o">.../&gt;</span>
        <span class="o">&lt;</span><span class="n">text</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;lab&quot;</span> <span class="o">...&gt;</span><span class="n">Node</span> <span class="mi">0</span><span class="o">&lt;/</span><span class="n">text</span><span class="o">&gt;</span>
      <span class="o">&lt;/</span><span class="n">g</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">path</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;edge&quot;</span> <span class="o">...</span> <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">circle</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;sym&quot;</span> <span class="o">...</span> <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="n">text</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;lab&quot;</span><span class="o">&gt;</span><span class="n">Root</span> <span class="p">(</span><span class="n">Node</span> <span class="mi">2</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">text</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">g</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">g</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">g</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>And in a tree sequence plot, the SVG simply consists of a set of such trees, together
with groups containing the background and axes, if required.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">g</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;tree-sequence&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">g</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;background&quot;</span><span class="o">&gt;&lt;/</span><span class="n">g</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">g</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;axes&quot;</span><span class="o">&gt;&lt;/</span><span class="n">g</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">g</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;trees&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">g</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;tree t0&quot;</span><span class="o">&gt;...&lt;/</span><span class="n">g</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">g</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;tree t1&quot;</span><span class="o">&gt;...&lt;/</span><span class="n">g</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">g</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;tree t2&quot;</span><span class="o">&gt;...&lt;/</span><span class="n">g</span><span class="o">&gt;</span>
    <span class="o">...</span>
    <span class="o">&lt;/</span><span class="n">g</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">g</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">g</span><span class="o">&gt;</span>
    
</pre></div>
</div>
</section>
<section id="styling-subtrees">
<h4>Styling subtrees<a class="headerlink" href="#styling-subtrees" title="Link to this heading">#</a></h4>
<p>The nested grouping structure makes it easy to target a node and all its descendants.
For instance, here’s how to draw all the edges of node 13 and its descendants using a
thicker blue line:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">edge_style</span> <span class="o">=</span> <span class="s2">&quot;.n13 .edge {stroke: blue; stroke-width: 2px}&quot;</span>
<span class="n">nd_labs</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">17</span><span class="p">]}</span>
<span class="n">ts_mutated</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span><span class="n">x_lim</span><span class="o">=</span><span class="n">x_limits</span><span class="p">,</span> <span class="n">node_labels</span><span class="o">=</span><span class="n">nd_labs</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">edge_style</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/052d96db29fcc281579653f18ed83b6881b114d77b0cbfef9f8138ea253ebc97.svg" src="_images/052d96db29fcc281579653f18ed83b6881b114d77b0cbfef9f8138ea253ebc97.svg" />
</div>
</div>
<p>This might not be quite what you expected: the branch leading from node 13 to its parent
(node 17) has also been coloured. That’s because the SVG node group deliberately contains
the branch that leads to the parent (this can be helpful, for example, for hiding the
entire subtree leading to node 13, using e.g. <code class="docutils literal notranslate"><span class="pre">.n13</span> <span class="pre">{display:</span> <span class="pre">none}</span></code>). To colour
the branches <em>descending</em> from node 13, you therefore need to target the nodes nested
at least one level deep within the <code class="docutils literal notranslate"><span class="pre">n13</span></code> group. One way to do that is to add an
extra <code class="docutils literal notranslate"><span class="pre">.node</span></code> class to the style, e.g.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">edge_style</span> <span class="o">=</span> <span class="s2">&quot;.n13 .node .edge {stroke: blue; stroke-width: 2px}&quot;</span>
<span class="c1"># NB to target the edges in only (say) the 1st tree you could use &quot;.t0 .n13 .node .edge ...&quot;</span>
<span class="n">ts_mutated</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span><span class="n">x_lim</span><span class="o">=</span><span class="n">x_limits</span><span class="p">,</span> <span class="n">node_labels</span><span class="o">=</span><span class="n">nd_labs</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">edge_style</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f08eaafc5f224e727ac4d77ec234dfb069cfba3dd70e6c3682ad96757b125a46.svg" src="_images/f08eaafc5f224e727ac4d77ec234dfb069cfba3dd70e6c3682ad96757b125a46.svg" />
</div>
</div>
<p>If you want to colour the branches descending from a particular mutation (say mutation 7)
then you need to colour not only the edges, but also <em>part</em> of an edge (i.e. the line
that connects a mutation downwards to its associated node). The tskit SVG format provides
a special <code class="docutils literal notranslate"><span class="pre">&lt;line&gt;</span></code> element to enable this, which is normally made invisible using
<code class="docutils literal notranslate"><span class="pre">fill:</span> <span class="pre">none</span> <span class="pre">stroke:</span> <span class="pre">none</span></code> in the default stylesheet. Here’s an example of activating
this normally-hidden line:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">default_muts</span> <span class="o">=</span> <span class="s2">&quot;.mut .lab {fill: gray} .mut .sym {stroke: gray}&quot;</span>  <span class="c1"># all other muts in gray</span>
<span class="n">m8_mut</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;.m8 .node .edge, &quot;</span>  <span class="c1"># the descendant edges</span>
    <span class="s2">&quot;.mut.m8 line, &quot;</span>  <span class="c1"># activate the hidden line between the mutation and the node</span>
    <span class="s2">&quot;.mut.m8 .sym &quot;</span>  <span class="c1"># the mutation symbols on the tree and the axis</span>
    <span class="s2">&quot;{stroke: red; stroke-width: 2px}&quot;</span>
    <span class="s2">&quot;.mut.m8 .lab {fill: red}&quot;</span>  <span class="c1"># colour the label &quot;8&quot; in red too</span>
<span class="p">)</span>
<span class="n">css_string</span> <span class="o">=</span> <span class="n">default_muts</span> <span class="o">+</span> <span class="n">m8_mut</span>
<span class="n">ts_mutated</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span><span class="n">x_lim</span><span class="o">=</span><span class="n">x_limits</span><span class="p">,</span> <span class="n">node_labels</span><span class="o">=</span><span class="n">nd_labs</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">css_string</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/497789b899a72a5c1dacd37ab93443d7446aea35298455818a38e9f449e70a7c.svg" src="_images/497789b899a72a5c1dacd37ab93443d7446aea35298455818a38e9f449e70a7c.svg" />
</div>
</div>
</section>
<section id="restricting-styling">
<h4>Restricting styling<a class="headerlink" href="#restricting-styling" title="Link to this heading">#</a></h4>
<p>Sometimes the hierarchical nesting leads to styles being applied too widely. For example,
since style selectors include all the descendants of a target, to target just the node
itself (and not its descendants) a slightly different specification is required,
involving, the “<code class="docutils literal notranslate"><span class="pre">&gt;</span></code>” symbol, or
<a class="reference external" href="https://www.w3.org/TR/selectors-3/#child-combinators">child combinator</a> (we have,
in fact, used it in several previous examples). The following plot shows the difference
when all decendant symbols are targetted, versus just the immediate child symbol:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">node_style1</span> <span class="o">=</span> <span class="s2">&quot;.n13 .sym {fill: yellow}&quot;</span>  <span class="c1"># All symbols under node 13 </span>
<span class="n">node_style2</span> <span class="o">=</span> <span class="s2">&quot;.n15 &gt; .sym {fill: cyan}&quot;</span>  <span class="c1"># Only symbols that are an immediate child of node 15</span>
<span class="n">css_string</span> <span class="o">=</span> <span class="n">node_style1</span> <span class="o">+</span> <span class="n">node_style2</span>
<span class="n">ts_small</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span><span class="n">y_axis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">y_ticks</span><span class="o">=</span><span class="n">y_tick_pos</span><span class="p">,</span> <span class="n">x_lim</span><span class="o">=</span><span class="n">x_limits</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">css_string</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:root:Ticks {4000: &#39;4000&#39;} lie outside the plotted axis
</pre></div>
</div>
<img alt="_images/12e2b4a2ce8050a8b5f9de661902e189f2ceecbc7a19b667062d1d57ac949fcf.svg" src="_images/12e2b4a2ce8050a8b5f9de661902e189f2ceecbc7a19b667062d1d57ac949fcf.svg" />
</div>
</div>
<p>Another example of modifying the style target is <em>negation</em>. This is needed, for example,
to target nodes that are <em>not</em> leaves (i.e. internal nodes). One way to do this is to
target <em>all</em> the node symbols first, then replace the style with a more specific
targetting of the leaf symbols only:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hide_internal_symlabs</span> <span class="o">=</span> <span class="s2">&quot;.node &gt; .sym, .node &gt; .lab {display: none}&quot;</span>
<span class="n">show_leaf_symlabs</span> <span class="o">=</span> <span class="s2">&quot;.node.leaf &gt; .sym, .node.leaf &gt; .lab {display: initial}&quot;</span>
<span class="n">css_string</span> <span class="o">=</span> <span class="n">hide_internal_symlabs</span> <span class="o">+</span> <span class="n">show_leaf_symlabs</span>
<span class="n">ts_small</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span><span class="n">y_axis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">y_ticks</span><span class="o">=</span><span class="n">y_tick_pos</span><span class="p">,</span> <span class="n">x_lim</span><span class="o">=</span><span class="n">x_limits</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">css_string</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:root:Ticks {4000: &#39;4000&#39;} lie outside the plotted axis
</pre></div>
</div>
<img alt="_images/1f91521b4f1b5d3cc42dcd9401b9125835c199ef5cb8a1cc4d97c4e11fcef9ef.svg" src="_images/1f91521b4f1b5d3cc42dcd9401b9125835c199ef5cb8a1cc4d97c4e11fcef9ef.svg" />
</div>
</div>
<p>Alternatively, the <code class="docutils literal notranslate"><span class="pre">:not</span></code> selector can be used to target nodes that are <em>not</em> leaves,
so the following style specification should produce the same effect in SVG viewers that
support it (note, however, as of v1.2 Inkscape does not appear to support this selector).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">style_string</span> <span class="o">=</span> <span class="s2">&quot;.node:not(.leaf) &gt; .sym, .node:not(.leaf) &gt; .lab {display: none}&quot;</span>
</pre></div>
</div>
</section>
<section id="more-about-styling">
<span id="sec-tskit-viz-styling-more-about"></span><h4>More about styling<a class="headerlink" href="#more-about-styling" title="Link to this heading">#</a></h4>
<p>NOTE: if your SVG is embedded directly into an HTML page (a common way for jupyter
notebooks to render SVGs), then according to the HTML specifications, any styles applied
to one SVG will apply to all SVGs in the document. To avoid this confusing state of
affairs,  we recommend that you tag the SVG with a unique ID using the
<code class="docutils literal notranslate"><span class="pre">root_svg_attributes</span></code> parameter, then prepend this ID to the style string:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_small</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span>
    <span class="n">x_lim</span><span class="o">=</span><span class="n">x_limits</span><span class="p">,</span>
    <span class="n">root_svg_attributes</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s2">&quot;myUID&quot;</span><span class="p">},</span>
    <span class="n">style</span><span class="o">=</span><span class="s2">&quot;#myUID .background * {fill: #00FF00}&quot;</span><span class="p">,</span>  <span class="c1"># apply any old style to this specific SVG</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/73b08845ac22ac8c09d48c0f563615c81d44c8b563e62df4f7d450b61e95f146.svg" src="_images/73b08845ac22ac8c09d48c0f563615c81d44c8b563e62df4f7d450b61e95f146.svg" />
</div>
</div>
<p>SVG styles allow a huge amount of flexibility in formatting your plot, even extending to
animations. Feel free to browse the <a class="reference internal" href="#sec-tskit-viz-svg-examples"><span class="std std-ref">examples</span></a> for
inspiration.</p>
</section>
</section>
<section id="converting-and-editing-svg">
<span id="sec-tskit-viz-converting"></span><h3>Converting and editing SVG<a class="headerlink" href="#converting-and-editing-svg" title="Link to this heading">#</a></h3>
<section id="converting">
<h4>Converting<a class="headerlink" href="#converting" title="Link to this heading">#</a></h4>
<p><a class="reference external" href="https://inkscape.org">Inkscape</a> is an open source SVG editor that can also be scripted
to output bitmap files.</p>
<p><a class="reference external" href="https://imagemagick.org/">Imagemagick</a> is a common piece of software used to convert
between image formats. It can
be configured to delegate to one of several different SVG libraries when converting
SVGs to bitmap formats. Currently, both the librsvg library or the Inkscape library
produce reasonable output, although librsvg currently misaligns some labels due to
<a class="reference external" href="https://gitlab.gnome.org/GNOME/librsvg/-/issues/414">ignoring certain SVG properties</a>.</p>
<div class="admonition note" id="sec-tskit-viz-converting-note">
<p class="admonition-title">Note</p>
<p>A few stylesheet specifications, such as the <code class="docutils literal notranslate"><span class="pre">transform</span></code> property, are SVG2
features, and have not yet been implemented in Inkscape or librsvg.
Therefore if you use these in your own custom SVG stylesheet (such as the example
above where we rotated leaf labels), they will not be applied properly
when converted with those tools. For custom stylesheets like this, a workaround is
to convert the SVG to PDF first, using e.g. the programmable chromium engine:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chromium</span> <span class="o">--</span><span class="n">headless</span> <span class="o">--</span><span class="nb">print</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">pdf</span><span class="o">=</span><span class="n">out</span><span class="o">.</span><span class="n">pdf</span> <span class="ow">in</span><span class="o">.</span><span class="n">svg</span>
</pre></div>
</div>
<p>The resulting PDF file can then be converted by Inkscape, retaining the correct
transformations.</p>
</div>
</section>
<section id="editing-the-svg">
<h4>Editing the SVG<a class="headerlink" href="#editing-the-svg" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>Editing can be done in <a class="reference external" href="https://inkscape.org">Inkscape</a> (subject to the note above)</p></li>
</ul>
<div class="admonition-todo admonition" id="id2">
<p class="admonition-title">Todo</p>
<p>Tips on how to cope with the hierarchical grouping when editing (e.g. in Inkscape using
<code class="docutils literal notranslate"><span class="pre">Extensions</span> <span class="pre">menu</span> <span class="pre">&gt;</span> <span class="pre">Arrange</span> <span class="pre">&gt;</span> <span class="pre">Deep</span> <span class="pre">Ungroup</span></code>, but note that this will mess with the styles!)</p>
</div>
</section>
</section>
</section>
<section id="examples">
<span id="sec-tskit-viz-examples"></span><h2>Examples<a class="headerlink" href="#examples" title="Link to this heading">#</a></h2>
<section id="text-examples">
<h3>Text examples<a class="headerlink" href="#text-examples" title="Link to this heading">#</a></h3>
<section id="tree-orientation">
<h4>Tree orientation<a class="headerlink" href="#tree-orientation" title="Link to this heading">#</a></h4>
<p>In the text format, trees (but not tree sequences) can be displayed in different orientations</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">HTML</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">msprime</span>

<span class="n">ts</span> <span class="o">=</span> <span class="n">msprime</span><span class="o">.</span><span class="n">sim_ancestry</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="n">orient</span> <span class="o">=</span> <span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span>
<span class="n">html</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">orient</span><span class="p">:</span>
    <span class="n">tree_string</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">draw_text</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="n">o</span><span class="p">)</span>
    <span class="n">html</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;pre style=&#39;display: inline-block&#39;&gt;</span><span class="si">{</span><span class="n">tree_string</span><span class="si">}</span><span class="s2">&lt;/pre&gt;&quot;</span><span class="p">)</span>
<span class="n">HTML</span><span class="p">((</span><span class="s2">&quot;&amp;nbsp;&quot;</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">html</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><pre style='display: inline-block'>     14        
  ┏━━━┻━━━━┓   
 13        ┃   
┏━┻━┓      ┃   
┃   ┃     12   
┃   ┃    ┏━┻━┓ 
┃  11    ┃   ┃ 
┃  ┏┻━┓  ┃   ┃ 
┃  ┃  ┃  ┃  10 
┃  ┃  ┃  ┃  ┏┻┓
┃  9  ┃  ┃  ┃ ┃
┃ ┏┻┓ ┃  ┃  ┃ ┃
┃ ┃ ┃ ┃  8  ┃ ┃
┃ ┃ ┃ ┃ ┏┻┓ ┃ ┃
0 2 7 4 1 6 3 5
</pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre style='display: inline-block'>     ┏━━━━━━━━━━0
     ┃           
  ┏13┫       ┏━━2
  ┃  ┃   ┏━━9┫   
  ┃  ┗━11┫   ┗━━7
  ┃      ┃       
14┫      ┗━━━━━━4
  ┃              
  ┃            ┏1
  ┃    ┏━━━━━━8┫ 
  ┃    ┃       ┗6
  ┗━━12┫         
       ┃   ┏━━━━3
       ┗━10┫     
           ┗━━━━5
</pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre style='display: inline-block'>0 2 7 4 1 6 3 5
┃ ┃ ┃ ┃ ┗┳┛ ┃ ┃
┃ ┃ ┃ ┃  8  ┃ ┃
┃ ┗┳┛ ┃  ┃  ┃ ┃
┃  9  ┃  ┃  ┃ ┃
┃  ┃  ┃  ┃  ┗┳┛
┃  ┃  ┃  ┃  10 
┃  ┗┳━┛  ┃   ┃ 
┃  11    ┃   ┃ 
┃   ┃    ┗━┳━┛ 
┃   ┃     12   
┗━┳━┛      ┃   
 13        ┃   
  ┗━━━┳━━━━┛   
     14        
</pre>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre style='display: inline-block'>0━━━━━━━━━━┓     
           ┃     
2━━┓       ┣13┓  
   ┣9━━┓   ┃  ┃  
7━━┛   ┣11━┛  ┃  
       ┃      ┃  
4━━━━━━┛      ┣14
              ┃  
1┓            ┃  
 ┣8━━━━━━┓    ┃  
6┛       ┃    ┃  
         ┣12━━┛  
3━━━━┓   ┃       
     ┣10━┛       
5━━━━┛           
</pre></div></div>
</div>
</section>
</section>
<section id="svg-examples">
<span id="sec-tskit-viz-svg-examples"></span><h3>SVG examples<a class="headerlink" href="#svg-examples" title="Link to this heading">#</a></h3>
<section id="a-standard-ts-plot">
<h4>A standard ts plot<a class="headerlink" href="#a-standard-ts-plot" title="Link to this heading">#</a></h4>
<p>Note that this tree sequence also illustrates a few features which are not normally
produced e.g. by <code class="docutils literal notranslate"><span class="pre">msprime</span></code> simulations, in particular a “empty” site (with no
associated mutations) at position 50, and some mutations that occur above root nodes in
the trees. Graphically, root mutations necessitate a line above the root node on which to
place them, so each tree in this SVG has a nominal “root branch” at the top. Normally,
root branches are not drawn, unless the <code class="docutils literal notranslate"><span class="pre">force_root_branch</span></code> parameter is specified.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make a tree sequence with multiple mutations including some above the root</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tskit</span>

<span class="k">def</span><span class="w"> </span><span class="nf">make_unusual_ts</span><span class="p">():</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">    id      is_sample   population      individual      time    metadata</span>
<span class="sd">    0       1       0       -1      0</span>
<span class="sd">    1       1       0       -1      0</span>
<span class="sd">    2       1       0       -1      0</span>
<span class="sd">    3       1       0       -1      0</span>
<span class="sd">    4       0       0       -1      0.1145014598813</span>
<span class="sd">    5       0       0       -1      1.11067965364865</span>
<span class="sd">    6       0       0       -1      1.75005250750382</span>
<span class="sd">    7       0       0       -1      5.31067154311640</span>
<span class="sd">    8       0       0       -1      6.57331354884652</span>
<span class="sd">    9       0       0       -1      9.08308317451295</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">)</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">    id      left   right   parent  child</span>
<span class="sd">    0       0      100     4       0</span>
<span class="sd">    1       0      100     4       1</span>
<span class="sd">    2       0      100     5       2</span>
<span class="sd">    3       0      100     5       3</span>
<span class="sd">    4       80     85      6       4</span>
<span class="sd">    5       80     85      6       5</span>
<span class="sd">    6       6      80      7       4</span>
<span class="sd">    7       85     91      7       4</span>
<span class="sd">    8       6      80      7       5</span>
<span class="sd">    9       85     91      7       5</span>
<span class="sd">    10      91     100     8       4</span>
<span class="sd">    11      91     100     8       5</span>
<span class="sd">    12      0      6       9       4</span>
<span class="sd">    13      0      6       9       5</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">)</span>
    <span class="n">sites</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">    position    ancestral_state</span>
<span class="sd">    4           A</span>
<span class="sd">    6           0</span>
<span class="sd">    30          Empty</span>
<span class="sd">    50          XXX</span>
<span class="sd">    91          T</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">)</span>
    <span class="n">muts</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">    site   node    derived_state    parent    time</span>
<span class="sd">    0      9       T                -1        15</span>
<span class="sd">    0      9       G                0         9.1</span>
<span class="sd">    0      5       1                1         9</span>
<span class="sd">    1      4       C                -1        1.6</span>
<span class="sd">    1      4       G                3         1.5</span>
<span class="sd">    2      7       G                -1        10</span>
<span class="sd">    2      3       C                5         1</span>
<span class="sd">    4      3       G                -1        1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">tskit</span><span class="o">.</span><span class="n">load_text</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">sites</span><span class="o">=</span><span class="n">sites</span><span class="p">,</span> <span class="n">mutations</span><span class="o">=</span><span class="n">muts</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="n">ts</span> <span class="o">=</span> <span class="n">make_unusual_ts</span><span class="p">()</span>
<span class="n">ts</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/508b87c5c2fc3f3a9f84acef2546c56824f1aacb7d17cb7d8d00030ab3261709.svg" src="_images/508b87c5c2fc3f3a9f84acef2546c56824f1aacb7d17cb7d8d00030ab3261709.svg" />
</div>
</div>
</section>
<section id="highlighted-mutations">
<h4>Highlighted mutations<a class="headerlink" href="#highlighted-mutations" title="Link to this heading">#</a></h4>
<p>Specific mutations can be given a different colour. Moreover, the descendant lineages of
specific mutations can be coloured and the branch colours overlay each other as expected.
Note that in this example, internal node labels and symbols have been hidden for clarity.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">make_unusual_ts</span><span class="p">()</span>  <span class="c1"># Defined in the first SVG example</span>
<span class="n">css_string</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;.edge {stroke: grey}&quot;</span>
    <span class="s2">&quot;.mut .sym{stroke:pink} .mut text{fill:pink}&quot;</span>
    <span class="s2">&quot;.mut.m2 .sym, .m2&gt;line, .m2&gt;.node .edge{stroke:blue} .mut.m2 .lab{fill:blue}&quot;</span>
    <span class="s2">&quot;.mut.m3 .sym, .m3&gt;line, .m3&gt;.node .edge{stroke:cyan} .mut.m3 .lab{fill:cyan}&quot;</span>
    <span class="s2">&quot;.mut.m4 .sym, .m4&gt;line, .m4&gt;.node .edge{stroke:red} .mut.m4 .lab{fill:red}&quot;</span>
    <span class="c1"># Hide internal node labels &amp; symbols</span>
    <span class="s2">&quot;.node:not(.leaf) &gt; .sym, .node:not(.leaf) &gt; .lab {display: none}&quot;</span>
<span class="p">)</span>
<span class="n">ts</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="n">css_string</span><span class="p">,</span> <span class="n">time_scale</span><span class="o">=</span><span class="s2">&quot;rank&quot;</span><span class="p">,</span> <span class="n">x_lim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">])</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/3c314514bd9bc27aee33177c4894b1929832dea12459fee58d1178de46edba4d.svg" src="_images/3c314514bd9bc27aee33177c4894b1929832dea12459fee58d1178de46edba4d.svg" />
</div>
</div>
</section>
<section id="leaf-sample-isolated-nodes">
<h4>Leaf, sample &amp; isolated nodes<a class="headerlink" href="#leaf-sample-isolated-nodes" title="Link to this heading">#</a></h4>
<p>By default, sample nodes are square and non-sample nodes circular (at the moment this
can’t easily be changed). However, neither need to be at specific times: sample nodes can
be at times other than 0, and nonsample nodes can be at time 0. Moreover, leaves need not
be samples, and samples need not be leaves. Here we change the previous tree sequence to
make some leaves non-samples and some samples internal nodes. To highlight the change,
we have plotted sample nodes in green, and leaf nodes (if not samples) in blue.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">swap_samples_ts</span><span class="p">():</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="n">make_unusual_ts</span><span class="p">()</span><span class="o">.</span><span class="n">dump_tables</span><span class="p">()</span>  <span class="c1"># Defined in the first SVG example</span>
    <span class="n">tables</span><span class="o">.</span><span class="n">mutations</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">tables</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">flags</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">flags</span>
    <span class="n">flags</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">tables</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span>
    <span class="k">return</span> <span class="n">tables</span><span class="o">.</span><span class="n">tree_sequence</span><span class="p">()</span>


<span class="n">ts</span> <span class="o">=</span> <span class="n">swap_samples_ts</span><span class="p">()</span>
<span class="n">css_string</span><span class="o">=</span><span class="s2">&quot;.leaf .sym {fill: blue} .sample &gt; .sym {fill: green}&quot;</span>
<span class="n">ts</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span>
    <span class="n">style</span><span class="o">=</span><span class="n">css_string</span><span class="p">,</span>
    <span class="n">x_scale</span><span class="o">=</span><span class="s2">&quot;treewise&quot;</span><span class="p">,</span>
    <span class="n">time_scale</span><span class="o">=</span><span class="s2">&quot;rank&quot;</span><span class="p">,</span>
    <span class="n">y_axis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">y_gridlines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">x_lim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/a6576c0f1f4712375136b2c87b6947f31608562fc277389eaaf01aee2b944da9.svg" src="_images/a6576c0f1f4712375136b2c87b6947f31608562fc277389eaaf01aee2b944da9.svg" />
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By definition, if a node is a sample, it must be present in every tree. This
means that there can be sample nodes which are “isolated” in a tree. These are drawn
unconnected to the main topology in one or more trees (e.g. nodes 7 and 8 above).</p>
</div>
</section>
<section id="a-fancy-formatted-plot">
<h4>A fancy formatted plot<a class="headerlink" href="#a-fancy-formatted-plot" title="Link to this heading">#</a></h4>
<p>Here we have activated the Y axis, and changed the node style. In particular, we have
coloured nodes by time, and increased the internal node symbol size while moving
the internal node labels into the symbol; node labels have also been plotted in a
sans-serif font. Axis tick labels have been changed to avoid potential overlapping (some
Y tick labels have been removed, and the X tick labels rotated).</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">msprime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">make_standard_ts</span><span class="p">():</span>
    <span class="n">seed</span><span class="o">=</span><span class="mi">370009</span>
    <span class="k">return</span> <span class="n">msprime</span><span class="o">.</span><span class="n">sim_ancestry</span><span class="p">(</span>
        <span class="mi">7</span><span class="p">,</span> <span class="n">ploidy</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sequence_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">recombination_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>


<span class="n">ts</span> <span class="o">=</span> <span class="n">make_standard_ts</span><span class="p">()</span>

<span class="c1"># Thin the tick values so we don&#39;t get labels within 0.01 of each other</span>
<span class="n">y_ticks</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">time</span>
<span class="n">y_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">y_ticks</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ediff1d</span><span class="p">(</span><span class="n">y_ticks</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.01</span><span class="p">))</span>

<span class="n">css_string</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;.tree .lab {font-family: sans-serif}&quot;</span>
    <span class="c1"># Normal X axis tick labels have dominant baseline: hanging, but it needs centring when rotated</span>
    <span class="o">+</span> <span class="s2">&quot;.x-axis .tick .lab {text-anchor: start; dominant-baseline: central; transform: rotate(90deg)}&quot;</span>
    <span class="o">+</span> <span class="s2">&quot;.y-axis .grid {stroke: #DDDDDD}&quot;</span>
    <span class="o">+</span> <span class="s2">&quot;.tree :not(.leaf).node &gt; .lab  {transform: translate(0,0); text-anchor:middle; fill: white}&quot;</span>
    <span class="o">+</span> <span class="s2">&quot;.tree :not(.leaf).node &gt; .sym {transform: scale(3.5)}&quot;</span>
    <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;.tree .n</span><span class="si">{</span><span class="n">n</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> &gt; .sym </span><span class="se">{{</span><span class="s2">fill: hsl(</span><span class="si">{</span><span class="nb">int</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">n</span><span class="o">.</span><span class="n">time</span><span class="o">/</span><span class="n">ts</span><span class="o">.</span><span class="n">max_root_time</span><span class="p">)</span><span class="o">*</span><span class="mi">260</span><span class="p">)</span><span class="si">}</span><span class="s2">, 50%, 50%)</span><span class="se">}}</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ts</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span>
      <span class="p">)</span>
<span class="p">)</span>
<span class="n">ts</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">350</span><span class="p">),</span> <span class="n">y_axis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">y_gridlines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">y_ticks</span><span class="o">=</span><span class="n">y_ticks</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">css_string</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/2d14b13a1f6af93776ffa8e05935d284ccc45312701fa806337e08b5ddaf811d.svg" src="_images/2d14b13a1f6af93776ffa8e05935d284ccc45312701fa806337e08b5ddaf811d.svg" />
</div>
</div>
</section>
<section id="ticks-labels-and-gridlines">
<h4>Ticks, labels, and gridlines<a class="headerlink" href="#ticks-labels-and-gridlines" title="Link to this heading">#</a></h4>
<p>Y tick labels can be specified explicitly, which allows time scales to be plotted
e.g. in years even if the tree sequence ticks in generations. The <code class="docutils literal notranslate"><span class="pre">title</span></code> class allows
axis titles to be moved out of the way of tick labels. Finally, grid lines associated
with each y tick can also be changed or even hidden individually using the CSS
<a class="reference external" href="https://www.w3.org/TR/2018/REC-selectors-3-20181106/#nth-child-pseudo">nth-child pseudo-selector</a>,
where tickmarks are indexed from the bottom. Below is an example of all 3 techniques,
drawing on an example from the <a class="reference internal" href="introgression.html#sec-msprime-introgression"><span class="std std-ref">Introgression</span></a> tutorial:</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">msprime</span>

<span class="n">time_units</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">/</span> <span class="mi">25</span>  <span class="c1"># Conversion factor for kya to generations</span>

<span class="k">def</span><span class="w"> </span><span class="nf">make_introgression_ts</span><span class="p">(</span><span class="n">sequence_length</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function from the introgression tutorial - see there for justification</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">demography</span> <span class="o">=</span> <span class="n">msprime</span><span class="o">.</span><span class="n">Demography</span><span class="p">()</span>
    <span class="c1"># The same size for all populations; highly unrealistic!</span>
    <span class="n">Ne</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">4</span>
    <span class="n">demography</span><span class="o">.</span><span class="n">add_population</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Africa&quot;</span><span class="p">,</span> <span class="n">initial_size</span><span class="o">=</span><span class="n">Ne</span><span class="p">)</span>
    <span class="n">demography</span><span class="o">.</span><span class="n">add_population</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Eurasia&quot;</span><span class="p">,</span> <span class="n">initial_size</span><span class="o">=</span><span class="n">Ne</span><span class="p">)</span>
    <span class="n">demography</span><span class="o">.</span><span class="n">add_population</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Neanderthal&quot;</span><span class="p">,</span> <span class="n">initial_size</span><span class="o">=</span><span class="n">Ne</span><span class="p">)</span>

    <span class="c1"># 2% introgression 50 kya</span>
    <span class="n">demography</span><span class="o">.</span><span class="n">add_mass_migration</span><span class="p">(</span>
        <span class="n">time</span><span class="o">=</span><span class="mi">50</span> <span class="o">*</span> <span class="n">time_units</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s1">&#39;Eurasia&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;Neanderthal&#39;</span><span class="p">,</span> <span class="n">proportion</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
    <span class="c1"># Eurasian &#39;merges&#39; backwards in time into Africa population, 70 kya</span>
    <span class="n">demography</span><span class="o">.</span><span class="n">add_mass_migration</span><span class="p">(</span>
        <span class="n">time</span><span class="o">=</span><span class="mi">70</span> <span class="o">*</span> <span class="n">time_units</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s1">&#39;Eurasia&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;Africa&#39;</span><span class="p">,</span> <span class="n">proportion</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Neanderthal &#39;merges&#39; backwards in time into African population, 300 kya</span>
    <span class="n">demography</span><span class="o">.</span><span class="n">add_mass_migration</span><span class="p">(</span>
        <span class="n">time</span><span class="o">=</span><span class="mi">300</span> <span class="o">*</span> <span class="n">time_units</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s1">&#39;Neanderthal&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;Africa&#39;</span><span class="p">,</span> <span class="n">proportion</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">msprime</span><span class="o">.</span><span class="n">sim_ancestry</span><span class="p">(</span>
        <span class="n">recombination_rate</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
        <span class="n">sequence_length</span><span class="o">=</span><span class="n">sequence_length</span><span class="p">,</span>  
        <span class="n">samples</span><span class="o">=</span><span class="p">[</span>
            <span class="n">msprime</span><span class="o">.</span><span class="n">SampleSet</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ploidy</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">population</span><span class="o">=</span><span class="s1">&#39;Africa&#39;</span><span class="p">),</span>
            <span class="n">msprime</span><span class="o">.</span><span class="n">SampleSet</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ploidy</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">population</span><span class="o">=</span><span class="s1">&#39;Eurasia&#39;</span><span class="p">),</span>
            <span class="c1"># Neanderthal sample taken 30 kya</span>
            <span class="n">msprime</span><span class="o">.</span><span class="n">SampleSet</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ploidy</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">30</span> <span class="o">*</span> <span class="n">time_units</span><span class="p">,</span> <span class="n">population</span><span class="o">=</span><span class="s1">&#39;Neanderthal&#39;</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="n">demography</span> <span class="o">=</span> <span class="n">demography</span><span class="p">,</span>
        <span class="n">random_seed</span><span class="o">=</span><span class="n">random_seed</span><span class="p">,</span>
    <span class="p">)</span>


<span class="n">ts</span> <span class="o">=</span> <span class="n">make_introgression_ts</span><span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">base_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1200</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">x_shift</span> <span class="o">=</span> <span class="mi">60</span>
<span class="n">css</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;.tree-sequence </span><span class="se">{{</span><span class="s2">transform: translateX(</span><span class="si">{</span><span class="n">x_shift</span><span class="si">}</span><span class="s2">px)</span><span class="se">}}</span><span class="s2">&quot;</span>  <span class="c1"># Move rightwards</span>
<span class="n">css</span> <span class="o">+=</span> <span class="s2">&quot;.sample .lab {text-anchor: start; transform: rotate(90deg) translate(6px); font-size: 80%}&quot;</span>
<span class="n">css</span> <span class="o">+=</span> <span class="s2">&quot;.x-axis .tick .lab {font-size: 85%}&quot;</span>
<span class="n">css</span> <span class="o">+=</span> <span class="s2">&quot;.y-axis .title {transform: translateY(250px)}&quot;</span>  <span class="c1"># Move out of the way of y_tick labels</span>
<span class="n">css</span> <span class="o">+=</span> <span class="s2">&quot;.y-axis .tick .grid {stroke: lightgrey}&quot;</span>  <span class="c1"># Default gridline type</span>
<span class="n">css</span> <span class="o">+=</span> <span class="s2">&quot;.y-axis .ticks .tick:nth-child(3) .grid {stroke-dasharray: 4}&quot;</span>  <span class="c1"># 3rd line from bottom</span>
<span class="n">css</span> <span class="o">+=</span> <span class="s2">&quot;.y-axis .ticks .tick:nth-child(3) .grid {stroke: magenta}&quot;</span>  <span class="c1"># also 3rd line from bottom</span>
<span class="n">css</span> <span class="o">+=</span> <span class="s2">&quot;.y-axis .ticks .tick:nth-child(4) .grid {stroke: blue}&quot;</span>  <span class="c1"># 4th line from bottom</span>
<span class="n">css</span> <span class="o">+=</span> <span class="s2">&quot;.y-axis .ticks .tick:nth-child(5) .grid {stroke: darkgrey}&quot;</span>  <span class="c1"># 5th line from bottom</span>
<span class="n">y_ticks</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
    <span class="mi">30</span><span class="p">:</span> <span class="s2">&quot;30&quot;</span><span class="p">,</span>
    <span class="mi">50</span><span class="p">:</span> <span class="s2">&quot;Introgression event&quot;</span><span class="p">,</span>
    <span class="mi">70</span><span class="p">:</span> <span class="s2">&quot;European origin&quot;</span><span class="p">,</span>
    <span class="mi">300</span><span class="p">:</span> <span class="s2">&quot;Neanderthal origin&quot;</span><span class="p">,</span>
    <span class="mi">1000</span><span class="p">:</span> <span class="s2">&quot;1000&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">ts</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span>
    <span class="n">size</span><span class="o">=</span><span class="n">base_size</span><span class="p">,</span>
    <span class="n">x_lim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25_000</span><span class="p">),</span>
    <span class="n">time_scale</span><span class="o">=</span><span class="s2">&quot;log_time&quot;</span><span class="p">,</span>
    <span class="n">node_labels</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;Africa&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;Europe&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;Neanderthal&quot;</span><span class="p">},</span>
    <span class="n">y_axis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">y_ticks</span><span class="o">=</span><span class="p">{</span><span class="n">y</span> <span class="o">*</span> <span class="n">time_units</span><span class="p">:</span> <span class="n">lab</span> <span class="k">for</span> <span class="n">y</span><span class="p">,</span> <span class="n">lab</span> <span class="ow">in</span> <span class="n">y_ticks</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
    <span class="n">y_gridlines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">style</span><span class="o">=</span><span class="n">css</span><span class="p">,</span>
    <span class="n">canvas_size</span><span class="o">=</span><span class="p">(</span><span class="n">base_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x_shift</span><span class="p">,</span> <span class="n">base_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/0874b7202c95e963ad1b07c17bc6dc7d25ea0816f2c3568f6088bf91bc865d55.svg" src="_images/0874b7202c95e963ad1b07c17bc6dc7d25ea0816f2c3568f6088bf91bc865d55.svg" />
</div>
</div>
</section>
<section id="simplifying-larger-plots">
<span id="sec-tskit-viz-svg-examples-larger-plots"></span><h4>Simplifying larger plots<a class="headerlink" href="#simplifying-larger-plots" title="Link to this heading">#</a></h4>
<p>It is common to want to visualise a tree sequence with many samples and trees. If there
are many trees, the <code class="docutils literal notranslate"><span class="pre">max_num_trees</span></code> parameter can be used to just show those at the start
and end of the genome. To reduce the size of each tree, multiple samples can be clustered
into a single representative clade. If that clade has the same set of descendant samples
throughout the tree sequence, <a class="reference internal" href="simplification.html#sec-simplification"><span class="std std-ref">Simplification</span></a> can be used to to turn the MRCA
of these samples into a sample node itself, while removing the original descendants.
By using the scaling and masking method described in
<a class="reference internal" href="#sec-tskit-viz-styling-transforming-and-masking"><span class="std std-ref">Transforming and masking elements</span></a> this summary MRCA can be shown
as a large triangle, of size proportional to the number of samples underneath it. The
example below shows how a tree sequence of 40 sample nodes can be visualised relatively
compactly using these techniques:</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">msprime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">clonal_mrcas</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">most_recent</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Identify the nodes in a tree sequence which define clonal subtrees (i.e. in which the</span>
<span class="sd">    samples descending from that node are identical and show identical relationships</span>
<span class="sd">    to each other over the entire tree sequence). This includes, at its limit, nodes</span>
<span class="sd">    with only a single descendant sample.</span>
<span class="sd">    </span>
<span class="sd">    :param bool most_recent: If True, and the clonal node is a unary node, return IDs of</span>
<span class="sd">        the most recent node that defines the clonal subtree. In this case, the returned</span>
<span class="sd">        IDs represent cases where the node is either a tip or a coalescent point.</span>
<span class="sd">    :return: a list of nodes defining constant subtrees over the entire tree sequence</span>
<span class="sd">    :rtype: list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">interval</span><span class="p">,</span> <span class="n">edges_out</span><span class="p">,</span> <span class="n">edges_in</span> <span class="ow">in</span> <span class="n">ts</span><span class="o">.</span><span class="n">edge_diffs</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">interval</span><span class="o">.</span><span class="n">left</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">is_full_length_clonal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>  <span class="c1"># nodes start clonal</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edges_in</span><span class="p">:</span>
                <span class="n">is_full_length_clonal</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">parent</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edges_out</span><span class="p">:</span>
            <span class="n">is_full_length_clonal</span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">parent</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">clonal_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">is_full_length_clonal</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">tables</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">dump_tables</span><span class="p">()</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">edges</span>
    <span class="c1"># only keep edges where both the child and the parent are full-length clonal nodes</span>
    <span class="n">keep_edge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">edges</span><span class="o">.</span><span class="n">child</span><span class="p">,</span> <span class="n">clonal_nodes</span><span class="p">),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">edges</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">clonal_nodes</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">tables</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span>
            <span class="n">left</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="n">keep_edge</span><span class="p">],</span>
            <span class="n">right</span><span class="o">=</span><span class="n">tables</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">right</span><span class="p">[</span><span class="n">keep_edge</span><span class="p">],</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">tables</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">parent</span><span class="p">[</span><span class="n">keep_edge</span><span class="p">],</span>
            <span class="n">child</span><span class="o">=</span><span class="n">tables</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">child</span><span class="p">[</span><span class="n">keep_edge</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="n">clonal_ts</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">tree_sequence</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">clonal_ts</span><span class="o">.</span><span class="n">num_trees</span> <span class="o">==</span> <span class="mi">1</span>

    <span class="c1"># Also remove all the edges ascending from removed edges</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">clonal_ts</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="n">non_clonal_ancestors</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">deleted_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">keep_edge</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">edges_parent</span><span class="p">[</span><span class="n">deleted_edges</span><span class="p">]):</span>
        <span class="k">while</span> <span class="n">u</span> <span class="o">!=</span> <span class="n">tskit</span><span class="o">.</span><span class="n">NULL</span> <span class="ow">and</span> <span class="n">u</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">non_clonal_ancestors</span><span class="p">:</span>
            <span class="n">non_clonal_ancestors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="n">non_clonal_ancestors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">non_clonal_ancestors</span><span class="p">))</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="n">clonal_ts</span><span class="o">.</span><span class="n">dump_tables</span><span class="p">()</span>
    <span class="n">remove_edge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">tables</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">non_clonal_ancestors</span><span class="p">)</span>
    <span class="n">tables</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">replace_with</span><span class="p">(</span><span class="n">tables</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">remove_edge</span><span class="p">)])</span>
    <span class="n">clonal_ts</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">tree_sequence</span><span class="p">()</span>   
    
    <span class="n">tree</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="n">sample_lists</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">clonal_tree</span> <span class="o">=</span> <span class="n">clonal_ts</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="n">sample_lists</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">clonal_nodes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">root</span> <span class="ow">in</span> <span class="n">clonal_tree</span><span class="o">.</span><span class="n">roots</span><span class="p">:</span>
        <span class="c1"># Clonal trees should subtend the same set of samples as in the original tree</span>
        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">samples</span><span class="p">(</span><span class="n">root</span><span class="p">))</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">clonal_tree</span><span class="o">.</span><span class="n">samples</span><span class="p">(</span><span class="n">root</span><span class="p">))</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">root</span>
        <span class="k">if</span> <span class="n">most_recent</span><span class="p">:</span>
            <span class="c1"># decend to the first coalescent node (i.e. MRCA)</span>
            <span class="k">while</span> <span class="n">clonal_tree</span><span class="o">.</span><span class="n">num_children</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">clonal_tree</span><span class="o">.</span><span class="n">children</span><span class="p">(</span><span class="n">u</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">clonal_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">clonal_nodes</span>

<span class="n">ts</span> <span class="o">=</span> <span class="n">msprime</span><span class="o">.</span><span class="n">sim_ancestry</span><span class="p">(</span>
        <span class="mi">20</span><span class="p">,</span> <span class="n">population_size</span><span class="o">=</span><span class="mf">1e2</span><span class="p">,</span> <span class="n">sequence_length</span><span class="o">=</span><span class="mf">1e4</span><span class="p">,</span> <span class="n">recombination_rate</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">83</span><span class="p">)</span>
<span class="n">clones</span> <span class="o">=</span> <span class="n">clonal_mrcas</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
<span class="c1"># Simplify but keep the same node IDs using filter_nodes=False</span>
<span class="n">ts_simp</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">clones</span><span class="p">,</span> <span class="n">filter_nodes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">styles</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;.node &gt; .lab {font-size: 9px}&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.leaf &gt; .lab {text-anchor: start; transform: rotate(90deg) translate(5px); font-size: 12px}&quot;</span><span class="p">,</span>

<span class="p">]</span>

<span class="n">node_labels</span> <span class="o">=</span> <span class="p">{</span><span class="n">u</span><span class="p">:</span> <span class="n">u</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">)}</span>
<span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">ts</span><span class="o">.</span><span class="n">samples</span><span class="p">():</span>
    <span class="n">node_labels</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;S</span><span class="si">{</span><span class="n">u</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">clones</span><span class="p">:</span>
    <span class="n">num_samples</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">num_samples</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">num_samples</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">node_labels</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">num_samples</span><span class="si">}</span><span class="s2"> samples&quot;</span>
        <span class="n">styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;.n</span><span class="si">{</span><span class="n">u</span><span class="si">}</span><span class="s2"> &gt; .sym </span><span class="se">{{</span><span class="s2">clip-path: polygon(50% 50%, 100% 100%, 0% 100%);&quot;</span><span class="o">+</span>
            <span class="sa">f</span><span class="s2">&quot;transform: scale(</span><span class="si">{</span><span class="p">(</span><span class="n">num_samples</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">, 4.0)</span><span class="se">}}</span><span class="s2">&quot;</span> <span class="o">+</span>
            <span class="sa">f</span><span class="s2">&quot;.n</span><span class="si">{</span><span class="n">u</span><span class="si">}</span><span class="s2"> &gt; .lab </span><span class="se">{{</span><span class="s2">transform: rotate(90deg) translate(15px); font-size: 13px</span><span class="se">}}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
<span class="n">ts_simp</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span>
    <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span>
    <span class="n">style</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">styles</span><span class="p">),</span>
    <span class="n">node_labels</span><span class="o">=</span><span class="n">node_labels</span><span class="p">,</span>
    <span class="n">time_scale</span><span class="o">=</span><span class="s2">&quot;log_time&quot;</span><span class="p">,</span>
    <span class="n">y_axis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">y_ticks</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
    <span class="n">max_num_trees</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/3fb39c9c82211b1e5ebea39e4a107b84167230004fb76de59c7973f7441b33ad.svg" src="_images/3fb39c9c82211b1e5ebea39e4a107b84167230004fb76de59c7973f7441b33ad.svg" />
</div>
</div>
</section>
<section id="d-effects">
<span id="sec-tskit-viz-svg-examples-3d"></span><h4>3D effects<a class="headerlink" href="#d-effects" title="Link to this heading">#</a></h4>
<p>We can use various CSS transforms, as
<a class="reference internal" href="#sec-tskit-viz-styling-transforming-and-masking"><span class="std std-ref">discussed previously</span></a>,
to skew the trees and stagger them. With a bit of trigonometry,
this can create flexible and tolerably good 3D effects for presentations, etc.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">msprime</span>

<span class="k">def</span><span class="w"> </span><span class="nf">make_7_tree_4_tip_ts</span><span class="p">():</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">msprime</span><span class="o">.</span><span class="n">sim_ancestry</span><span class="p">(</span>
        <span class="mi">4</span><span class="p">,</span> <span class="n">ploidy</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">889</span><span class="p">,</span> <span class="n">sequence_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">recombination_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">msprime</span><span class="o">.</span><span class="n">sim_mutations</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="mf">2e-3</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>

    <span class="c1"># Check we have picked a random seed that gives a nice plot of 7 trees</span>
    <span class="n">tip_orders</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nb">tuple</span><span class="p">(</span><span class="n">u</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s2">&quot;minlex_postorder&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">is_sample</span><span class="p">(</span><span class="n">u</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ts</span><span class="o">.</span><span class="n">trees</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="n">topologies</span> <span class="o">=</span> <span class="p">{</span><span class="n">tree</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">ts</span><span class="o">.</span><span class="n">trees</span><span class="p">()}</span>
    <span class="k">assert</span> <span class="n">tip_orders</span> <span class="o">==</span> <span class="p">{(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)}</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">topologies</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">ts</span><span class="o">.</span><span class="n">num_trees</span> <span class="o">==</span> <span class="mi">7</span>

    <span class="k">return</span> <span class="n">ts</span>


<span class="n">ts</span> <span class="o">=</span> <span class="n">make_7_tree_4_tip_ts</span><span class="p">()</span>

<span class="c1"># Set some parameters: these can be adjusted to your liking</span>
<span class="n">tree_width</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">height</span> <span class="o">=</span> <span class="mi">200</span> <span class="c1"># Normal height for tree + x-axis</span>
<span class="n">y_step</span> <span class="o">=</span> <span class="mi">40</span>  <span class="c1"># Stagger between trees (i.e. 0 for all trees in a horizontal line)</span>
<span class="n">skew</span> <span class="o">=</span> <span class="mf">0.6</span>  <span class="c1"># How skewed the trees are, in radians</span>

<span class="n">width</span> <span class="o">=</span> <span class="n">tree_width</span> <span class="o">*</span> <span class="n">ts</span><span class="o">.</span><span class="n">num_trees</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">+</span> <span class="mi">20</span>  <span class="c1"># L &amp; R margins in draw_svg = 20px</span>
<span class="n">angle</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span><span class="n">y_step</span><span class="o">/</span><span class="n">tree_width</span><span class="p">)</span>
<span class="n">ax_mv</span> <span class="o">=</span> <span class="n">y_step</span><span class="p">,</span> <span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">num_trees</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">y_step</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">skew</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">tree_width</span> <span class="o">*</span> <span class="mf">.9</span><span class="p">)</span>

<span class="c1"># CSS transforms used to skew the axis and stagger + skew the trees</span>
<span class="n">style</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;.x-axis </span><span class="se">{{</span><span class="s2">transform: translate(</span><span class="si">{</span><span class="n">ax_mv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">px, </span><span class="si">{</span><span class="n">ax_mv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">px) skewY(-</span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2">rad)</span><span class="se">}}</span><span class="s2">&quot;</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">num_trees</span><span class="p">):</span>
    <span class="c1"># Stagger each tree vertically by y_step, transforming the &quot;plotbox&quot; tree container</span>
    <span class="n">style</span> <span class="o">+=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;.tree.t</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> &gt; .plotbox &quot;</span> <span class="o">+</span> <span class="s2">&quot;{transform:&quot;</span> <span class="o">+</span>
        <span class="sa">f</span><span class="s2">&quot;translateY(</span><span class="si">{</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">num_trees</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y_step</span><span class="si">}</span><span class="s2">px) skewY(</span><span class="si">{</span><span class="n">skew</span><span class="si">}</span><span class="s2">rad)&quot;</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
    <span class="p">)</span>

<span class="c1"># Define a bigger canvas size so we don&#39;t crop the moved trees from the drawing</span>
<span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
<span class="n">canvas_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span> <span class="o">+</span> <span class="n">y_step</span><span class="p">,</span> <span class="n">height</span> <span class="o">+</span> <span class="n">ts</span><span class="o">.</span><span class="n">num_trees</span><span class="o">*</span><span class="n">y_step</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">skew</span><span class="p">)</span><span class="o">*</span><span class="n">tree_width</span><span class="p">)</span>

<span class="n">ts</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">x_scale</span><span class="o">=</span><span class="s2">&quot;treewise&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span> <span class="n">canvas_size</span><span class="o">=</span><span class="n">canvas_size</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/00fc0c8798f185e38f14d6e7236989f8cd0da3eb11f9f8e0d12f7d43fc576ee3.svg" src="_images/00fc0c8798f185e38f14d6e7236989f8cd0da3eb11f9f8e0d12f7d43fc576ee3.svg" />
</div>
</div>
</section>
<section id="animation">
<span id="sec-tskit-viz-svg-examples-animation"></span><h4>Animation<a class="headerlink" href="#animation" title="Link to this heading">#</a></h4>
<p>The classes attached to the SVG also allow elements to be animated. Here’s a
<a class="reference external" href="https://d3js.org">d3.js</a>-based animation of sucessive subtree-prune-and-regraft (SPR)
operations, using the <a class="reference external" href="https://tskit.dev/msprime/docs/stable/ancestry.html#sec-ancestry-full-arg" title="(in Project name not set)"><span class="xref std std-ref">ARG representation</span></a> of a
tree sequence to allow identification of pruned edges.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">HTML</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">msprime</span>

<span class="k">def</span><span class="w"> </span><span class="nf">make_full_arg_for_spr_animation</span><span class="p">():</span>
    <span class="c1"># created with record_full_arg needed to track recombination nodes (branch positions)</span>
    <span class="c1"># random_seed chosen to produce a ts whose leaves are plotted in the same order</span>
    <span class="k">return</span> <span class="n">msprime</span><span class="o">.</span><span class="n">sim_ancestry</span><span class="p">(</span>
        <span class="mi">5</span><span class="p">,</span> <span class="n">ploidy</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">sequence_length</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
        <span class="n">recombination_rate</span><span class="o">=</span><span class="mf">0.00005</span><span class="p">,</span>
        <span class="n">random_seed</span><span class="o">=</span><span class="mi">6787</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;smc_prime&quot;</span><span class="p">,</span> <span class="n">record_full_arg</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                
   

<span class="n">css_string</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;#anim_svg {background-color: white} &quot;</span>
    <span class="s2">&quot;#anim_svg .node:not(.sample) &gt; .lab, #anim_svg .node:not(.sample) &gt; .sym {display: none}&quot;</span>
<span class="p">)</span>
<span class="n">html_string</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="si">%s</span>
<span class="s2">&lt;script type=&quot;text/javascript&quot; src=&quot;https://d3js.org/d3.v4.min.js&quot;&gt;&lt;/script&gt;</span>
<span class="s2">&lt;script type=&quot;text/javascript&quot;&gt;</span>
<span class="s2">function diff(A) {return A.slice(1).map((n, i) =&gt; { return n - A[i]; });};</span>
<span class="s2">function mean(A) {return A.reduce((sum, a) =&gt; { return 0 + sum + a },0)/(A.length||1);};</span>
<span class="s2">function getRelativeXY(canvas, element, x, y) {</span>
<span class="s2">  var p = canvas._groups[0][0].createSVGPoint();</span>
<span class="s2">  var ctm = element.getCTM();</span>
<span class="s2">  p.x = x || 0;</span>
<span class="s2">  p.y = y || 0;</span>
<span class="s2">  return p.matrixTransform(ctm);</span>
<span class="s2">};</span>

<span class="s2">function animate_SPR(canvas, num_trees) {</span>
<span class="s2">  d3.selectAll(&quot;#anim_svg .tree&quot;).attr(&quot;opacity&quot;, 0);</span>
<span class="s2">  for(var i=0; i&lt;num_trees - 1; i++) </span>
<span class="s2">  {</span>
<span class="s2">    var source_tree = &quot;#anim_svg .tree.t&quot; + i;</span>
<span class="s2">    var target_tree = &quot;#anim_svg .tree.t&quot; + (i+1);</span>
<span class="s2">    var dur = 2000;</span>
<span class="s2">    var delay = i * dur;</span>
<span class="s2">    d3.select(source_tree)</span>
<span class="s2">      .datum(function() { return d3.select(this).attr(&quot;transform&quot;)}) // store the original value</span>
<span class="s2">      .transition()</span>
<span class="s2">      .on(&quot;start&quot;, function() {d3.select(this).attr(&quot;opacity&quot;, &quot;1&quot;);}) </span>
<span class="s2">      .delay(delay)</span>
<span class="s2">      .duration(dur)</span>
<span class="s2">      .attr(</span>
<span class="s2">        &quot;transform&quot;, d3.select(target_tree).attr(&quot;transform&quot;))</span>
<span class="s2">      .on(&quot;end&quot;, function() {</span>
<span class="s2">        d3.select(this).attr(&quot;opacity&quot;, &quot;0&quot;);</span>
<span class="s2">        d3.select(this).attr(&quot;transform&quot;, d3.select(this).datum()); // reset</span>
<span class="s2">      });</span>
<span class="s2">    transform_tree(canvas, source_tree, target_tree, dur, delay);</span>
<span class="s2">  }</span>
<span class="s2">};</span>

<span class="s2">// NB - this is buggy and doesn&#39;t correctly reset the transformations on the elements</span>
<span class="s2">// because it is hard to put the subtree back into the correct place in the hierarchy</span>

<span class="s2">function transform_tree(canvas, src_tree, target_tree, dur, delay) {</span>
<span class="s2">  canvas.selectAll(src_tree + &quot; .node&quot;).each(function() {</span>
<span class="s2">    var n_ids = d3.select(this).attr(&quot;class&quot;).split(/\s+/g).filter(x=&gt;x.match(/^n\d/));</span>
<span class="s2">    if (n_ids.length != 1) {alert(&quot;Bad node classes in SVG tree&quot;)};</span>
<span class="s2">    var node_id = n_ids[0].replace(/^n/, &quot;&quot;)</span>
<span class="s2">    var src = src_tree + &quot; .node.n&quot; + node_id;</span>
<span class="s2">    var target = target_tree + &quot; .node.n&quot; + node_id;</span>

<span class="s2">    if (d3.select(src).nodes()[0] &amp;&amp; d3.select(target).nodes()[0]) {</span>
<span class="s2">      // The same source and target edges exist, so we can simply move them</span>
<span class="s2">      d3.select(src).transition()</span>
<span class="s2">        .delay(delay)</span>
<span class="s2">        .duration(dur)</span>
<span class="s2">        .attr(&quot;transform&quot;, d3.select(target).attr(&quot;transform&quot;))</span>
<span class="s2">      var selection = d3.select(src + &quot; &gt; .edge&quot;);</span>
<span class="s2">      if (!selection.empty()) { // the root may not have an edge</span>
<span class="s2">        selection.transition()</span>
<span class="s2">          .delay(delay)</span>
<span class="s2">          .duration(dur)</span>
<span class="s2">          .attr(&quot;d&quot;, d3.select(target +&quot; &gt; .edge&quot;).attr(&quot;d&quot;))</span>
<span class="s2">      }</span>
<span class="s2">    } else {</span>
<span class="s2">      // No matching node: this could be a recombination</span>
<span class="s2">      // Hack: the equivalent recombination node is the next one labelled</span>
<span class="s2">      var target = target_tree + &quot; .node.n&quot; + (1+parseInt(node_id));</span>
<span class="s2">      // Extract the edge</span>
<span class="s2">      src_tree_pos = getRelativeXY(canvas, d3.select(src_tree).node());</span>
<span class="s2">      target_tree_pos = getRelativeXY(canvas, d3.select(target_tree).node());</span>
<span class="s2">      src_xy = getRelativeXY(canvas, d3.select(src).node());</span>
<span class="s2">      target_xy = getRelativeXY(canvas, d3.select(target).node());</span>
<span class="s2">      // Move the subtree out of the hierarchy and into the local tree space,</span>
<span class="s2">      // so that movements of the containing hierarchy do not affect position</span>
<span class="s2">      d3.select(src_tree).append(</span>
<span class="s2">        () =&gt; d3.select(src)</span>
<span class="s2">          .attr(</span>
<span class="s2">            &quot;transform&quot;,</span>
<span class="s2">            &quot;translate(&quot; + (src_xy.x - src_tree_pos.x) + &quot; &quot; + (src_xy.y - src_tree_pos.y) + &quot;)&quot;</span>
<span class="s2">          )</span>
<span class="s2">          .remove()</span>
<span class="s2">          .node()</span>
<span class="s2">      );</span>
<span class="s2">      d3.select(src).transition()</span>
<span class="s2">        .delay(delay)</span>
<span class="s2">        .duration(dur)</span>
<span class="s2">        .attr(</span>
<span class="s2">          &quot;transform&quot;,</span>
<span class="s2">          &quot;translate(&quot; + (target_xy.x-target_tree_pos.x) + &quot; &quot; + (target_xy.y-target_tree_pos.y) + &quot;)&quot;)</span>
<span class="s2">      selection = d3.select(src + &quot; &gt; .edge&quot;);</span>
<span class="s2">      if (!selection.empty()) {</span>
<span class="s2">        selection.transition()</span>
<span class="s2">          .delay(delay)</span>
<span class="s2">          .duration(dur)</span>
<span class="s2">          .attr(&quot;d&quot;, d3.select(target +&quot; &gt; .edge&quot;).attr(&quot;d&quot;))</span>
<span class="s2">      }</span>
<span class="s2">    }</span>
<span class="s2">  })</span>
<span class="s2">};</span>

<span class="s2">var svg_text = document.getElementById(&quot;anim_svg&quot;).innerHTML;</span>

<span class="s2">&lt;/script&gt;</span>

<span class="s2">&lt;button onclick=&#39;animate_SPR(d3.select(&quot;#anim_svg&quot;), </span><span class="si">%s</span><span class="s2">);&#39;&gt;Animate&lt;/button&gt;</span>
<span class="s2">&lt;button onclick=&#39;document.getElementById(&quot;anim_svg&quot;).innerHTML = svg_text;&#39;&gt;Reset&lt;/button&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">ts</span> <span class="o">=</span> <span class="n">make_full_arg_for_spr_animation</span><span class="p">()</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">html_string</span> <span class="o">%</span> <span class="p">(</span>
    <span class="n">ts</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span><span class="n">root_svg_attributes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;anim_svg&quot;</span><span class="p">},</span> <span class="n">style</span><span class="o">=</span><span class="n">css_string</span><span class="p">),</span>
    <span class="n">ts</span><span class="o">.</span><span class="n">num_trees</span><span class="p">,</span>
<span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
<svg baseProfile="full" height="200" id="anim_svg" version="1.1" width="800" xmlns="http://www.w3.org/2000/svg" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><style type="text/css"><![CDATA[.background path {fill: #808080; fill-opacity: 0}.background path:nth-child(odd) {fill-opacity: .1}.x-regions rect {fill: yellow; stroke: black; opacity: 0.5}.axes {font-size: 14px}.x-axis .tick .lab {font-weight: bold; dominant-baseline: hanging}.axes, .tree {font-size: 14px; text-anchor: middle}.axes line, .edge {stroke: black; fill: none}.axes .ax-skip {stroke-dasharray: 4}.y-axis .grid {stroke: #FAFAFA}.node > .sym {fill: black; stroke: none}.site > .sym {stroke: black}.mut text {fill: red; font-style: italic}.mut.extra text {fill: hotpink}.mut line {fill: none; stroke: none}.mut .sym {fill: none; stroke: red}.mut.extra .sym {stroke: hotpink}.node .mut .sym {stroke-width: 1.5px}.tree text, .tree-sequence text {dominant-baseline: central}.plotbox .lab.lft {text-anchor: end}.plotbox .lab.rgt {text-anchor: start}.polytomy line {stroke: black; stroke-dasharray: 1px, 1px}.polytomy text {paint-order:stroke;stroke-width:0.3em;stroke:white}#anim_svg {background-color: white} #anim_svg .node:not(.sample) > .lab, #anim_svg .node:not(.sample) > .sym {display: none}]]></style></defs><g class="tree-sequence"><g class="background"><path d="M20,0 l190,0 l0,138.2 l-133.684,25 l0,5 l-56.316,0 l0,-5 l0,-25 l0,-138.2z"/><path d="M210,0 l190,0 l0,138.2 l-275.044,25 l0,5 l-48.64,0 l0,-5 l133.684,-25 l0,-138.2z"/><path d="M400,0 l190,0 l0,138.2 l-321.1,25 l0,5 l-143.944,0 l0,-5 l275.044,-25 l0,-138.2z"/><path d="M590,0 l190,0 l0,138.2 l0,25 l0,5 l-511.1,0 l0,-5 l321.1,-25 l0,-138.2z"/></g><g class="axes"><g class="x-axis"><g class="title" transform="translate(400 200)"><text class="lab" text-anchor="middle" transform="translate(0 -11)">Genome position</text></g><line class="ax-line" x1="20" x2="780" y1="163.2" y2="163.2"/><g class="ticks"><g class="tick" transform="translate(20 163.2)"><line x1="0" x2="0" y1="0" y2="5"/><g transform="translate(0 6)"><text class="lab">0</text></g></g><g class="tick" transform="translate(76.316 163.2)"><line x1="0" x2="0" y1="0" y2="5"/><g transform="translate(0 6)"><text class="lab">741</text></g></g><g class="tick" transform="translate(124.956 163.2)"><line x1="0" x2="0" y1="0" y2="5"/><g transform="translate(0 6)"><text class="lab">1381</text></g></g><g class="tick" transform="translate(268.9 163.2)"><line x1="0" x2="0" y1="0" y2="5"/><g transform="translate(0 6)"><text class="lab">3275</text></g></g><g class="tick" transform="translate(780 163.2)"><line x1="0" x2="0" y1="0" y2="5"/><g transform="translate(0 6)"><text class="lab">10000</text></g></g></g></g></g><g class="plotbox trees"><g class="tree t0" transform="translate(20 0)"><g class="plotbox"><g class="c2 node n17 p0 root" transform="translate(63.125 26.8)"><g class="a17 c1 node n14 p0" transform="translate(-28.125 56.0486)"><g class="a14 i0 leaf node n0 p0 sample" transform="translate(0.0 38.5514)"><path class="edge e12" d="M 0 0 V -38.5514 H 0.0"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">0</text></g><path class="edge e18" d="M 0 0 V -56.0486 H 28.125"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">14</text></g><g class="a17 c2 node n16 p0" transform="translate(28.125 13.7141)"><g class="a16 c1 node n11 p0" transform="translate(-26.25 52.4955)"><g class="a11 c1 node n9 p0" transform="translate(0.0 12.2467)"><g class="a9 c1 node n8 p0" transform="translate(0.0 1.51859)"><g class="a8 i1 leaf node n1 p0 sample" transform="translate(0.0 14.6251)"><path class="edge e4" d="M 0 0 V -14.6251 H 0.0"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">1</text></g><path class="edge e6" d="M 0 0 V -1.51859 H 0.0"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">8</text></g><path class="edge e8" d="M 0 0 V -12.2467 H 0.0"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">9</text></g><path class="edge e16" d="M 0 0 V -52.4955 H 26.25"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">11</text></g><g class="a16 c2 node n15 p0" transform="translate(26.25 41.8551)"><g class="a15 c1 node n6 p0" transform="translate(-22.5 31.2782)"><g class="a6 i2 leaf node n2 p0 sample" transform="translate(0.0 7.75268)"><path class="edge e2" d="M 0 0 V -7.75268 H 0.0"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">2</text></g><path class="edge e14" d="M 0 0 V -31.2782 H 22.5"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">6</text></g><g class="a15 c1 node n13 p0" transform="translate(22.5 10.5342)"><g class="a13 c2 node n5 p0" transform="translate(0.0 27.5932)"><g class="a5 i3 leaf node n3 p0 sample" transform="translate(-15 0.903508)"><path class="edge e0" d="M 0 0 V -0.903508 H 15"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">3</text></g><g class="a5 i4 leaf node n4 p0 sample" transform="translate(15 0.903508)"><path class="edge e1" d="M 0 0 V -0.903508 H -15"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">4</text></g><path class="edge e10" d="M 0 0 V -27.5932 H 0.0"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">5</text></g><path class="edge e15" d="M 0 0 V -10.5342 H -22.5"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab rgt" transform="translate(3 -7)">13</text></g><path class="edge e17" d="M 0 0 V -41.8551 H -26.25"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab rgt" transform="translate(3 -7)">15</text></g><path class="edge e19" d="M 0 0 V -13.7141 H -28.125"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab rgt" transform="translate(3 -7)">16</text></g><circle class="sym" cx="0" cy="0" r="3"/><text class="lab" transform="translate(0 -11)">17</text></g></g></g><g class="tree t1" transform="translate(210 0)"><g class="plotbox"><g class="c2 node n17 p0 root" transform="translate(72.5 26.8)"><g class="a17 c1 node n14 p0" transform="translate(-37.5 56.0486)"><g class="a14 i0 leaf node n0 p0 sample" transform="translate(0.0 38.5514)"><path class="edge e12" d="M 0 0 V -38.5514 H 0.0"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">0</text></g><path class="edge e18" d="M 0 0 V -56.0486 H 37.5"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">14</text></g><g class="a17 c2 node n16 p0" transform="translate(37.5 13.7141)"><g class="a16 c1 node n11 p0" transform="translate(-30 52.4955)"><g class="a11 c1 node n9 p0" transform="translate(0.0 12.2467)"><g class="a9 c2 node n8 p0" transform="translate(0.0 1.51859)"><g class="a8 i1 leaf node n1 p0 sample" transform="translate(-15 14.6251)"><path class="edge e4" d="M 0 0 V -14.6251 H 15"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">1</text></g><g class="a8 c1 node n7 p0" transform="translate(15 6.87247)"><g class="a7 i2 leaf node n2 p0 sample" transform="translate(0.0 7.75268)"><path class="edge e3" d="M 0 0 V -7.75268 H 0.0"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">2</text></g><path class="edge e5" d="M 0 0 V -6.87247 H -15"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab rgt" transform="translate(3 -7)">7</text></g><path class="edge e6" d="M 0 0 V -1.51859 H 0.0"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">8</text></g><path class="edge e8" d="M 0 0 V -12.2467 H 0.0"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">9</text></g><path class="edge e16" d="M 0 0 V -52.4955 H 30"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">11</text></g><g class="a16 c1 node n15 p0" transform="translate(30 41.8551)"><g class="a15 c1 node n13 p0" transform="translate(0.0 10.5342)"><g class="a13 c2 node n5 p0" transform="translate(0.0 27.5932)"><g class="a5 i3 leaf node n3 p0 sample" transform="translate(-15 0.903508)"><path class="edge e0" d="M 0 0 V -0.903508 H 15"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">3</text></g><g class="a5 i4 leaf node n4 p0 sample" transform="translate(15 0.903508)"><path class="edge e1" d="M 0 0 V -0.903508 H -15"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">4</text></g><path class="edge e10" d="M 0 0 V -27.5932 H 0.0"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">5</text></g><path class="edge e15" d="M 0 0 V -10.5342 H 0.0"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">13</text></g><path class="edge e17" d="M 0 0 V -41.8551 H -30"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab rgt" transform="translate(3 -7)">15</text></g><path class="edge e19" d="M 0 0 V -13.7141 H -37.5"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab rgt" transform="translate(3 -7)">16</text></g><circle class="sym" cx="0" cy="0" r="3"/><text class="lab" transform="translate(0 -11)">17</text></g></g></g><g class="tree t2" transform="translate(400 0)"><g class="plotbox"><g class="c2 node n17 p0 root" transform="translate(98.75 26.8)"><g class="a17 c2 node n14 p0" transform="translate(-41.25 56.0486)"><g class="a14 i0 leaf node n0 p0 sample" transform="translate(-22.5 38.5514)"><path class="edge e12" d="M 0 0 V -38.5514 H 22.5"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">0</text></g><g class="a14 c1 node n12 p0" transform="translate(22.5 10.1609)"><g class="a12 c1 node n9 p0" transform="translate(0.0 12.2467)"><g class="a9 c2 node n8 p0" transform="translate(0.0 1.51859)"><g class="a8 i1 leaf node n1 p0 sample" transform="translate(-15 14.6251)"><path class="edge e4" d="M 0 0 V -14.6251 H 15"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">1</text></g><g class="a8 c1 node n7 p0" transform="translate(15 6.87247)"><g class="a7 i2 leaf node n2 p0 sample" transform="translate(0.0 7.75268)"><path class="edge e3" d="M 0 0 V -7.75268 H 0.0"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">2</text></g><path class="edge e5" d="M 0 0 V -6.87247 H -15"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab rgt" transform="translate(3 -7)">7</text></g><path class="edge e6" d="M 0 0 V -1.51859 H 0.0"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">8</text></g><path class="edge e9" d="M 0 0 V -12.2467 H 0.0"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">9</text></g><path class="edge e13" d="M 0 0 V -10.1609 H -22.5"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab rgt" transform="translate(3 -7)">12</text></g><path class="edge e18" d="M 0 0 V -56.0486 H 41.25"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">14</text></g><g class="a17 c1 node n16 p0" transform="translate(41.25 13.7141)"><g class="a16 c1 node n15 p0" transform="translate(0.0 41.8551)"><g class="a15 c1 node n13 p0" transform="translate(0.0 10.5342)"><g class="a13 c2 node n5 p0" transform="translate(0.0 27.5932)"><g class="a5 i3 leaf node n3 p0 sample" transform="translate(-15 0.903508)"><path class="edge e0" d="M 0 0 V -0.903508 H 15"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">3</text></g><g class="a5 i4 leaf node n4 p0 sample" transform="translate(15 0.903508)"><path class="edge e1" d="M 0 0 V -0.903508 H -15"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">4</text></g><path class="edge e10" d="M 0 0 V -27.5932 H 0.0"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">5</text></g><path class="edge e15" d="M 0 0 V -10.5342 H 0.0"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">13</text></g><path class="edge e17" d="M 0 0 V -41.8551 H 0.0"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">15</text></g><path class="edge e19" d="M 0 0 V -13.7141 H -41.25"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab rgt" transform="translate(3 -7)">16</text></g><circle class="sym" cx="0" cy="0" r="3"/><text class="lab" transform="translate(0 -11)">17</text></g></g></g><g class="tree t3" transform="translate(590 0)"><g class="plotbox"><g class="c2 node n17 p0 root" transform="translate(72.5 26.8)"><g class="a17 c1 node n14 p0" transform="translate(-37.5 56.0486)"><g class="a14 i0 leaf node n0 p0 sample" transform="translate(0.0 38.5514)"><path class="edge e12" d="M 0 0 V -38.5514 H 0.0"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">0</text></g><path class="edge e18" d="M 0 0 V -56.0486 H 37.5"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">14</text></g><g class="a17 c1 node n16 p0" transform="translate(37.5 13.7141)"><g class="a16 c1 node n15 p0" transform="translate(0.0 41.8551)"><g class="a15 c2 node n13 p0" transform="translate(0.0 10.5342)"><g class="a13 c2 node n5 p0" transform="translate(30 27.5932)"><g class="a5 i3 leaf node n3 p0 sample" transform="translate(-15 0.903508)"><path class="edge e0" d="M 0 0 V -0.903508 H 15"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">3</text></g><g class="a5 i4 leaf node n4 p0 sample" transform="translate(15 0.903508)"><path class="edge e1" d="M 0 0 V -0.903508 H -15"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">4</text></g><path class="edge e10" d="M 0 0 V -27.5932 H -30"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab rgt" transform="translate(3 -7)">5</text></g><g class="a13 c1 node n10 p0" transform="translate(-30 12.353)"><g class="a10 c2 node n8 p0" transform="translate(0.0 1.51859)"><g class="a8 i1 leaf node n1 p0 sample" transform="translate(-15 14.6251)"><path class="edge e4" d="M 0 0 V -14.6251 H 15"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">1</text></g><g class="a8 c1 node n7 p0" transform="translate(15 6.87247)"><g class="a7 i2 leaf node n2 p0 sample" transform="translate(0.0 7.75268)"><path class="edge e3" d="M 0 0 V -7.75268 H 0.0"/><rect class="sym" height="6" width="6" x="-3" y="-3"/><text class="lab" transform="translate(0 11)">2</text></g><path class="edge e5" d="M 0 0 V -6.87247 H -15"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab rgt" transform="translate(3 -7)">7</text></g><path class="edge e7" d="M 0 0 V -1.51859 H 0.0"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">8</text></g><path class="edge e11" d="M 0 0 V -12.353 H 30"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">10</text></g><path class="edge e15" d="M 0 0 V -10.5342 H 0.0"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">13</text></g><path class="edge e17" d="M 0 0 V -41.8551 H 0.0"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab lft" transform="translate(-3 -7)">15</text></g><path class="edge e19" d="M 0 0 V -13.7141 H -37.5"/><circle class="sym" cx="0" cy="0" r="3"/><text class="lab rgt" transform="translate(3 -7)">16</text></g><circle class="sym" cx="0" cy="0" r="3"/><text class="lab" transform="translate(0 -11)">17</text></g></g></g></g></g></svg>
<script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>
<script type="text/javascript">
function diff(A) {return A.slice(1).map((n, i) => { return n - A[i]; });};
function mean(A) {return A.reduce((sum, a) => { return 0 + sum + a },0)/(A.length||1);};
function getRelativeXY(canvas, element, x, y) {
  var p = canvas._groups[0][0].createSVGPoint();
  var ctm = element.getCTM();
  p.x = x || 0;
  p.y = y || 0;
  return p.matrixTransform(ctm);
};

function animate_SPR(canvas, num_trees) {
  d3.selectAll("#anim_svg .tree").attr("opacity", 0);
  for(var i=0; i<num_trees - 1; i++) 
  {
    var source_tree = "#anim_svg .tree.t" + i;
    var target_tree = "#anim_svg .tree.t" + (i+1);
    var dur = 2000;
    var delay = i * dur;
    d3.select(source_tree)
      .datum(function() { return d3.select(this).attr("transform")}) // store the original value
      .transition()
      .on("start", function() {d3.select(this).attr("opacity", "1");}) 
      .delay(delay)
      .duration(dur)
      .attr(
        "transform", d3.select(target_tree).attr("transform"))
      .on("end", function() {
        d3.select(this).attr("opacity", "0");
        d3.select(this).attr("transform", d3.select(this).datum()); // reset
      });
    transform_tree(canvas, source_tree, target_tree, dur, delay);
  }
};

// NB - this is buggy and doesn't correctly reset the transformations on the elements
// because it is hard to put the subtree back into the correct place in the hierarchy

function transform_tree(canvas, src_tree, target_tree, dur, delay) {
  canvas.selectAll(src_tree + " .node").each(function() {
    var n_ids = d3.select(this).attr("class").split(/\s+/g).filter(x=>x.match(/^n\d/));
    if (n_ids.length != 1) {alert("Bad node classes in SVG tree")};
    var node_id = n_ids[0].replace(/^n/, "")
    var src = src_tree + " .node.n" + node_id;
    var target = target_tree + " .node.n" + node_id;

    if (d3.select(src).nodes()[0] && d3.select(target).nodes()[0]) {
      // The same source and target edges exist, so we can simply move them
      d3.select(src).transition()
        .delay(delay)
        .duration(dur)
        .attr("transform", d3.select(target).attr("transform"))
      var selection = d3.select(src + " > .edge");
      if (!selection.empty()) { // the root may not have an edge
        selection.transition()
          .delay(delay)
          .duration(dur)
          .attr("d", d3.select(target +" > .edge").attr("d"))
      }
    } else {
      // No matching node: this could be a recombination
      // Hack: the equivalent recombination node is the next one labelled
      var target = target_tree + " .node.n" + (1+parseInt(node_id));
      // Extract the edge
      src_tree_pos = getRelativeXY(canvas, d3.select(src_tree).node());
      target_tree_pos = getRelativeXY(canvas, d3.select(target_tree).node());
      src_xy = getRelativeXY(canvas, d3.select(src).node());
      target_xy = getRelativeXY(canvas, d3.select(target).node());
      // Move the subtree out of the hierarchy and into the local tree space,
      // so that movements of the containing hierarchy do not affect position
      d3.select(src_tree).append(
        () => d3.select(src)
          .attr(
            "transform",
            "translate(" + (src_xy.x - src_tree_pos.x) + " " + (src_xy.y - src_tree_pos.y) + ")"
          )
          .remove()
          .node()
      );
      d3.select(src).transition()
        .delay(delay)
        .duration(dur)
        .attr(
          "transform",
          "translate(" + (target_xy.x-target_tree_pos.x) + " " + (target_xy.y-target_tree_pos.y) + ")")
      selection = d3.select(src + " > .edge");
      if (!selection.empty()) {
        selection.transition()
          .delay(delay)
          .duration(dur)
          .attr("d", d3.select(target +" > .edge").attr("d"))
      }
    }
  })
};

var svg_text = document.getElementById("anim_svg").innerHTML;

</script>

<button onclick='animate_SPR(d3.select("#anim_svg"), 4);'>Animate</button>
<button onclick='document.getElementById("anim_svg").innerHTML = svg_text;'>Reset</button>
</div></div>
</div>
</section>
</section>
</section>
<section id="other-visualizations">
<span id="sec-tskit-viz-other"></span><h2>Other visualizations<a class="headerlink" href="#other-visualizations" title="Link to this heading">#</a></h2>
<p>As well as visualizing a tree sequence as, well, a sequence of local trees, or by plotting
<a class="reference external" href="https://tskit.dev/tskit/docs/stable/stats.html#sec-stats" title="(in Project name not set)"><span class="xref std std-ref">statistical summaries</span></a>, other visualizations are possible, some
of which are outlined below.</p>
<section id="graph-representations">
<span id="sec-tskit-viz-other-graph"></span><h3>Graph representations<a class="headerlink" href="#graph-representations" title="Link to this heading">#</a></h3>
<p>A tree sequence can be treated as a specific form of (directed)
<a class="reference external" href="https://en.wikipedia.org/wiki/Graph_(discrete_mathematics)">graph</a> consisting
of nodes connected by edges. Standard graph visualization software,
such as <a class="reference external" href="https://graphviz.org">graphviz</a> can therefore be used to depict tree sequence
topologies. Alternatively, the <a class="reference external" href="https://github.com/kitchensjn/tskit_arg_visualizer">tskit_arg_visualizer</a>
project will draw a interactive <code class="docutils literal notranslate"><span class="pre">tskit</span></code> graph directly. Below is an example, which uses the
<code class="docutils literal notranslate"><span class="pre">variable_edge_width</span></code> option to highlight the spans of genome inherited through different routes.
Nodes can be dragged horizontally and embedded trees highlighted:</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%javascript</span>
<span class="nx">require</span><span class="p">.</span><span class="nx">config</span><span class="p">({</span><span class="nx">paths</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">d3</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;https://d3js.org/d3.v7.min&#39;</span><span class="p">}});</span>
<span class="nx">require</span><span class="p">([</span><span class="s2">&quot;d3&quot;</span><span class="p">],</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">d3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="nb">window</span><span class="p">.</span><span class="nx">d3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">d3</span><span class="p">;});</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<script type="application/javascript">require.config({paths: {d3: 'https://d3js.org/d3.v7.min'}});
require(["d3"], function(d3) {window.d3 = d3;});
</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">msprime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tskit_arg_visualizer</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">msprime</span><span class="o">.</span><span class="n">sim_ancestry</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">sequence_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">recombination_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">d3arg</span> <span class="o">=</span> <span class="n">tskit_arg_visualizer</span><span class="o">.</span><span class="n">D3ARG</span><span class="o">.</span><span class="n">from_ts</span><span class="p">(</span><span class="n">ts</span><span class="o">=</span><span class="n">ts</span><span class="p">)</span>
<span class="n">tip_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>  <span class="c1"># Found by trial and error for this seed</span>
<span class="n">d3arg</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">variable_edge_width</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sample_order</span><span class="o">=</span><span class="n">tip_order</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.11.14/x64/lib/python3.11/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm
</pre></div>
</div>
<div class="output text_html"><style>.d3arg {
    position: relative;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background-color: white;
    padding: 20px 20px 60px 20px;
}

.d3arg:hover .dashboard {
    visibility: visible;
}

.d3arg .dashboard {
    display: flex;
    visibility: hidden;
}

.d3arg .dashboard .dashbutton {
    position: relative;
    font-size: 30px;
    border: 0px;
    background-color: white;
    width: 30px;
    height: 30px;
}

.d3arg .dashboard .dashbutton .tip {
    width: 150px;
    font-size: 12px;
    background-color: lightgrey;
    color: #053e4e;
    text-align: center;
    padding: 5px 0px;
    position: absolute;
    z-index: 1;
    top: 100%;
    left: 50%; 
    margin-left: -60px;
    visibility: hidden;
}

.d3arg .dashboard .dashbutton:hover .desc {
    visibility: visible;
}

.d3arg .dashboard path {
    fill: grey;
}

.d3arg .dashboard .dashbutton:hover path {
    fill: #053e4e;
}

.d3arg .dashboard .activecolor:active path {
    fill: #1eebb1;
}

.d3arg .savemethods, .d3arg .labelmethods {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: row;
    flex-wrap: wrap;
}

.d3arg .savemethods button, .d3arg .labelmethods button {
    background-color: lightgrey;
    color: #053e4e;
    font-size: 12px;
    width: auto;
    border: none;
}

.d3arg .savemethods button:hover, .d3arg .labelmethods button:hover {
    color: #1eebb1;
}

.d3arg .labelmethods button.node-labels-default {
    text-decoration: underline;
}

.d3arg .yaxis path {
    stroke: #053e4e;
    stroke-width: 3px;
}

.d3arg .yaxis line {
    stroke: #053e4e;
    stroke-width: 3px;
}

.d3arg .yaxis text {
    fill: #053e4e;
    stroke: 1px;
}

.d3arg .hiddennode {
    fill: lightgrey;
    stroke: lightgrey;
    stroke-width: 4px;
}

.d3arg .underlink {
    stroke: #ffffff;
    stroke-width: 12px;
    fill: none;
}

.d3arg .hiddenlink {
    stroke: lightgrey;
    stroke-width: 4px;
    fill: none;
}

.d3arg .labels {
    text-anchor: middle;
}

.d3arg .label {
    fill: #053e4e;
    font-family: Arial;
    font-size: 12px;
}

.d3arg .label.start {
    text-anchor: start;
}

.d3arg .label.stop {
    text-anchor: end;
}

.d3arg .hiddenlabel {
    fill: lightgrey;
    font-family: Arial;
    font-size: 12px;
}

.d3arg svg {
    display: block;
}

.d3arg button {
    display: block;
    cursor: pointer;
}

.d3arg .saving {
    display: flex;
    flex-direction: row;
}

.d3arg .saving .message {
    display: none;
}

.d3arg .tooltip {
    position: absolute;
    max-width: 500px;
    padding: 10px;
    background-color: white;
    color: black;
    text-align: center;
    z-index: 9999;
}

.d3arg .sites text {
    text-anchor: middle;
}</style><div id="arg_1066235845" class="d3arg" style="min-width:640.0px; min-height:655.0px;"></div><script>function parseRgbString(rgbString) {
  const match = rgbString.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d*\.?\d+))?\)/);
  if (match) {
    const r = parseInt(match[1]);
    const g = parseInt(match[2]);
    const b = parseInt(match[3]);
    const a = match[4] ? parseFloat(match[4]) : 1; // Default alpha to 1 if not present
    return { r, g, b, a };
  }
  return null; // Or throw an error for invalid format
}

function ensureRequire() {
    // Needed e.g. in Jupyter notebooks: if require is already available, return resolved promise
    if (typeof require !== 'undefined') {
        return Promise.resolve(require);
    }

    // Otherwise, dynamically load require.js
    return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js';
        script.onload = () => resolve(require);
        script.onerror = reject;
        document.head.appendChild(script);
    });
};

function main_visualizer(
    d3,
    divnum,
    graph,
    width,
    height,
    y_axis,
    edge_styles,
    condense_mutations,
    label_mutations,
    tree_highlighting,
    title,
    rotate_tip_labels,
    plot_type,
    preamble,
    source,
    filename_for_saving,
) {
    /*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
    
    function download (url, name, opts) {
        var xhr = new XMLHttpRequest()
        xhr.open('GET', url)
        xhr.responseType = 'blob'
        xhr.onload = function () {
            saveAs(xhr.response, name, opts)
        }
        xhr.onerror = function () {
            console.error('could not download file')
        }
        xhr.send()
    }
    
    function corsEnabled (url) {
        var xhr = new XMLHttpRequest()
        // use sync to avoid popup blocker
        xhr.open('HEAD', url, false)
        try {
            xhr.send()
        } catch (e) {}
        return xhr.status >= 200 && xhr.status <= 299
    }
    
    // 'a.click()' doesn't work for all browsers (#465)
    function click (node) {
        try {
            node.dispatchEvent(new MouseEvent('click'))
        } catch (e) {
            var evt = document.createEvent('MouseEvents')
            evt.initMouseEvent('click', true, true, window, 0, 0, 0, 80,
                                20, false, false, false, false, 0, null)
            node.dispatchEvent(evt)
        }
    }
    
    function saveAs (blob, name, opts) {
        var URL = URL || webkitURL
        // Namespace is used to prevent conflict w/ Chrome Poper Blocker extension (Issue #561)
        var a = document.createElementNS('http://www.w3.org/1999/xhtml', 'a')
        name = name || blob.name || 'download'

        a.download = name
        a.rel = 'noopener' // tabnabbing

        // TODO: detect chrome extensions & packaged apps
        // a.target = '_blank'

        if (typeof blob === 'string') {
            // Support regular links
            a.href = blob
            if (a.origin !== location.origin) {
            corsEnabled(a.href)
                ? download(blob, name, opts)
                : click(a, a.target = '_blank')
            } else {
            click(a)
            }
        } else {
            // Support blobs
            a.href = URL.createObjectURL(blob)
            setTimeout(function () { URL.revokeObjectURL(a.href) }, 4E4) // 40s
            setTimeout(function () { click(a) }, 0)
        }
    }

    const NODE_IS_SAMPLE = 1;
    const NODE_IS_RE_EVENT = 131072;
    var line = d3.line();
    var step = d3.line().curve(d3.curveStep);
    var stepAfter = d3.line().curve(d3.curveStepAfter);
    var stepBefore = d3.line().curve(d3.curveStepBefore);


    // https://gist.github.com/Rokotyan/0556f8facbaf344507cdc45dc3622177
    // Below are the functions that handle actual exporting:
    // getSVGString ( svgNode ) and svgString2Image( svgString, width, height, format, callback )
    function getSVGString( svgNode ) {
        svgNode.setAttribute('xlink', 'http://www.w3.org/1999/xlink');
        var cssStyleText = getCSSStyles();
        appendCSS( cssStyleText, svgNode );
        var serializer = new XMLSerializer();
        var svgString = serializer.serializeToString(svgNode);
        svgString = svgString.replace(/(\w+)?:?xlink=/g, 'xmlns:xlink='); // Fix root xlink without namespace
        svgString = svgString.replace(/NS\d+:href/g, 'xlink:href'); // Safari NS namespace fix
        return svgString;

        function getCSSStyles() {
            // Extract CSS Rules
            var extractedCSSText = "";
            for (var i = 0; i < document.styleSheets.length; i++) { // this could be improved as it loops through all stylings on page
                var s = document.styleSheets[i];
                try {
                    if(!s.cssRules) continue;
                } catch( e ) {
                    if(e.name !== 'SecurityError') throw e; // for Firefox
                    continue;
                }
                var cssRules = s.cssRules;
                for (var r = 0; r < cssRules.length; r++) {
                    extractedCSSText += cssRules[r].cssText.replace(".d3arg ", ""); // removing reference to d3arg
                }
            }
            return extractedCSSText;

        }

        function appendCSS( cssText, element ) {
            var styleElement = document.createElement("style");
            styleElement.setAttribute("type","text/css"); 
            styleElement.innerHTML = cssText;
            var refNode = element.hasChildNodes() ? element.children[0] : null;
            element.insertBefore( styleElement, refNode );
        }
    }


    function svgString2Image( svgString, width, height, format, callback ) {
        var format = format ? format : 'png';
        var imgsrc = 'data:image/svg+xml;base64,'+ btoa( unescape( encodeURIComponent( svgString ) ) ); // Convert SVG string to data URL
        var canvas = document.createElement("canvas");
        var context = canvas.getContext("2d");
        canvas.width = width;
        canvas.height = height;
        var image = new Image();
        image.onload = function() {
            context.clearRect ( 0, 0, width, height);
            context.drawImage(image, 0, 0, width, height);
            canvas.toBlob( function(blob) {
                var filesize = Math.round( blob.length/1024 ) + ' KB';
                if ( callback ) callback( blob, filesize );
            });
        };
        image.src = imgsrc;
    }

    function draw_force_diagram() {
        var evenly_distributed_positions = graph.evenly_distributed_positions;
        var div_selector = "#arg_" + String(divnum);
        if (preamble) {
            d3.select(div_selector).html(preamble);
        }
        var tip = d3.select(div_selector).append("div")
            .attr("class", "tooltip")
            .style("display", "none");

        var dashboard = d3.select(div_selector).append("div").attr("class", "dashboard");
        
        var saving = dashboard.append("button").attr("class", "dashbutton");
        saving.append("svg") //<!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
            .attr("xmlns", "http://www.w3.org/2000/svg")
            .attr("viewBox", "0 0 512 512")
            .append("path")
            .attr("d", "M288 32c0-17.7-14.3-32-32-32s-32 14.3-32 32V274.7l-73.4-73.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l128 128c12.5 12.5 32.8 12.5 45.3 0l128-128c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L288 274.7V32zM64 352c-35.3 0-64 28.7-64 64v32c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V416c0-35.3-28.7-64-64-64H346.5l-45.3 45.3c-25 25-65.5 25-90.5 0L165.5 352H64zm368 56a24 24 0 1 1 0 48 24 24 0 1 1 0-48z");
        var saving_methods = saving.append("span").attr("class", "tip desc");
        var methods = saving_methods.append("div").text("Download As:").append("div").attr("class", "savemethods")

        methods.append("button").text("JSON")
            .on("click", function() {
                d3.selectAll(div_selector + " .node").classed("fix", function(d) {
                    d.fx = d.x;
                });
                src = JSON.parse(source);
                src.data.nodes = graph.nodes;
                var textBlob = new Blob([JSON.stringify(src)], {type: "text/plain"});
                saveAs(textBlob, filename_for_saving + ".json");
            });
        methods.append("button").text("SVG")
            .on('click', function(){
                var svgString = getSVGString(svg.node());
                var svgBlob = new Blob([svgString], {type:"image/svg+xml;charset=utf-8"});
                saveAs(svgBlob, filename_for_saving);
            });
        methods.append("button").text("PNG")
            .on('click', function(){
                var svgString = getSVGString(svg.node());
                svgString2Image(svgString, 2*width, 2*height, 'png', save); // passes Blob and filesize String to the callback
            
                function save(dataBlob){
                    saveAs(dataBlob, filename_for_saving); // FileSaver.js function
                }
            });
        
        /*
        methods.append("button").text("HTML")
            .on("click", function(){
                d3.selectAll(div_selector + " .node").classed("fix", function(d) {
                    d.fx = d.x;
                });
                var html = document.querySelector("html").outerHTML;
                var arg_div = document.getElementById(div_selector).innerHTML;
                console.log(arg_div);
                html = html.replace(arg_div, "");
                html = html.replace(source.match(/'nodes': .*'links'/), "'nodes': " + JSON.stringify(graph.nodes) + ", 'links'")
                saveAs(new Blob([html], {type:"text/plain;charset=utf-8"}), "tskit_arg_visualizer.html");
            })
        */

        var reheat = dashboard.append("button").attr("class", "dashbutton activecolor")
            .on("click", function(event) {
                if (!event.active) simulation.alphaTarget(0.3).restart();       
                var order = d3.selectAll(div_selector + " .sample").data().sort((a, b) => d3.ascending(a.x, b.x)).map(a => a.id);;
                d3.selectAll(div_selector + " .node").classed("unfix", function(d) {
                    if ((d.ts_flags & NODE_IS_SAMPLE) & (d.x_pos_reference == -1)) {
                        delete d.fx;
                    } else {
                        d.fx = evenly_distributed_positions[order.indexOf(d.id)];
                    }
                });
            });
        reheat.append("svg") //<!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
            .attr("xmlns", "http://www.w3.org/2000/svg")
            .attr("viewBox", "0 0 384 512")
            .append("path")
            .attr("d", "M153.6 29.9l16-21.3C173.6 3.2 180 0 186.7 0C198.4 0 208 9.6 208 21.3V43.5c0 13.1 5.4 25.7 14.9 34.7L307.6 159C356.4 205.6 384 270.2 384 337.7C384 434 306 512 209.7 512H192C86 512 0 426 0 320v-3.8c0-48.8 19.4-95.6 53.9-130.1l3.5-3.5c4.2-4.2 10-6.6 16-6.6C85.9 176 96 186.1 96 198.6V288c0 35.3 28.7 64 64 64s64-28.7 64-64v-3.9c0-18-7.2-35.3-19.9-48l-38.6-38.6c-24-24-37.5-56.7-37.5-90.7c0-27.7 9-54.8 25.6-76.9z");
        reheat.append("span").attr("class", "tip desc").text("Reheat Simulation");
        
        if (plot_type == "full") {
            var evenly_distribute = dashboard.append("button").attr("class", "dashbutton activecolor")
                .on("click", function() {
                    var order = d3.selectAll(div_selector + " .sample").data().sort((a, b) => d3.ascending(a.x, b.x)).map(a => a.id);;
                    d3.selectAll(div_selector + " .sample").classed("distribute", function(d) {
                        d.fx = evenly_distributed_positions[order.indexOf(d.id)];
                    });
                });
            evenly_distribute.append("svg") //<!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
                .attr("xmlns", "http://www.w3.org/2000/svg")
                .attr("viewBox", "0 0 512 512")
                .append("path")
                .attr("d", "M504.3 273.6c4.9-4.5 7.7-10.9 7.7-17.6s-2.8-13-7.7-17.6l-112-104c-7-6.5-17.2-8.2-25.9-4.4s-14.4 12.5-14.4 22l0 56-192 0 0-56c0-9.5-5.7-18.2-14.4-22s-18.9-2.1-25.9 4.4l-112 104C2.8 243 0 249.3 0 256s2.8 13 7.7 17.6l112 104c7 6.5 17.2 8.2 25.9 4.4s14.4-12.5 14.4-22l0-56 192 0 0 56c0 9.5 5.7 18.2 14.4 22s18.9 2.1 25.9-4.4l112-104z")
            evenly_distribute.append("span").attr("class", "tip desc").text("Space Samples");
        }

        var labelling = dashboard.append("button").attr("class", "dashbutton");
        labelling.append("svg") //<!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
            .attr("xmlns", "http://www.w3.org/2000/svg")
            .attr("viewBox", "0 0 512 512")
            .append("path")
            .attr("d", "M0 80L0 229.5c0 17 6.7 33.3 18.7 45.3l176 176c25 25 65.5 25 90.5 0L418.7 317.3c25-25 25-65.5 0-90.5l-176-176c-12-12-28.3-18.7-45.3-18.7L48 32C21.5 32 0 53.5 0 80zm112 32a32 32 0 1 1 0 64 32 32 0 1 1 0-64z");
        var labelling_methods = labelling.append("span").attr("class", "tip desc");
        var methods = labelling_methods.append("div").text("Node Labels:").append("div").attr("class", "labelmethods")
        
        function switch_node_label(selected) {
            label_text.each(function(d) {
                d3.select(this).selectAll("*").remove();
                if (selected == "default") {
                    multi_line_text.call(this, d.label, (d.parent_of.length == 0));
                } else if (selected == "id") {
                    multi_line_text.call(this, "#" + String(d.id));
                } else {
                    multi_line_text.call(this, "");
                }
            })
        }
        
        methods.append("button").attr("class", "node-labels-default").text("DEFAULT")
            .on("click", function() {
                switch_node_label("default");
                // Underline the current selection (could use different highlighting method here)
                d3.selectAll(div_selector + " .labelmethods button").style("text-decoration", "none");
                d3.select(this).style("text-decoration", "underline");
            });
        methods.append("button").attr("class", "node-labels-id").text("#ID")
            .on('click', function(){
                switch_node_label("id");
                // Underline the current selection (could use different highlighting method here)
                d3.selectAll(div_selector + " .labelmethods button").style("text-decoration", "none");
                d3.select(this).style("text-decoration", "underline");
            });
        methods.append("button").attr("class", "node-labels-none").text("NONE")
            .on('click', function(){
                switch_node_label("none");
                // Underline the current selection (could use different highlighting method here)
                d3.selectAll(div_selector + " .labelmethods button").style("text-decoration", "none");
                d3.select(this).style("text-decoration", "underline");
            });


        var svg = d3.select(div_selector).append("svg")
            .attr("width", width)
            .attr("height", height)
            .style("background-color", "white");

        var result = y_axis.ticks.map(function (x) { 
            return parseInt(x, 10); 
        });

        if (eval(y_axis.include_labels)) {
            var bottom = height - 50;
            if (tree_highlighting) {
                bottom = height - 125;
            }
            var top = 50;
            if (title != "None") {
                top = 100
            }
            var yscale = d3.scaleLinear() 
                .domain([y_axis.max_min[0], y_axis.max_min[1]]) 
                .range([y_axis.max_min[0], y_axis.max_min[1]]); 

            var y_axis_text = y_axis.text;

            var d3_y_axis = d3.axisRight().scale(yscale)
                .tickValues(result)
                .tickFormat((d, i) => y_axis_text[i]); 

            var y_axis_labels = svg
                .append("g")
                .attr("class", "yaxis")
                .attr("transform", "translate(25,0)")
                .call(d3_y_axis);
            
            if (y_axis.title != "None") {
                y_axis_labels.append("text")
                .attr("x", -15)
                .attr("y", (y_axis.max_min[0]+y_axis.max_min[1])/2)
                .attr("fill", "black")
                .attr("text-anchor", "middle")
                .attr("alignment-baseline", "middle")
                .attr("class", "label")
                .attr("transform", "rotate(-90, -15, " + (y_axis.max_min[0]+y_axis.max_min[1])/2 + ")")
                .text(y_axis.title);
            }
        }

        var simulation = d3
            .forceSimulation(graph.nodes)
            .force("link", d3.forceLink()
                .id(d => d.id)
                .links(graph.links)
            )
            //.force("center", d3.forceCenter(275,250).strength(-10))
            .force("charge", d3.forceManyBody().strength(-100))
            .on("tick", ticked);

        var link_container = svg
            .append("g")
            .attr("class", "links")
            .selectAll("path")
            .data(graph.links)
            .enter()
            .append("g")
            .attr("bounds", d => d.bounds);

        if ((edge_styles.type == "ortho") & eval(edge_styles.include_underlink)) {
            var underlink = link_container
                .append("path")
                .attr("class", "underlink");
        }

        var link = link_container
            .append("path")
            .attr("class", "link")
            .attr("stroke", d => d.stroke)
            .attr("stroke-width", "4px");
        
        if (eval(edge_styles.variable_width)) {
            link
                .style("stroke-width", d => d.region_fraction * 7 + 1);
        }

        if (tree_highlighting) {
            d3.selectAll(div_selector + " .link")
                .on('mouseover', function (event, d) {
                    if (!d3.select(div_selector + ">svg").classed("no-hover")) {
                        d3.select(this)
                            .style('stroke', '#1eebb1')
                            .style("cursor", "pointer");
                        d3.selectAll(div_selector + " .sites .e" + d.id).style("display", "block");
                        d3.selectAll(div_selector + " .endpoints")
                            .style('display', 'none'); /* hide other labels to avoid clashes */
                        const bars = d3.select(div_selector + " .breakpoints").selectAll(".included");
                        bars /* colour in all bars covered by these bounds */
                            .filter(function(j) {
                                return d.bounds.split(" ").some(function(region) {
                                    region = region.split("-");
                                    return (parseFloat(region[0]) <= j.start) & (parseFloat(region[1]) >= j.stop)
                                });
                            })
                            .selectAll("rect").style('fill', '#1eebb1');
                        bars /* show the leftmost position label */
                            .filter(function(j) {
                                return d.bounds.split(" ").some(function(region) {
                                    region = region.split("-");
                                    return (parseFloat(region[0]) == j.start)
                                });
                            })
                            .selectAll("text.start").style('display', 'block');
                        bars /* show the rightmost position label */
                            .filter(function(j) {
                                return d.bounds.split(" ").some(function(region) {
                                    region = region.split("-");
                                    return (parseFloat(region[1]) == j.stop)
                                });
                            })
                            .selectAll("text.stop").style('display', 'block');
                    }
                })
                .on('mouseout', function (event, d) {
                    if (!d3.select(div_selector + ">svg").classed("no-hover")) {
                        d3.select(this)
                            .style('stroke', d.stroke)
                            .style("cursor", "default");
                        const bars = d3.select(div_selector + " .breakpoints").selectAll(".included");
                        bars.selectAll("rect").style("fill", d.fill);
                        bars.selectAll("text").style("display", "none");
                        d3.selectAll(div_selector + " .endpoints")
                            .style('display', 'block');
                        d3.selectAll(div_selector + " .sites .e" + d.id).style("display", "none");
                    }
                });
        }

        var node_group = svg
            .append("g")
            .attr("class", "nodes")
            .selectAll("circle")
            .data(graph.nodes)
            .enter()
            .append("g");

        var missing_edges = node_group
            .filter(d => (d.not_included_parents>0) | (d.not_included_children>0))
            .append("g")
            .attr("class", "missing");

        var missing_parents = missing_edges
            .filter(d => d.not_included_parents>0)
            .append("g")
            .attr("class", "parents")
            .append("g");
        var missing_parents_paths = missing_parents.append("path");
        var missing_parents_texts = missing_parents
            .append("text")
                .attr("class", "label")
                .style("fill", "gray")
                .text(d => d.not_included_parents);

        var missing_children = missing_edges
            .filter(d => d.not_included_children>0)
            .append("g")
            .attr("class", "children")
            .append("g");
        var missing_children_paths = missing_children.append("path");
        var missing_children_texts = missing_children
            .append("text")
                .attr("class", "label")
                .style("fill", "gray")
                .text(d => d.not_included_children);

        function multi_line_text(text, top_align) {
            if (text != null) {
                // Split label text onto separate lines by newline characters, if they exist
                const lines = text.split("\n");
                const parentX = d3.select(this).attr("x") || "0";  // Get parent text's x position
                const initialDy = top_align ? "0em" : (-1 * (lines.length - 1)) + "em";

                d3.select(this).text(null); // clear existing text
                d3.select(this).selectAll('tspan')
                    .data(lines)
                    .enter()
                    .append('tspan')
                    .text(d => d)
                    .attr('x', parentX)  // Use parent's x position
                    .attr('dy', (d, i) => ((i === 0) ? initialDy : "1em"));
            }
        }
        var node = node_group
            .append("path")
            .attr("transform", d => "translate(" + d.x + "," + d.y + ")")
            .attr("d", d3.symbol().type(d => eval(d.symbol)).size(d => d.size))
            .attr("fill", d => d.fill)
            .attr("stroke", d => d.stroke)
            .attr("stroke-width", d => d.stroke_width)
            .attr("id", d => String(divnum) + "_node" + d.id)
            .attr("class", d => "node flag" + d.ts_flags + (d.ts_flags & NODE_IS_SAMPLE ? " sample" : ""))
            .attr("parents", d => d.child_of.toString().replace(",", " "))
            .attr("children", d => d.parent_of.toString().replace(",", " "))
            .call(
                d3
                    .drag()
                    .on("start", dragstarted)
                    .on("drag", dragged)
                    .on("end", dragended)
            )
            .on('mouseover', function (d, i) {
                d3.select(this)
                    .style("cursor", "pointer")
            });

        function highlight_mut(mutation_id, site_id, fill) {
            /* other mutations at the same site on the tree */
            d3.selectAll(div_selector + " .mutations .s" + site_id + " rect").style("stroke", fill);
            /* highlight only this mutation in the bar */
            d3.select(div_selector + " .sites .m" + mutation_id).style("display", "block");
        }

        function dehighlight_mut(mutation_id, site_id) {
            d3.selectAll(div_selector + " .mutations .s" + site_id + " rect")
                .each(function(d) {
                    d3.select(this)
                        .style("stroke", d.stroke)
                        .style("fill", d.fill);
                    });
            d3.select(div_selector + " .sites .m" + mutation_id).style("display", "none");
        }

        function highlight_mut(mutation_id, site_id, fill) {
            /* other mutations at the same site on the tree */
            d3.selectAll(div_selector + " .mutations .s" + site_id + " rect").style("stroke", fill);
            /* highlight only this mutation in the bar */
            d3.select(div_selector + " .sites .m" + mutation_id).style("display", "block");
        }

        function dehighlight_mut(mutation_id, site_id) {
            d3.selectAll(div_selector + " .mutations .s" + site_id + " rect")
                .each(function(d) {
                    d3.select(this)
                        .style("stroke", d.stroke)
                        .style("fill", d.fill);
                    });
            d3.select(div_selector + " .sites .m" + mutation_id).style("display", "none");
        }

        var mut_symbol = svg
            .append("g")
            .attr("class", "mutations")
            .selectAll("rect")
            .data(graph.mutations)
            .enter()
            .append("g")
            .attr("class", d => {
                if (condense_mutations) {
                    return (
                        d.site_id.map(id => "s" + id).join(" ") + " " +
                        d.mutation_id.map(id => "m" + id).join(" ")
                    )
                } else {
                    return "s" + d.site_id + " " + "m" + d.mutation_id;
                }}
            )
            .attr("class", d => {
                if (condense_mutations) {
                    return (
                        d.site_id.map(id => "s" + id).join(" ") + " " +
                        d.mutation_id.map(id => "m" + id).join(" ")
                    )
                } else {
                    return "s" + d.site_id + " " + "m" + d.mutation_id;
                }}
            )
            .on("mouseover", function(event, d) {
                if (!d3.select(div_selector + ">svg").classed("no-hover")) {
                    d3.select(this).style("cursor", "pointer");
                    /* highlight all mutations at the same site (easy to spot reversions etc) */
                    if (condense_mutations) {
                        d.mutation_id.forEach((id, i) => highlight_mut(id, d.site_id[i], d.fill));
                    } else {
                        highlight_mut(d.mutation_id, d.site_id, d.fill)
                    }
                    if (condense_mutations) {
                        d.mutation_id.forEach((id, i) => highlight_mut(id, d.site_id[i], d.fill));
                    } else {
                        highlight_mut(d.mutation_id, d.site_id, d.fill)
                    }
                    /* Show a tooltip with the mutation information */
                    var rect = d3.select(div_selector).node().getBoundingClientRect();
                    tip
                        .style("display", "block")
                        .html("<p style='margin: 0px;'>" + d.content + "</p>")
                        .style("border", d.fill + " solid 2px")
                        .style("left", (event.pageX - rect.x) + "px")
                        .style("top", (event.pageY - rect.y + 25) + "px")
                        .style("transform", "translateX(-50%)");
                }
            })
            .on("mouseout", function(event, d) {
                if (!d3.select(div_selector + ">svg").classed("no-hover")) {
                    if (!eval(d.active)) {
                        d3.select(this).style("cursor", "default");
                        if (condense_mutations) {
                            d.mutation_id.forEach((id, i) => dehighlight_mut(id, d.site_id[i]));
                        } else {
                            dehighlight_mut(d.mutation_id, d.site_id);
                        }
                    }
                    if (!eval(d.active)) {
                        d3.select(this).style("cursor", "default");
                        if (condense_mutations) {
                            d.mutation_id.forEach((id, i) => dehighlight_mut(id, d.site_id[i]));
                        } else {
                            dehighlight_mut(d.mutation_id, d.site_id);
                        } 
                        tip.style("display", "none");
                    }
                }
            });

        if (label_mutations) {
            var mut_symbol_label = mut_symbol
                .append("text")
                //.attr("class", "label")
                .style("font-size", d => (d.size * 2 + "px"))
                .attr("text-anchor", "middle")
                .attr("alignment-baseline", "middle")
                .attr("fill", d => {
                    var box = document.createElement("div");
                    box.style.color = d.fill;
                    document.body.appendChild(box);
                    var rgb = parseRgbString(window.getComputedStyle(box).color);
                    document.body.removeChild(box);
                    var lightness = 0.2126*rgb["r"] + 0.7152*rgb["g"] + 0.0722*rgb["b"];
                    if (lightness > 0.5) {
                        return "#053e4e"
                    }
                    return "white"
                })
                .text(d => d.label)
                .each(function(d) {
                    // Store the text width on the data object
                    d.textWidth = this.getComputedTextLength();
                });
        }

        var mut_symbol_rect = mut_symbol
            .append("rect")
            .attr("class", "symbol")
            .attr("fill", d => d.fill)
            .attr("stroke", d => d.stroke)
            .attr("stroke-width", 2)
            // Set the rect width / height based on the calculated text width
            .attr("width", function(d) {
                if (label_mutations && d.textWidth) {
                    d.computedWidth = d.textWidth + 6; // Add left/right padding
                } else {
                    d.computedWidth = d.size * 3; // aspect ratio is 3 (3 times wider than tall)
                }
                return d.computedWidth;  
            })
            .attr("height", function(d) {
                if (label_mutations) {
                    d.computedHeight = (d.size * 2) + 4; // Font size + top/bottom padding
                }
                else {
                    d.computedHeight = d.size;
                }
                return d.computedHeight;
            })
            .lower();

        function rotate_tip(d) {
            /* NB: why is there an "eval" here? */
            if ((d.parent_of.length == 0) & (eval(rotate_tip_labels))) {
                return "translate(-4, 0) rotate(90)"
            }
            return null
        }

        var label = svg
            .append("g")
            .attr("class", "node-labels")
            .selectAll("text")
            .data(graph.nodes)
            .enter()
            //.filter(d => eval(d.include_label))
            .append("g");

        var label_text = label
            .attr("class", d => "label n" + d.id)
            .append("text")
            .each(function(d) {
                multi_line_text.call(this, d.label, (d.parent_of.length == 0));
            })
            //.each(d => multi_line_text.call(this, d.label, (d.parent_of.length == 0)))
            .attr("transform", rotate_tip);

        function determine_path_type(d) {
            path_type = ""
            var start_position_x = d.source.x;
            var start_position_y = d.source.y;
            var stop_position_x = d.target.x;
            var stop_position_y = d.target.y;
            var vnub = Math.min((stop_position_y-start_position_y)/2, 20);
            if ("y_axis.scale" == "time" | "y_axis.scale" == "log_time") {
                vnub = 0;
            }
            var alt_child = document.getElementById(String(divnum) + "_node" + d.alt_child);
            if (alt_child != null) {
                var alt_child_x = alt_child.getAttribute("cx");
                var alt_child_y = alt_child.getAttribute("cy");
            }
            if (d.source.ts_flags & NODE_IS_RE_EVENT) {
                path_type += "r0";
                start_position_y = d.source.y + vnub;
            } else {
                if (d.target.y < alt_child_y) {
                    if (d.target.x < d.source.x) {
                        if (d.target.x < d.source.x - 40) {
                            path_type += "tL";
                        } else {
                            path_type += "fL";
                        }
                        start_position_x = d.source.x - 20;
                    } else {
                        if (d.target.x > d.source.x + 40) {
                            path_type += "tR";
                        } else {
                            path_type += "fR";
                        }
                        start_position_x = d.source.x + 20;
                    }
                } else if (d.target.y > alt_child_y) {
                    if (alt_child_x < d.source.x) {
                        if (d.target.x < d.source.x + 40) {
                            path_type += "fR";
                        } else {
                            path_type += "tR";
                        }
                        start_position_x = d.source.x + 20;
                    } else {
                        if (d.target.x > d.source.x - 40) {
                            path_type += "fL";
                        } else {
                            path_type += "tL";
                        }
                        start_position_x = d.source.x - 20;
                    }
                } else {
                    if (d.target.x < alt_child_x) {
                        if (d.target.x < d.source.x - 40) {
                            path_type += "tL";
                        } else {
                            path_type += "fL";
                        }
                        start_position_x = d.source.x - 20;
                    } else if (d.target.x > alt_child_x) {
                        if (d.target.x > d.source.x + 40) {
                            path_type += "tR";
                        } else {
                            path_type += "fR";
                        }
                        start_position_x = d.source.x + 20;
                    } else {
                        if (d.index % 2 == 0) {
                            path_type += "fL";
                            start_position_x = d.source.x - 20;
                        } else {
                            path_type += "fR";
                            start_position_x = d.source.x + 20;
                        }
                    }
                }
            }
            var alt_parent = document.getElementById(String(divnum) + "_node" + d.alt_parent);
            if (alt_parent != null) {
                var alt_parent_x = alt_parent.getAttribute("cx");
                var alt_parent_y = alt_parent.getAttribute("cy");
            }
            if (d.target.ts_flags & NODE_IS_RE_EVENT) {
                if (d.source.y < alt_parent_y) {
                    if (alt_parent_x < d.target.x) {
                        if (d.source.x < d.target.x + 40) {
                            path_type += "fR";
                        } else {
                            path_type += "tR";
                        }
                        stop_position_x = d.target.x + 20;
                    } else {
                        if (d.source.x > d.target.x - 40) {
                            path_type += "fL";
                        } else {
                            path_type += "tL";
                        }
                        stop_position_x = d.target.x - 20;
                    }
                } else if (d.source.y > alt_parent_y) {
                    if (d.source.x < d.target.x) {
                        if (d.source.x < d.target.x - 40) {
                            path_type += "tL";
                        } else {
                            path_type += "fL";
                        }
                        stop_position_x = d.target.x - 20;
                    } else {
                        if (d.source.x > d.target.x + 40) {
                            path_type += "tR";
                        } else {
                            path_type += "fR";
                        }
                        stop_position_x = d.target.x + 20;
                    }
                } else {
                    if (d.index % 2 == 0) {
                        path_type += "fL";
                        stop_position_x = d.target.x - 20;
                    } else {
                        path_type += "fR";
                        stop_position_x = d.target.x + 20;
                    }
                }
            } else {
                path_type += "b0";
                stop_position_y = d.target.y - vnub;
            }
            if (path_type == "fLb0" ) {
                if (start_position_x >= stop_position_x) {
                    path_type = "tLb0";
                }
            } else if (path_type == "fRb0") {
                if (start_position_x <= stop_position_x) {
                    path_type = "tRb0";
                }
            } else if (path_type == "r0fL") {
                if (start_position_x <= stop_position_x) {
                    path_type = "r0tL";
                }
            } else if (path_type == "r0fR") {
                if (start_position_x >= stop_position_x) {
                    path_type = "r0tR";
                }
            } else if (path_type == "fLfL") {
                if (start_position_x <= stop_position_x) {
                    path_type = "fLtL";
                } else {
                    path_type = "tLfL";
                }
            } else if (path_type == "fRfR") {
                if (start_position_x >= stop_position_x) {
                    path_type = "fRtR";
                } else {
                    path_type = "tRfR";
                }
            }
            return [path_type, start_position_x, start_position_y, stop_position_x, stop_position_y];
        }

        function ortho_pathing(d, path_info, underlink=false) {      
            const path_type = path_info[0];
            const simple_path_type = Array.from(path_type)[0] + Array.from(path_type)[2];
            const start_position_x = path_info[1];
            const start_position_y = path_info[2];
            const stop_position_x = path_info[3];
            const stop_position_y = path_info[4];

            const after_paths = ["rf", "tb", "tf"];
            const before_paths = ["rt", "fb", "ft"];
            const step_paths = ["tt"];
            const mid_paths = ["rb", "ff"];

            if (underlink) {
                if (after_paths.includes(simple_path_type)) {
                    return stepAfter([[start_position_x, start_position_y],[stop_position_x, stop_position_y]]);
                } else if (before_paths.includes(simple_path_type)) {
                    return stepBefore([[start_position_x, start_position_y],[stop_position_x, stop_position_y]]);
                } else if (step_paths.includes(simple_path_type)) {
                    return step([[start_position_x, start_position_y],[stop_position_x, stop_position_y]]);
                } else if (mid_paths.includes(simple_path_type)) {
                    return line([[start_position_x, start_position_y],[start_position_x, start_position_y + (stop_position_y - start_position_y)/2]]) + line([[start_position_x, start_position_y + (stop_position_y - start_position_y)/2],[stop_position_x, start_position_y + (stop_position_y - start_position_y)/2]]) + line([[stop_position_x, start_position_y + (stop_position_y - start_position_y)/2], [stop_position_x, stop_position_y]]);
                }
            } else {
                if (after_paths.includes(simple_path_type)) {
                    return line([[d.source.x, d.source.y],[start_position_x, start_position_y]]) + stepAfter([[start_position_x, start_position_y],[stop_position_x, stop_position_y]]) + line([[stop_position_x, stop_position_y], [d.target.x, d.target.y]]);
                } else if (before_paths.includes(simple_path_type)) {
                    return line([[d.source.x, d.source.y],[start_position_x, start_position_y]]) + stepBefore([[start_position_x, start_position_y],[stop_position_x, stop_position_y]]) + line([[stop_position_x, stop_position_y], [d.target.x, d.target.y]]);
                } else if (step_paths.includes(simple_path_type)) {
                    return line([[d.source.x, d.source.y],[start_position_x, start_position_y]]) + step([[start_position_x, start_position_y],[stop_position_x, stop_position_y]]) + line([[stop_position_x, stop_position_y], [d.target.x, d.target.y]]);
                } else if (mid_paths.includes(simple_path_type)) {
                    return line([[d.source.x, d.source.y],[start_position_x, start_position_y]]) + line([[start_position_x, start_position_y],[start_position_x, start_position_y + (stop_position_y - start_position_y)/2]]) + line([[start_position_x, start_position_y + (stop_position_y - start_position_y)/2],[stop_position_x, start_position_y + (stop_position_y - start_position_y)/2]]) + line([[stop_position_x, start_position_y + (stop_position_y - start_position_y)/2], [stop_position_x, stop_position_y]]) + line([[stop_position_x, stop_position_y], [d.target.x, d.target.y]]);
                }
            }
        }

        function ticked() {
            node
                .attr("transform", function(d) {
                    if (eval(y_axis.include_labels)) {
                        return "translate(" + Math.max(150, Math.min(width-50, d.x)) + "," + d.y + ")";
                    } else {
                        return "translate(" + Math.max(50, Math.min(width-50, d.x)) + "," + d.y + ")";
                    }
                })
                .attr("cx", function(d) {
                    if ((edge_styles.type == "ortho") & (d.x_pos_reference != -1)) {
                        var ref = document.getElementById(String(divnum) + "_node" + d.x_pos_reference);
                        if (ref != null) {
                            d.fx = ref.getAttribute("cx");
                        }
                    }
                    if (eval(y_axis.include_labels)) {
                        return d.x = Math.max(150, Math.min(width-50, d.x));
                    } else {
                        return d.x = Math.max(50, Math.min(width-50, d.x));
                    }
                })
                .attr("cy", d => d.y);
            
            link_container.each(function(d) {
                var path_info = determine_path_type(d);
                var path = "";
                if (edge_styles.type == "ortho") {
                    path = ortho_pathing(d, path_info);
                    underlink_path = ortho_pathing(d, path_info, underlink=true);
                } else if (d.source.id == d.alt_parent) {
                    var leftOrRight = 20;
                    if (d.index % 2 == 0) {
                        leftOrRight = -20;
                    }
                    path = "M " + d.source.x + " " + d.source.y + " C " + (d.source.x + leftOrRight).toString() + " " +  (d.source.y - 10).toString() + ", " + (d.target.x + leftOrRight).toString() + " " + (d.target.y + 10).toString() + ", " + d.target.x + " " + d.target.y;
                } else {
                    path = line([[d.source.x, d.source.y], [d.target.x, d.target.y]]);
                }
                if ((edge_styles.type == "ortho") & eval(edge_styles.include_underlink)) {
                    var u = d3.select(this).select(".underlink");
                    u.attr("d", underlink_path);
                }
                var l = d3.select(this).select(".link");
                l.attr("path_type", path_info[0]);
                l.attr("d", path)
                l.attr("fill", "none");
            });

            mut_symbol_rect
                .attr("x", function(d) {
                    var parent = document.getElementById(String(divnum) + "_node" + d.source);
                    if (parent != null) {
                        var parent_x = parseFloat(parent.getAttribute("cx"));
                        var parent_y = parseFloat(parent.getAttribute("cy"));
                        var child = document.getElementById(String(divnum) + "_node" + d.target);
                        if (child != null) {
                            var child_x = parseFloat(child.getAttribute("cx"));
                            var child_y = parseFloat(child.getAttribute("cy"));
                            if (parent_x - child_x == 0) {
                                return parent_x - d.computedWidth/2;
                            } else {
                                var slope = (parent_y - child_y) / (parent_x - child_x);
                                var intercept = parent_y - slope * parent_x;
                                return ((d.y - intercept) / slope) - d.computedWidth/2;
                            }
                        } else {
                            return 0;
                        }
                    } else {
                        return 0;
                    }
                })
                .attr("y", d => d.y - d.computedHeight/2);

            mut_symbol
                .attr("transform", function(d) {
                    var parent = document.getElementById(String(divnum) + "_node" + d.source);
                    if (parent != null) {
                        var parent_x = parseFloat(parent.getAttribute("cx"));
                        var parent_y = parseFloat(parent.getAttribute("cy"));
                        var child = document.getElementById(String(divnum) + "_node" + d.target);
                        if (child != null) {
                            var child_x = parseFloat(child.getAttribute("cx"));
                            var child_y = parseFloat(child.getAttribute("cy"));
                            var slope = (parent_y - child_y) / (parent_x - child_x);
                            var intercept = parent_y - slope * parent_x;
                            var rect = this.children[0];
                            return "rotate(" + String(-Math.atan((child_x-parent_x)/(child_y-parent_y))*180/Math.PI) + ", " + String(parseFloat(rect.getAttribute("x"))+parseFloat(rect.getAttribute("width"))/2) + ", " + String(parseFloat(rect.getAttribute("y"))+parseFloat(rect.getAttribute("height"))/2) + ")";
                        } else {
                            return "rotate(0)";
                        }
                    } else {
                        return "rotate(0)";
                    }
                });
            
            if (label_mutations) {
                mut_symbol_label
                    .attr("transform", function(d) {
                        var y = d.y + 1;
                        var x = 0;
                        var parent = document.getElementById(String(divnum) + "_node" + d.source);
                        if (parent != null) {
                            var parent_x = parseFloat(parent.getAttribute("cx"));
                            var parent_y = parseFloat(parent.getAttribute("cy"));
                            var child = document.getElementById(String(divnum) + "_node" + d.target);
                            if (child != null) {
                                var child_x = parseFloat(child.getAttribute("cx"));
                                var child_y = parseFloat(child.getAttribute("cy"));
                                if (parent_x - child_x == 0) {
                                    x = parent_x;
                                } else {
                                    var slope = (parent_y - child_y) / (parent_x - child_x);
                                    var intercept = parent_y - slope * parent_x;
                                    x = ((d.y - intercept) / slope);
                                }
                            } else {
                                x = 0;
                            }
                        } else {
                            x = 0;
                        }
                        return "translate(" + String(x) + "," + String(y) + ")";
                    });
            }

            function determine_label_positioning(d) {
                if (d.ts_flags & NODE_IS_RE_EVENT || d.parent_of.length == 0 || d.child_of.length == 0) {
                    return "c";
                } else if (d.child_of.length == 1) {
                    var parent = document.getElementById(String(divnum) + "_node" + d.child_of[0])
                    if (parent != null) {
                        var parent_x = parent.getAttribute("cx");
                        if (parent_x > d.x+1) {
                            return "l";
                        } else {
                            return "r";
                        }
                    } else {
                        return "r";
                    }
                } else {
                    return "r";
                }
            };

            label
                .each(function(d) {
                    var l = d3.select(this);
                    var positioning = determine_label_positioning(d);
                    var x = d.x;
                    var anchor = "middle";
                    // Find offsets from CSS
                    const cstyle = getComputedStyle(this)
                    const symbolSize = Math.sqrt(d.size);
                    const cssOffset = cstyle.getPropertyValue('--offset');
                    // default should depend on the symbol size (which is square pixels) and the font size
                    const offset = cssOffset ? parseInt(cssOffset) : symbolSize/2 + parseFloat(cstyle.fontSize)/2;
                    const cssTipoffset = cstyle.getPropertyValue('--tipoffset');
                    // default of 25 if not set: perhaps should be related to the tip symbol size?
                    const tipoffset = cssTipoffset ? parseInt(cssTipoffset) : symbolSize/2 + parseFloat(cstyle.fontSize);
                    if (positioning == "l") {
                        x = d.x - offset;
                        anchor = "end";
                    } else if (positioning == "r") {
                        x = d.x + offset;
                        anchor = "start";
                    }
                    l.attr("text-anchor", anchor);
                    l.attr("transform", function(d) {
                        // adding slightly more spacing in the y-axis when positioning is middle (c)
                        var y = d.y - offset;
                        if (positioning == "c") {
                            y = y - 3;
                        }
                        if (d.parent_of.length == 0) {
                            y = d.y + tipoffset;
                            if (positioning == "c") {
                                y = y + 3;
                            }
                        }
                        // only bother showing up to 4 d.p.
                        return "translate(" + parseFloat(x.toFixed(4)) + "," + parseFloat(y.toFixed(4)) + ")";
                    })
                });

            missing_parents_paths
                .each(function(d) {
                    var l = d3.select(this);
                    l.style("stroke-width", "4px");
                    l.style("stroke-dasharray", "5");
                    l.style("stroke", "gray");
                    l.attr("d", line([[d.x, d.y], [d.x, d.y-30]]));
                });
            
            missing_parents_texts
                .each(function(d) {
                    var l = d3.select(this);
                    l.attr("text-anchor", "middle");
                    l.attr("x", d.x);
                    l.attr("y", d.y-30);
                });

            missing_children_paths
                .each(function(d) {
                    var l = d3.select(this);
                    l.style("stroke-width", "4px");
                    l.style("stroke-dasharray", "5");
                    l.style("stroke", "gray");
                    l.attr("d", line([[d.x, d.y], [d.x, d.y+30]]));
                });
            
            missing_children_texts
                .each(function(d) {
                    var l = d3.select(this);
                    l.attr("text-anchor", "middle");
                    l.attr("x", d.x);
                    l.attr("y", d.y+40);
                });
        }

        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d3.selectAll(div_selector + " .node").classed("ref", function(j) {
                if ((edge_styles.type == "ortho") & (j.id == d.x_pos_reference)) {
                    j.fx = d.x;
                }
            });
            svg.attr("class", "no-hover");
        }

        function dragged(event, d) {
            d.fx = event.x;
            d3.selectAll(div_selector + " .node").classed("ref", function(j) {
                if ((edge_styles.type == "ortho") & (j.id == d.x_pos_reference)) {
                    j.fx = event.x;
                }
            });
        }

        function dragended(event, d) {
            svg.attr("class", null);
        }

        if (tree_highlighting) {
            
            var th_group = svg.append("g").attr("class", "tree_highlighting");
            
            var breakpoint_regions = th_group
                .append("g")
                .attr("class", "breakpoints")
                .selectAll("g")
                .data(graph.breakpoints)
                .enter()
                .append("g")
                .attr("class", d => eval(d.included) ? "included" : null)
                .attr("start", d => d.start)
                .attr("stop", d => d.stop);

            breakpoint_regions
                .append("rect")
                .attr("x", d => d.x_pos)
                .attr("y", height-60)
                .attr("width", d => d.width)
                .attr("height", 40)
                .attr("stroke", "#FFFFFF")
                .attr("stroke-width", 1)
                .attr("fill", d => eval(d.included) ? d.fill : "gray");

            breakpoint_regions
                .append("text")
                .attr("x", d => d.x_pos)
                .attr("y", height-5)
                .attr("class", "label start")
                .style("display", "none")
                .text(d => String(d.start));

            breakpoint_regions
                .append("text")
                .attr("x", d => d.x_pos + d.width)
                .attr("y", height-5)
                .attr("class", "label stop")
                .style("display", "none")
                .text(d => String(d.stop));

            breakpoint_regions
                .on('mouseover', function (event, d) {
                    if (!d3.select(div_selector + ">svg").classed("no-hover")) {
                        if (eval(d.included)) {
                            d3.select(this).selectAll("rect")
                                .style('fill', '#1eebb1')
                                .style("cursor", "pointer");
                            d3.select(this).selectAll("text")
                                .style('display', 'block');
                            d3.selectAll(div_selector + " .endpoints")
                                .style('display', 'none'); /* hide other labels to avoid clashes */
                            var highlight_links = d3.select(div_selector + " .links")
                                .selectAll("g")
                                    .filter(function(j) {
                                        return j.bounds.split(" ").some(function(region) {
                                            region = region.split("-");
                                            return (parseFloat(region[1]) > d.start) & (parseFloat(region[0]) < d.stop)
                                        });
                                    });
                            highlight_links.raise();
                            highlight_links
                                .select(".link")
                                .style("stroke", "#1eebb1");
                        }
                    }
                })
                .on('mouseout', function (event, d) {
                    if (!d3.select(div_selector + ">svg").classed("no-hover")) {
                        if (eval(d.included)) {
                            d3.select(this).selectAll("rect")
                                .style('fill', d.fill)
                                .style("cursor", "default");
                            d3.select(this).selectAll("text")
                                .style('display', 'none');
                            d3.selectAll(div_selector + " .endpoints")
                                .style('display', 'block');
                            d3.selectAll(div_selector + " .link")
                                .style("stroke", d => d.stroke);
                        }
                    }
                });
            
            var endpoints = th_group.append("g").attr("class", "endpoints");
            
            endpoints
                .append("text")
                    .attr("class", "label")
                    .style("text-anchor", "start")
                    .text(graph.breakpoints[0].start)
                    .attr("x", graph.breakpoints[0].x_pos)
                    .attr("y", height-5);
            
            endpoints
                .append("text")
                    .attr("class", "label")
                    .style("text-anchor", "end")
                    .text(graph.breakpoints[graph.breakpoints.length-1].stop)
                    .attr("x", width)
                    .attr("y", height-5);

            var mutation_data = graph.mutations;
            if (condense_mutations) { /* explode the graph.mutations df into one row per mut */
                mutation_data = [];
                graph.mutations.forEach(function(d) {
                    d.mutation_id.forEach(function(x, i) {
                        mutation_data.push({
                            mutation_id: x,
                            site_id: d.site_id[i],
                            edge: d.edge,
                            fill: d.fill,
                            x_pos: d.x_pos[i], 
                            position: d.position[i]
                        });
                    });
                });
            };

            var mutation_data = graph.mutations;
            if (condense_mutations) { /* explode the graph.mutations df into one row per mut */
                mutation_data = [];
                graph.mutations.forEach(function(d) {
                    d.mutation_id.forEach(function(x, i) {
                        mutation_data.push({
                            mutation_id: x,
                            site_id: d.site_id[i],
                            edge: d.edge,
                            fill: d.fill,
                            x_pos: d.x_pos[i], 
                            position: d.position[i]
                        });
                    });
                });
            };

            var site_pos = th_group
                .append("g")
                .attr("class", "sites")
                .selectAll("line")
                .data(mutation_data)  /* NB: one per mutation to allow different line colors */
                .data(mutation_data)  /* NB: one per mutation to allow different line colors */
                .enter()
                .append("g")
                .attr("class", d => "s" + d.site_id + " " + "e" + d.edge + " " + "m" + d.mutation_id)
                .attr("class", d => "s" + d.site_id + " " + "e" + d.edge + " " + "m" + d.mutation_id)
                .attr("transform", d => "translate(" + d.x_pos + "," + (height-60) + ")")
                .style("display", "none");

            function createSiteLine(selection) {
                return selection
                    .append("line")
                    .attr("y1", -5)
                    .attr("y2", 40+5)
                    .style("stroke-width", 3)
                    .style("fill", "none");
            }
                  
            function createSiteText(selection) {
                return selection
                    .append("text")
                    .attr("y", -8)  /* above the tick */
                    .attr("class", "label");
            }
            
            site_pos
                .each(function(d) {
                    const select = d3.select(this);
                    createSiteLine(select)
                        .style("stroke", d.fill);
                    createSiteText(select)
                        .text(String(d.position));
                });
            
            /*
            var mut_text = mut_pos
                .append("text")
                .attr("text-anchor", function(d) {
                    if (d.x_pos > (width*9/10)) {
                        return "end";
                    } else if (d.x_pos < width*1/10) {
                        return "start";
                    } else {
                        return "middle";
                    }
                })
                .style("font-size", "10px")
                .style("font-family", "Arial")
                .attr("fill", d => d.fill)
                .attr("transform", d => "translate(" + String(d.x_pos) + "," + String(height-60-10) + ")");
        
            mut_text
                .text(function(d) {
                    if (label_mutations) {
                        return String(d.site_id) + ":" + String(d.position);
                    } else {
                        return d.label;
                    }
                });
            */
        }

        if (title != "None") {
            svg.append("text")
                .style("font-size", "20px")
                .attr("x", width / 2)
                .attr("text-anchor", "middle")
                .attr("y", 30)
                .each(function() { 
                    multi_line_text.call(this, title, true); 
                });
        }
    }

    draw_force_diagram()
}

/* NB: the code below fires up the visualizer: templates in this call
    can be used to pass in the appropriate data
*/

ensureRequire()
    .then(require => {
        require.config({ paths: {d3: 'https://d3js.org/d3.v7.min'}});
        require(["d3"], function(d3) {
            main_visualizer(d3, 1066235845, {"nodes": [{"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 0, "ts_flags": 1, "time": 0.0, "child_of": [10], "parent_of": [], "x_pos_reference": -1, "label": "0", "fx": 150.0, "fy": 450.0, "y": 450.0}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 1, "ts_flags": 1, "time": 0.0, "child_of": [8], "parent_of": [], "x_pos_reference": -1, "label": "1", "fx": 321.0, "fy": 450.0, "y": 450.0}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 2, "ts_flags": 1, "time": 0.0, "child_of": [8], "parent_of": [], "x_pos_reference": -1, "label": "2", "fx": 379.0, "fy": 450.0, "y": 450.0}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 3, "ts_flags": 1, "time": 0.0, "child_of": [13, 14, 16], "parent_of": [], "x_pos_reference": -1, "label": "3", "fx": 264.0, "fy": 450.0, "y": 450.0}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 4, "ts_flags": 1, "time": 0.0, "child_of": [9], "parent_of": [], "x_pos_reference": -1, "label": "4", "fx": 493.0, "fy": 450.0, "y": 450.0}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 5, "ts_flags": 1, "time": 0.0, "child_of": [9], "parent_of": [], "x_pos_reference": -1, "label": "5", "fx": 550.0, "fy": 450.0, "y": 450.0}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 6, "ts_flags": 1, "time": 0.0, "child_of": [11], "parent_of": [], "x_pos_reference": -1, "label": "6", "fx": 207.0, "fy": 450.0, "y": 450.0}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 7, "ts_flags": 1, "time": 0.0, "child_of": [11], "parent_of": [], "x_pos_reference": -1, "label": "7", "fx": 436.0, "fy": 450.0, "y": 450.0}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 8, "ts_flags": 0, "time": 0.00523931699745691, "child_of": [10], "parent_of": [1, 2], "x_pos_reference": -1, "label": "8", "x": 350.0, "fy": 413.6363636363636, "y": 413.6363636363636}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 9, "ts_flags": 0, "time": 0.017557818091816682, "child_of": [15, 17, 18], "parent_of": [4, 5], "x_pos_reference": -1, "label": "9", "x": 350.0, "fy": 377.27272727272725, "y": 377.27272727272725}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 10, "ts_flags": 0, "time": 0.09416924140000202, "child_of": [12, 15], "parent_of": [0, 8], "x_pos_reference": -1, "label": "10", "x": 350.0, "fy": 340.90909090909093, "y": 340.90909090909093}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 11, "ts_flags": 0, "time": 0.1024650871470267, "child_of": [12, 14, 16], "parent_of": [6, 7], "x_pos_reference": -1, "label": "11", "x": 350.0, "fy": 304.5454545454545, "y": 304.5454545454545}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 12, "ts_flags": 0, "time": 0.12175435946697583, "child_of": [13, 16], "parent_of": [10, 11], "x_pos_reference": -1, "label": "12", "x": 350.0, "fy": 268.18181818181813, "y": 268.18181818181813}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 13, "ts_flags": 0, "time": 0.39582244241347575, "child_of": [17, 18], "parent_of": [3, 12], "x_pos_reference": -1, "label": "13", "x": 350.0, "fy": 231.81818181818184, "y": 231.81818181818184}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 14, "ts_flags": 0, "time": 0.8565089125241158, "child_of": [17], "parent_of": [3, 11], "x_pos_reference": -1, "label": "14", "x": 350.0, "fy": 195.45454545454547, "y": 195.45454545454547}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 15, "ts_flags": 0, "time": 1.0352810563867096, "child_of": [17], "parent_of": [9, 10], "x_pos_reference": -1, "label": "15", "x": 350.0, "fy": 159.09090909090907, "y": 159.09090909090907}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 16, "ts_flags": 0, "time": 2.033597596813773, "child_of": [17], "parent_of": [3, 11, 12], "x_pos_reference": -1, "label": "16", "x": 350.0, "fy": 122.7272727272727, "y": 122.7272727272727}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 17, "ts_flags": 0, "time": 3.30638247068103, "child_of": [], "parent_of": [9, 13, 14, 15, 16], "x_pos_reference": -1, "label": "17", "x": 350.0, "fy": 86.36363636363633, "y": 86.36363636363633}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 18, "ts_flags": 0, "time": 4.9385528685650755, "child_of": [], "parent_of": [9, 13], "x_pos_reference": -1, "label": "18", "x": 350.0, "fy": 50.0, "y": 50.0}], "links": [{"id": 0, "source": 8, "source_time": 0.00523931699745691, "target": 1, "target_time": 0.0, "bounds": "0.0-1000.0", "alt_parent": -1, "alt_child": 2, "region_fraction": 1.0, "stroke": "#053e4e"}, {"id": 1, "source": 8, "source_time": 0.00523931699745691, "target": 2, "target_time": 0.0, "bounds": "0.0-1000.0", "alt_parent": -1, "alt_child": 1, "region_fraction": 1.0, "stroke": "#053e4e"}, {"id": 2, "source": 9, "source_time": 0.017557818091816682, "target": 4, "target_time": 0.0, "bounds": "0.0-1000.0", "alt_parent": -1, "alt_child": 5, "region_fraction": 1.0, "stroke": "#053e4e"}, {"id": 3, "source": 9, "source_time": 0.017557818091816682, "target": 5, "target_time": 0.0, "bounds": "0.0-1000.0", "alt_parent": -1, "alt_child": 4, "region_fraction": 1.0, "stroke": "#053e4e"}, {"id": 4, "source": 10, "source_time": 0.09416924140000202, "target": 0, "target_time": 0.0, "bounds": "0.0-1000.0", "alt_parent": -1, "alt_child": 8, "region_fraction": 1.0, "stroke": "#053e4e"}, {"id": 5, "source": 10, "source_time": 0.09416924140000202, "target": 8, "target_time": 0.00523931699745691, "bounds": "0.0-1000.0", "alt_parent": -1, "alt_child": 0, "region_fraction": 1.0, "stroke": "#053e4e"}, {"id": 6, "source": 11, "source_time": 0.1024650871470267, "target": 6, "target_time": 0.0, "bounds": "0.0-1000.0", "alt_parent": -1, "alt_child": 7, "region_fraction": 1.0, "stroke": "#053e4e"}, {"id": 7, "source": 11, "source_time": 0.1024650871470267, "target": 7, "target_time": 0.0, "bounds": "0.0-1000.0", "alt_parent": -1, "alt_child": 6, "region_fraction": 1.0, "stroke": "#053e4e"}, {"id": 8, "source": 12, "source_time": 0.12175435946697583, "target": 10, "target_time": 0.09416924140000202, "bounds": "0.0-763.0", "alt_parent": -1, "alt_child": 11, "region_fraction": 0.763, "stroke": "#053e4e"}, {"id": 9, "source": 12, "source_time": 0.12175435946697583, "target": 11, "target_time": 0.1024650871470267, "bounds": "0.0-763.0", "alt_parent": -1, "alt_child": 10, "region_fraction": 0.763, "stroke": "#053e4e"}, {"id": 10, "source": 13, "source_time": 0.39582244241347575, "target": 3, "target_time": 0.0, "bounds": "0.0-224.0", "alt_parent": -1, "alt_child": 12, "region_fraction": 0.224, "stroke": "#053e4e"}, {"id": 11, "source": 13, "source_time": 0.39582244241347575, "target": 12, "target_time": 0.12175435946697583, "bounds": "0.0-224.0", "alt_parent": -1, "alt_child": 3, "region_fraction": 0.224, "stroke": "#053e4e"}, {"id": 12, "source": 14, "source_time": 0.8565089125241158, "target": 3, "target_time": 0.0, "bounds": "835.0-1000.0", "alt_parent": -1, "alt_child": 11, "region_fraction": 0.165, "stroke": "#053e4e"}, {"id": 13, "source": 14, "source_time": 0.8565089125241158, "target": 11, "target_time": 0.1024650871470267, "bounds": "835.0-1000.0", "alt_parent": -1, "alt_child": 3, "region_fraction": 0.165, "stroke": "#053e4e"}, {"id": 14, "source": 15, "source_time": 1.0352810563867096, "target": 9, "target_time": 0.017557818091816682, "bounds": "763.0-1000.0", "alt_parent": -1, "alt_child": 10, "region_fraction": 0.237, "stroke": "#053e4e"}, {"id": 15, "source": 15, "source_time": 1.0352810563867096, "target": 10, "target_time": 0.09416924140000202, "bounds": "763.0-1000.0", "alt_parent": -1, "alt_child": 9, "region_fraction": 0.237, "stroke": "#053e4e"}, {"id": 16, "source": 16, "source_time": 2.033597596813773, "target": 3, "target_time": 0.0, "bounds": "224.0-835.0", "alt_parent": -1, "alt_child": 11, "region_fraction": 0.611, "stroke": "#053e4e"}, {"id": 17, "source": 16, "source_time": 2.033597596813773, "target": 11, "target_time": 0.1024650871470267, "bounds": "763.0-835.0", "alt_parent": -1, "alt_child": 3, "region_fraction": 0.072, "stroke": "#053e4e"}, {"id": 18, "source": 16, "source_time": 2.033597596813773, "target": 12, "target_time": 0.12175435946697583, "bounds": "224.0-763.0", "alt_parent": -1, "alt_child": 3, "region_fraction": 0.539, "stroke": "#053e4e"}, {"id": 19, "source": 17, "source_time": 3.30638247068103, "target": 9, "target_time": 0.017557818091816682, "bounds": "145.0-763.0", "alt_parent": -1, "alt_child": 13, "region_fraction": 0.618, "stroke": "#053e4e"}, {"id": 20, "source": 17, "source_time": 3.30638247068103, "target": 13, "target_time": 0.39582244241347575, "bounds": "145.0-224.0", "alt_parent": -1, "alt_child": 9, "region_fraction": 0.079, "stroke": "#053e4e"}, {"id": 21, "source": 17, "source_time": 3.30638247068103, "target": 14, "target_time": 0.8565089125241158, "bounds": "835.0-1000.0", "alt_parent": -1, "alt_child": 9, "region_fraction": 0.165, "stroke": "#053e4e"}, {"id": 22, "source": 17, "source_time": 3.30638247068103, "target": 15, "target_time": 1.0352810563867096, "bounds": "763.0-1000.0", "alt_parent": -1, "alt_child": 9, "region_fraction": 0.237, "stroke": "#053e4e"}, {"id": 23, "source": 17, "source_time": 3.30638247068103, "target": 16, "target_time": 2.033597596813773, "bounds": "224.0-835.0", "alt_parent": -1, "alt_child": 9, "region_fraction": 0.611, "stroke": "#053e4e"}, {"id": 24, "source": 18, "source_time": 4.9385528685650755, "target": 9, "target_time": 0.017557818091816682, "bounds": "0.0-145.0", "alt_parent": -1, "alt_child": 13, "region_fraction": 0.145, "stroke": "#053e4e"}, {"id": 25, "source": 18, "source_time": 4.9385528685650755, "target": 13, "target_time": 0.39582244241347575, "bounds": "0.0-145.0", "alt_parent": -1, "alt_child": 9, "region_fraction": 0.145, "stroke": "#053e4e"}], "mutations": [], "breakpoints": [{"id": 0, "start": 0.0, "stop": 145.0, "x_pos_01": 0.0, "width_01": 0.145, "fill": "#053e4e", "x_pos": 100.0, "width": 72.5, "included": "true"}, {"id": 1, "start": 145.0, "stop": 224.0, "x_pos_01": 0.145, "width_01": 0.079, "fill": "#053e4e", "x_pos": 172.5, "width": 39.5, "included": "true"}, {"id": 2, "start": 224.0, "stop": 763.0, "x_pos_01": 0.224, "width_01": 0.539, "fill": "#053e4e", "x_pos": 212.0, "width": 269.5, "included": "true"}, {"id": 3, "start": 763.0, "stop": 835.0, "x_pos_01": 0.763, "width_01": 0.072, "fill": "#053e4e", "x_pos": 481.5, "width": 36.0, "included": "true"}, {"id": 4, "start": 835.0, "stop": 1000.0, "x_pos_01": 0.835, "width_01": 0.165, "fill": "#053e4e", "x_pos": 517.5, "width": 82.5, "included": "true"}], "evenly_distributed_positions": [150.0, 207.0, 264.0, 321.0, 379.0, 436.0, 493.0, 550.0]}, 600, 575, {"title": "Time ago (generations)", "units": "generations", "include_labels": "true", "ticks": [450.0, 413.6363636363636, 377.27272727272725, 340.90909090909093, 304.5454545454545, 268.18181818181813, 231.81818181818184, 195.45454545454547, 159.09090909090907, 122.7272727272727, 86.36363636363633, 50.0], "text": [0.0, 0.005, 0.018, 0.094, 0.102, 0.122, 0.396, 0.857, 1.035, 2.034, 3.306, 4.939], "max_min": [450.0, 50.0], "scale": "rank"}, {"type": "line", "variable_width": true, "include_underlink": true}, false, false, true, null, false, "full", null, "{\"data\": {\"nodes\": [{\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 0, \"ts_flags\": 1, \"time\": 0.0, \"child_of\": [10], \"parent_of\": [], \"x_pos_reference\": -1, \"label\": \"0\", \"fx\": 150.0, \"fy\": 450.0, \"y\": 450.0}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 1, \"ts_flags\": 1, \"time\": 0.0, \"child_of\": [8], \"parent_of\": [], \"x_pos_reference\": -1, \"label\": \"1\", \"fx\": 321.0, \"fy\": 450.0, \"y\": 450.0}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 2, \"ts_flags\": 1, \"time\": 0.0, \"child_of\": [8], \"parent_of\": [], \"x_pos_reference\": -1, \"label\": \"2\", \"fx\": 379.0, \"fy\": 450.0, \"y\": 450.0}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 3, \"ts_flags\": 1, \"time\": 0.0, \"child_of\": [13, 14, 16], \"parent_of\": [], \"x_pos_reference\": -1, \"label\": \"3\", \"fx\": 264.0, \"fy\": 450.0, \"y\": 450.0}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 4, \"ts_flags\": 1, \"time\": 0.0, \"child_of\": [9], \"parent_of\": [], \"x_pos_reference\": -1, \"label\": \"4\", \"fx\": 493.0, \"fy\": 450.0, \"y\": 450.0}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 5, \"ts_flags\": 1, \"time\": 0.0, \"child_of\": [9], \"parent_of\": [], \"x_pos_reference\": -1, \"label\": \"5\", \"fx\": 550.0, \"fy\": 450.0, \"y\": 450.0}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 6, \"ts_flags\": 1, \"time\": 0.0, \"child_of\": [11], \"parent_of\": [], \"x_pos_reference\": -1, \"label\": \"6\", \"fx\": 207.0, \"fy\": 450.0, \"y\": 450.0}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 7, \"ts_flags\": 1, \"time\": 0.0, \"child_of\": [11], \"parent_of\": [], \"x_pos_reference\": -1, \"label\": \"7\", \"fx\": 436.0, \"fy\": 450.0, \"y\": 450.0}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 8, \"ts_flags\": 0, \"time\": 0.00523931699745691, \"child_of\": [10], \"parent_of\": [1, 2], \"x_pos_reference\": -1, \"label\": \"8\", \"x\": 350.0, \"fy\": 413.6363636363636, \"y\": 413.6363636363636}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 9, \"ts_flags\": 0, \"time\": 0.017557818091816682, \"child_of\": [15, 17, 18], \"parent_of\": [4, 5], \"x_pos_reference\": -1, \"label\": \"9\", \"x\": 350.0, \"fy\": 377.27272727272725, \"y\": 377.27272727272725}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 10, \"ts_flags\": 0, \"time\": 0.09416924140000202, \"child_of\": [12, 15], \"parent_of\": [0, 8], \"x_pos_reference\": -1, \"label\": \"10\", \"x\": 350.0, \"fy\": 340.90909090909093, \"y\": 340.90909090909093}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 11, \"ts_flags\": 0, \"time\": 0.1024650871470267, \"child_of\": [12, 14, 16], \"parent_of\": [6, 7], \"x_pos_reference\": -1, \"label\": \"11\", \"x\": 350.0, \"fy\": 304.5454545454545, \"y\": 304.5454545454545}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 12, \"ts_flags\": 0, \"time\": 0.12175435946697583, \"child_of\": [13, 16], \"parent_of\": [10, 11], \"x_pos_reference\": -1, \"label\": \"12\", \"x\": 350.0, \"fy\": 268.18181818181813, \"y\": 268.18181818181813}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 13, \"ts_flags\": 0, \"time\": 0.39582244241347575, \"child_of\": [17, 18], \"parent_of\": [3, 12], \"x_pos_reference\": -1, \"label\": \"13\", \"x\": 350.0, \"fy\": 231.81818181818184, \"y\": 231.81818181818184}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 14, \"ts_flags\": 0, \"time\": 0.8565089125241158, \"child_of\": [17], \"parent_of\": [3, 11], \"x_pos_reference\": -1, \"label\": \"14\", \"x\": 350.0, \"fy\": 195.45454545454547, \"y\": 195.45454545454547}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 15, \"ts_flags\": 0, \"time\": 1.0352810563867096, \"child_of\": [17], \"parent_of\": [9, 10], \"x_pos_reference\": -1, \"label\": \"15\", \"x\": 350.0, \"fy\": 159.09090909090907, \"y\": 159.09090909090907}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 16, \"ts_flags\": 0, \"time\": 2.033597596813773, \"child_of\": [17], \"parent_of\": [3, 11, 12], \"x_pos_reference\": -1, \"label\": \"16\", \"x\": 350.0, \"fy\": 122.7272727272727, \"y\": 122.7272727272727}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 17, \"ts_flags\": 0, \"time\": 3.30638247068103, \"child_of\": [], \"parent_of\": [9, 13, 14, 15, 16], \"x_pos_reference\": -1, \"label\": \"17\", \"x\": 350.0, \"fy\": 86.36363636363633, \"y\": 86.36363636363633}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 18, \"ts_flags\": 0, \"time\": 4.9385528685650755, \"child_of\": [], \"parent_of\": [9, 13], \"x_pos_reference\": -1, \"label\": \"18\", \"x\": 350.0, \"fy\": 50.0, \"y\": 50.0}], \"links\": [{\"id\": 0, \"source\": 8, \"source_time\": 0.00523931699745691, \"target\": 1, \"target_time\": 0.0, \"bounds\": \"0.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 2, \"region_fraction\": 1.0, \"stroke\": \"#053e4e\"}, {\"id\": 1, \"source\": 8, \"source_time\": 0.00523931699745691, \"target\": 2, \"target_time\": 0.0, \"bounds\": \"0.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 1, \"region_fraction\": 1.0, \"stroke\": \"#053e4e\"}, {\"id\": 2, \"source\": 9, \"source_time\": 0.017557818091816682, \"target\": 4, \"target_time\": 0.0, \"bounds\": \"0.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 5, \"region_fraction\": 1.0, \"stroke\": \"#053e4e\"}, {\"id\": 3, \"source\": 9, \"source_time\": 0.017557818091816682, \"target\": 5, \"target_time\": 0.0, \"bounds\": \"0.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 4, \"region_fraction\": 1.0, \"stroke\": \"#053e4e\"}, {\"id\": 4, \"source\": 10, \"source_time\": 0.09416924140000202, \"target\": 0, \"target_time\": 0.0, \"bounds\": \"0.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 8, \"region_fraction\": 1.0, \"stroke\": \"#053e4e\"}, {\"id\": 5, \"source\": 10, \"source_time\": 0.09416924140000202, \"target\": 8, \"target_time\": 0.00523931699745691, \"bounds\": \"0.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 0, \"region_fraction\": 1.0, \"stroke\": \"#053e4e\"}, {\"id\": 6, \"source\": 11, \"source_time\": 0.1024650871470267, \"target\": 6, \"target_time\": 0.0, \"bounds\": \"0.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 7, \"region_fraction\": 1.0, \"stroke\": \"#053e4e\"}, {\"id\": 7, \"source\": 11, \"source_time\": 0.1024650871470267, \"target\": 7, \"target_time\": 0.0, \"bounds\": \"0.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 6, \"region_fraction\": 1.0, \"stroke\": \"#053e4e\"}, {\"id\": 8, \"source\": 12, \"source_time\": 0.12175435946697583, \"target\": 10, \"target_time\": 0.09416924140000202, \"bounds\": \"0.0-763.0\", \"alt_parent\": -1, \"alt_child\": 11, \"region_fraction\": 0.763, \"stroke\": \"#053e4e\"}, {\"id\": 9, \"source\": 12, \"source_time\": 0.12175435946697583, \"target\": 11, \"target_time\": 0.1024650871470267, \"bounds\": \"0.0-763.0\", \"alt_parent\": -1, \"alt_child\": 10, \"region_fraction\": 0.763, \"stroke\": \"#053e4e\"}, {\"id\": 10, \"source\": 13, \"source_time\": 0.39582244241347575, \"target\": 3, \"target_time\": 0.0, \"bounds\": \"0.0-224.0\", \"alt_parent\": -1, \"alt_child\": 12, \"region_fraction\": 0.224, \"stroke\": \"#053e4e\"}, {\"id\": 11, \"source\": 13, \"source_time\": 0.39582244241347575, \"target\": 12, \"target_time\": 0.12175435946697583, \"bounds\": \"0.0-224.0\", \"alt_parent\": -1, \"alt_child\": 3, \"region_fraction\": 0.224, \"stroke\": \"#053e4e\"}, {\"id\": 12, \"source\": 14, \"source_time\": 0.8565089125241158, \"target\": 3, \"target_time\": 0.0, \"bounds\": \"835.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 11, \"region_fraction\": 0.165, \"stroke\": \"#053e4e\"}, {\"id\": 13, \"source\": 14, \"source_time\": 0.8565089125241158, \"target\": 11, \"target_time\": 0.1024650871470267, \"bounds\": \"835.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 3, \"region_fraction\": 0.165, \"stroke\": \"#053e4e\"}, {\"id\": 14, \"source\": 15, \"source_time\": 1.0352810563867096, \"target\": 9, \"target_time\": 0.017557818091816682, \"bounds\": \"763.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 10, \"region_fraction\": 0.237, \"stroke\": \"#053e4e\"}, {\"id\": 15, \"source\": 15, \"source_time\": 1.0352810563867096, \"target\": 10, \"target_time\": 0.09416924140000202, \"bounds\": \"763.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 9, \"region_fraction\": 0.237, \"stroke\": \"#053e4e\"}, {\"id\": 16, \"source\": 16, \"source_time\": 2.033597596813773, \"target\": 3, \"target_time\": 0.0, \"bounds\": \"224.0-835.0\", \"alt_parent\": -1, \"alt_child\": 11, \"region_fraction\": 0.611, \"stroke\": \"#053e4e\"}, {\"id\": 17, \"source\": 16, \"source_time\": 2.033597596813773, \"target\": 11, \"target_time\": 0.1024650871470267, \"bounds\": \"763.0-835.0\", \"alt_parent\": -1, \"alt_child\": 3, \"region_fraction\": 0.072, \"stroke\": \"#053e4e\"}, {\"id\": 18, \"source\": 16, \"source_time\": 2.033597596813773, \"target\": 12, \"target_time\": 0.12175435946697583, \"bounds\": \"224.0-763.0\", \"alt_parent\": -1, \"alt_child\": 3, \"region_fraction\": 0.539, \"stroke\": \"#053e4e\"}, {\"id\": 19, \"source\": 17, \"source_time\": 3.30638247068103, \"target\": 9, \"target_time\": 0.017557818091816682, \"bounds\": \"145.0-763.0\", \"alt_parent\": -1, \"alt_child\": 13, \"region_fraction\": 0.618, \"stroke\": \"#053e4e\"}, {\"id\": 20, \"source\": 17, \"source_time\": 3.30638247068103, \"target\": 13, \"target_time\": 0.39582244241347575, \"bounds\": \"145.0-224.0\", \"alt_parent\": -1, \"alt_child\": 9, \"region_fraction\": 0.079, \"stroke\": \"#053e4e\"}, {\"id\": 21, \"source\": 17, \"source_time\": 3.30638247068103, \"target\": 14, \"target_time\": 0.8565089125241158, \"bounds\": \"835.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 9, \"region_fraction\": 0.165, \"stroke\": \"#053e4e\"}, {\"id\": 22, \"source\": 17, \"source_time\": 3.30638247068103, \"target\": 15, \"target_time\": 1.0352810563867096, \"bounds\": \"763.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 9, \"region_fraction\": 0.237, \"stroke\": \"#053e4e\"}, {\"id\": 23, \"source\": 17, \"source_time\": 3.30638247068103, \"target\": 16, \"target_time\": 2.033597596813773, \"bounds\": \"224.0-835.0\", \"alt_parent\": -1, \"alt_child\": 9, \"region_fraction\": 0.611, \"stroke\": \"#053e4e\"}, {\"id\": 24, \"source\": 18, \"source_time\": 4.9385528685650755, \"target\": 9, \"target_time\": 0.017557818091816682, \"bounds\": \"0.0-145.0\", \"alt_parent\": -1, \"alt_child\": 13, \"region_fraction\": 0.145, \"stroke\": \"#053e4e\"}, {\"id\": 25, \"source\": 18, \"source_time\": 4.9385528685650755, \"target\": 13, \"target_time\": 0.39582244241347575, \"bounds\": \"0.0-145.0\", \"alt_parent\": -1, \"alt_child\": 9, \"region_fraction\": 0.145, \"stroke\": \"#053e4e\"}], \"mutations\": [], \"breakpoints\": [{\"id\": 0, \"start\": 0.0, \"stop\": 145.0, \"x_pos_01\": 0.0, \"width_01\": 0.145, \"fill\": \"#053e4e\", \"x_pos\": 100.0, \"width\": 72.5, \"included\": \"true\"}, {\"id\": 1, \"start\": 145.0, \"stop\": 224.0, \"x_pos_01\": 0.145, \"width_01\": 0.079, \"fill\": \"#053e4e\", \"x_pos\": 172.5, \"width\": 39.5, \"included\": \"true\"}, {\"id\": 2, \"start\": 224.0, \"stop\": 763.0, \"x_pos_01\": 0.224, \"width_01\": 0.539, \"fill\": \"#053e4e\", \"x_pos\": 212.0, \"width\": 269.5, \"included\": \"true\"}, {\"id\": 3, \"start\": 763.0, \"stop\": 835.0, \"x_pos_01\": 0.763, \"width_01\": 0.072, \"fill\": \"#053e4e\", \"x_pos\": 481.5, \"width\": 36.0, \"included\": \"true\"}, {\"id\": 4, \"start\": 835.0, \"stop\": 1000.0, \"x_pos_01\": 0.835, \"width_01\": 0.165, \"fill\": \"#053e4e\", \"x_pos\": 517.5, \"width\": 82.5, \"included\": \"true\"}], \"evenly_distributed_positions\": [150.0, 207.0, 264.0, 321.0, 379.0, 436.0, 493.0, 550.0]}, \"width\": 600, \"height\": 575, \"y_axis\": {\"title\": \"Time ago (generations)\", \"units\": \"generations\", \"include_labels\": \"true\", \"ticks\": [450.0, 413.6363636363636, 377.27272727272725, 340.90909090909093, 304.5454545454545, 268.18181818181813, 231.81818181818184, 195.45454545454547, 159.09090909090907, 122.7272727272727, 86.36363636363633, 50.0], \"text\": [0.0, 0.005, 0.018, 0.094, 0.102, 0.122, 0.396, 0.857, 1.035, 2.034, 3.306, 4.939], \"max_min\": [450.0, 50.0], \"scale\": \"rank\"}, \"edges\": {\"type\": \"line\", \"variable_width\": true, \"include_underlink\": true}, \"condense_mutations\": false, \"label_mutations\": false, \"tree_highlighting\": true, \"rotate_tip_labels\": false, \"plot_type\": \"full\", \"default_node_style\": {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4}, \"title\": null, \"preamble\": null, \"save_filename\": \"tskit_arg_visualizer\"}", "tskit_arg_visualizer")
        });
    })
    .catch(err => console.error('Failed to load require.js:', err));

</script></div></div>
</div>
<p>For an <code class="docutils literal notranslate"><span class="pre">msprime</span></code> “full ARG” tree sequence, <code class="docutils literal notranslate"><span class="pre">edge_type=&quot;ortho&quot;</span></code> can be used to draw a
traditional “<a class="reference internal" href="args.html#sec-args"><span class="std std-ref">Ancestral Recombination Graph</span></a>” style plot (variable edge widths
turned off for clarity):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">msprime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tskit_arg_visualizer</span>
<span class="n">tip_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">full_arg_ts</span> <span class="o">=</span> <span class="n">msprime</span><span class="o">.</span><span class="n">sim_ancestry</span><span class="p">(</span>
    <span class="mi">4</span><span class="p">,</span> <span class="n">sequence_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">recombination_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">record_full_arg</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">d3arg</span> <span class="o">=</span> <span class="n">tskit_arg_visualizer</span><span class="o">.</span><span class="n">D3ARG</span><span class="o">.</span><span class="n">from_ts</span><span class="p">(</span><span class="n">ts</span><span class="o">=</span><span class="n">full_arg_ts</span><span class="p">)</span>
<span class="n">d3arg</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">edge_type</span><span class="o">=</span><span class="s2">&quot;ortho&quot;</span><span class="p">,</span> <span class="n">sample_order</span><span class="o">=</span><span class="n">tip_order</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>.d3arg {
    position: relative;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background-color: white;
    padding: 20px 20px 60px 20px;
}

.d3arg:hover .dashboard {
    visibility: visible;
}

.d3arg .dashboard {
    display: flex;
    visibility: hidden;
}

.d3arg .dashboard .dashbutton {
    position: relative;
    font-size: 30px;
    border: 0px;
    background-color: white;
    width: 30px;
    height: 30px;
}

.d3arg .dashboard .dashbutton .tip {
    width: 150px;
    font-size: 12px;
    background-color: lightgrey;
    color: #053e4e;
    text-align: center;
    padding: 5px 0px;
    position: absolute;
    z-index: 1;
    top: 100%;
    left: 50%; 
    margin-left: -60px;
    visibility: hidden;
}

.d3arg .dashboard .dashbutton:hover .desc {
    visibility: visible;
}

.d3arg .dashboard path {
    fill: grey;
}

.d3arg .dashboard .dashbutton:hover path {
    fill: #053e4e;
}

.d3arg .dashboard .activecolor:active path {
    fill: #1eebb1;
}

.d3arg .savemethods, .d3arg .labelmethods {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: row;
    flex-wrap: wrap;
}

.d3arg .savemethods button, .d3arg .labelmethods button {
    background-color: lightgrey;
    color: #053e4e;
    font-size: 12px;
    width: auto;
    border: none;
}

.d3arg .savemethods button:hover, .d3arg .labelmethods button:hover {
    color: #1eebb1;
}

.d3arg .labelmethods button.node-labels-default {
    text-decoration: underline;
}

.d3arg .yaxis path {
    stroke: #053e4e;
    stroke-width: 3px;
}

.d3arg .yaxis line {
    stroke: #053e4e;
    stroke-width: 3px;
}

.d3arg .yaxis text {
    fill: #053e4e;
    stroke: 1px;
}

.d3arg .hiddennode {
    fill: lightgrey;
    stroke: lightgrey;
    stroke-width: 4px;
}

.d3arg .underlink {
    stroke: #ffffff;
    stroke-width: 12px;
    fill: none;
}

.d3arg .hiddenlink {
    stroke: lightgrey;
    stroke-width: 4px;
    fill: none;
}

.d3arg .labels {
    text-anchor: middle;
}

.d3arg .label {
    fill: #053e4e;
    font-family: Arial;
    font-size: 12px;
}

.d3arg .label.start {
    text-anchor: start;
}

.d3arg .label.stop {
    text-anchor: end;
}

.d3arg .hiddenlabel {
    fill: lightgrey;
    font-family: Arial;
    font-size: 12px;
}

.d3arg svg {
    display: block;
}

.d3arg button {
    display: block;
    cursor: pointer;
}

.d3arg .saving {
    display: flex;
    flex-direction: row;
}

.d3arg .saving .message {
    display: none;
}

.d3arg .tooltip {
    position: absolute;
    max-width: 500px;
    padding: 10px;
    background-color: white;
    color: black;
    text-align: center;
    z-index: 9999;
}

.d3arg .sites text {
    text-anchor: middle;
}</style><div id="arg_8823157229" class="d3arg" style="min-width:640.0px; min-height:655.0px;"></div><script>function parseRgbString(rgbString) {
  const match = rgbString.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d*\.?\d+))?\)/);
  if (match) {
    const r = parseInt(match[1]);
    const g = parseInt(match[2]);
    const b = parseInt(match[3]);
    const a = match[4] ? parseFloat(match[4]) : 1; // Default alpha to 1 if not present
    return { r, g, b, a };
  }
  return null; // Or throw an error for invalid format
}

function ensureRequire() {
    // Needed e.g. in Jupyter notebooks: if require is already available, return resolved promise
    if (typeof require !== 'undefined') {
        return Promise.resolve(require);
    }

    // Otherwise, dynamically load require.js
    return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js';
        script.onload = () => resolve(require);
        script.onerror = reject;
        document.head.appendChild(script);
    });
};

function main_visualizer(
    d3,
    divnum,
    graph,
    width,
    height,
    y_axis,
    edge_styles,
    condense_mutations,
    label_mutations,
    tree_highlighting,
    title,
    rotate_tip_labels,
    plot_type,
    preamble,
    source,
    filename_for_saving,
) {
    /*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
    
    function download (url, name, opts) {
        var xhr = new XMLHttpRequest()
        xhr.open('GET', url)
        xhr.responseType = 'blob'
        xhr.onload = function () {
            saveAs(xhr.response, name, opts)
        }
        xhr.onerror = function () {
            console.error('could not download file')
        }
        xhr.send()
    }
    
    function corsEnabled (url) {
        var xhr = new XMLHttpRequest()
        // use sync to avoid popup blocker
        xhr.open('HEAD', url, false)
        try {
            xhr.send()
        } catch (e) {}
        return xhr.status >= 200 && xhr.status <= 299
    }
    
    // 'a.click()' doesn't work for all browsers (#465)
    function click (node) {
        try {
            node.dispatchEvent(new MouseEvent('click'))
        } catch (e) {
            var evt = document.createEvent('MouseEvents')
            evt.initMouseEvent('click', true, true, window, 0, 0, 0, 80,
                                20, false, false, false, false, 0, null)
            node.dispatchEvent(evt)
        }
    }
    
    function saveAs (blob, name, opts) {
        var URL = URL || webkitURL
        // Namespace is used to prevent conflict w/ Chrome Poper Blocker extension (Issue #561)
        var a = document.createElementNS('http://www.w3.org/1999/xhtml', 'a')
        name = name || blob.name || 'download'

        a.download = name
        a.rel = 'noopener' // tabnabbing

        // TODO: detect chrome extensions & packaged apps
        // a.target = '_blank'

        if (typeof blob === 'string') {
            // Support regular links
            a.href = blob
            if (a.origin !== location.origin) {
            corsEnabled(a.href)
                ? download(blob, name, opts)
                : click(a, a.target = '_blank')
            } else {
            click(a)
            }
        } else {
            // Support blobs
            a.href = URL.createObjectURL(blob)
            setTimeout(function () { URL.revokeObjectURL(a.href) }, 4E4) // 40s
            setTimeout(function () { click(a) }, 0)
        }
    }

    const NODE_IS_SAMPLE = 1;
    const NODE_IS_RE_EVENT = 131072;
    var line = d3.line();
    var step = d3.line().curve(d3.curveStep);
    var stepAfter = d3.line().curve(d3.curveStepAfter);
    var stepBefore = d3.line().curve(d3.curveStepBefore);


    // https://gist.github.com/Rokotyan/0556f8facbaf344507cdc45dc3622177
    // Below are the functions that handle actual exporting:
    // getSVGString ( svgNode ) and svgString2Image( svgString, width, height, format, callback )
    function getSVGString( svgNode ) {
        svgNode.setAttribute('xlink', 'http://www.w3.org/1999/xlink');
        var cssStyleText = getCSSStyles();
        appendCSS( cssStyleText, svgNode );
        var serializer = new XMLSerializer();
        var svgString = serializer.serializeToString(svgNode);
        svgString = svgString.replace(/(\w+)?:?xlink=/g, 'xmlns:xlink='); // Fix root xlink without namespace
        svgString = svgString.replace(/NS\d+:href/g, 'xlink:href'); // Safari NS namespace fix
        return svgString;

        function getCSSStyles() {
            // Extract CSS Rules
            var extractedCSSText = "";
            for (var i = 0; i < document.styleSheets.length; i++) { // this could be improved as it loops through all stylings on page
                var s = document.styleSheets[i];
                try {
                    if(!s.cssRules) continue;
                } catch( e ) {
                    if(e.name !== 'SecurityError') throw e; // for Firefox
                    continue;
                }
                var cssRules = s.cssRules;
                for (var r = 0; r < cssRules.length; r++) {
                    extractedCSSText += cssRules[r].cssText.replace(".d3arg ", ""); // removing reference to d3arg
                }
            }
            return extractedCSSText;

        }

        function appendCSS( cssText, element ) {
            var styleElement = document.createElement("style");
            styleElement.setAttribute("type","text/css"); 
            styleElement.innerHTML = cssText;
            var refNode = element.hasChildNodes() ? element.children[0] : null;
            element.insertBefore( styleElement, refNode );
        }
    }


    function svgString2Image( svgString, width, height, format, callback ) {
        var format = format ? format : 'png';
        var imgsrc = 'data:image/svg+xml;base64,'+ btoa( unescape( encodeURIComponent( svgString ) ) ); // Convert SVG string to data URL
        var canvas = document.createElement("canvas");
        var context = canvas.getContext("2d");
        canvas.width = width;
        canvas.height = height;
        var image = new Image();
        image.onload = function() {
            context.clearRect ( 0, 0, width, height);
            context.drawImage(image, 0, 0, width, height);
            canvas.toBlob( function(blob) {
                var filesize = Math.round( blob.length/1024 ) + ' KB';
                if ( callback ) callback( blob, filesize );
            });
        };
        image.src = imgsrc;
    }

    function draw_force_diagram() {
        var evenly_distributed_positions = graph.evenly_distributed_positions;
        var div_selector = "#arg_" + String(divnum);
        if (preamble) {
            d3.select(div_selector).html(preamble);
        }
        var tip = d3.select(div_selector).append("div")
            .attr("class", "tooltip")
            .style("display", "none");

        var dashboard = d3.select(div_selector).append("div").attr("class", "dashboard");
        
        var saving = dashboard.append("button").attr("class", "dashbutton");
        saving.append("svg") //<!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
            .attr("xmlns", "http://www.w3.org/2000/svg")
            .attr("viewBox", "0 0 512 512")
            .append("path")
            .attr("d", "M288 32c0-17.7-14.3-32-32-32s-32 14.3-32 32V274.7l-73.4-73.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l128 128c12.5 12.5 32.8 12.5 45.3 0l128-128c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L288 274.7V32zM64 352c-35.3 0-64 28.7-64 64v32c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V416c0-35.3-28.7-64-64-64H346.5l-45.3 45.3c-25 25-65.5 25-90.5 0L165.5 352H64zm368 56a24 24 0 1 1 0 48 24 24 0 1 1 0-48z");
        var saving_methods = saving.append("span").attr("class", "tip desc");
        var methods = saving_methods.append("div").text("Download As:").append("div").attr("class", "savemethods")

        methods.append("button").text("JSON")
            .on("click", function() {
                d3.selectAll(div_selector + " .node").classed("fix", function(d) {
                    d.fx = d.x;
                });
                src = JSON.parse(source);
                src.data.nodes = graph.nodes;
                var textBlob = new Blob([JSON.stringify(src)], {type: "text/plain"});
                saveAs(textBlob, filename_for_saving + ".json");
            });
        methods.append("button").text("SVG")
            .on('click', function(){
                var svgString = getSVGString(svg.node());
                var svgBlob = new Blob([svgString], {type:"image/svg+xml;charset=utf-8"});
                saveAs(svgBlob, filename_for_saving);
            });
        methods.append("button").text("PNG")
            .on('click', function(){
                var svgString = getSVGString(svg.node());
                svgString2Image(svgString, 2*width, 2*height, 'png', save); // passes Blob and filesize String to the callback
            
                function save(dataBlob){
                    saveAs(dataBlob, filename_for_saving); // FileSaver.js function
                }
            });
        
        /*
        methods.append("button").text("HTML")
            .on("click", function(){
                d3.selectAll(div_selector + " .node").classed("fix", function(d) {
                    d.fx = d.x;
                });
                var html = document.querySelector("html").outerHTML;
                var arg_div = document.getElementById(div_selector).innerHTML;
                console.log(arg_div);
                html = html.replace(arg_div, "");
                html = html.replace(source.match(/'nodes': .*'links'/), "'nodes': " + JSON.stringify(graph.nodes) + ", 'links'")
                saveAs(new Blob([html], {type:"text/plain;charset=utf-8"}), "tskit_arg_visualizer.html");
            })
        */

        var reheat = dashboard.append("button").attr("class", "dashbutton activecolor")
            .on("click", function(event) {
                if (!event.active) simulation.alphaTarget(0.3).restart();       
                var order = d3.selectAll(div_selector + " .sample").data().sort((a, b) => d3.ascending(a.x, b.x)).map(a => a.id);;
                d3.selectAll(div_selector + " .node").classed("unfix", function(d) {
                    if ((d.ts_flags & NODE_IS_SAMPLE) & (d.x_pos_reference == -1)) {
                        delete d.fx;
                    } else {
                        d.fx = evenly_distributed_positions[order.indexOf(d.id)];
                    }
                });
            });
        reheat.append("svg") //<!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
            .attr("xmlns", "http://www.w3.org/2000/svg")
            .attr("viewBox", "0 0 384 512")
            .append("path")
            .attr("d", "M153.6 29.9l16-21.3C173.6 3.2 180 0 186.7 0C198.4 0 208 9.6 208 21.3V43.5c0 13.1 5.4 25.7 14.9 34.7L307.6 159C356.4 205.6 384 270.2 384 337.7C384 434 306 512 209.7 512H192C86 512 0 426 0 320v-3.8c0-48.8 19.4-95.6 53.9-130.1l3.5-3.5c4.2-4.2 10-6.6 16-6.6C85.9 176 96 186.1 96 198.6V288c0 35.3 28.7 64 64 64s64-28.7 64-64v-3.9c0-18-7.2-35.3-19.9-48l-38.6-38.6c-24-24-37.5-56.7-37.5-90.7c0-27.7 9-54.8 25.6-76.9z");
        reheat.append("span").attr("class", "tip desc").text("Reheat Simulation");
        
        if (plot_type == "full") {
            var evenly_distribute = dashboard.append("button").attr("class", "dashbutton activecolor")
                .on("click", function() {
                    var order = d3.selectAll(div_selector + " .sample").data().sort((a, b) => d3.ascending(a.x, b.x)).map(a => a.id);;
                    d3.selectAll(div_selector + " .sample").classed("distribute", function(d) {
                        d.fx = evenly_distributed_positions[order.indexOf(d.id)];
                    });
                });
            evenly_distribute.append("svg") //<!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
                .attr("xmlns", "http://www.w3.org/2000/svg")
                .attr("viewBox", "0 0 512 512")
                .append("path")
                .attr("d", "M504.3 273.6c4.9-4.5 7.7-10.9 7.7-17.6s-2.8-13-7.7-17.6l-112-104c-7-6.5-17.2-8.2-25.9-4.4s-14.4 12.5-14.4 22l0 56-192 0 0-56c0-9.5-5.7-18.2-14.4-22s-18.9-2.1-25.9 4.4l-112 104C2.8 243 0 249.3 0 256s2.8 13 7.7 17.6l112 104c7 6.5 17.2 8.2 25.9 4.4s14.4-12.5 14.4-22l0-56 192 0 0 56c0 9.5 5.7 18.2 14.4 22s18.9 2.1 25.9-4.4l112-104z")
            evenly_distribute.append("span").attr("class", "tip desc").text("Space Samples");
        }

        var labelling = dashboard.append("button").attr("class", "dashbutton");
        labelling.append("svg") //<!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
            .attr("xmlns", "http://www.w3.org/2000/svg")
            .attr("viewBox", "0 0 512 512")
            .append("path")
            .attr("d", "M0 80L0 229.5c0 17 6.7 33.3 18.7 45.3l176 176c25 25 65.5 25 90.5 0L418.7 317.3c25-25 25-65.5 0-90.5l-176-176c-12-12-28.3-18.7-45.3-18.7L48 32C21.5 32 0 53.5 0 80zm112 32a32 32 0 1 1 0 64 32 32 0 1 1 0-64z");
        var labelling_methods = labelling.append("span").attr("class", "tip desc");
        var methods = labelling_methods.append("div").text("Node Labels:").append("div").attr("class", "labelmethods")
        
        function switch_node_label(selected) {
            label_text.each(function(d) {
                d3.select(this).selectAll("*").remove();
                if (selected == "default") {
                    multi_line_text.call(this, d.label, (d.parent_of.length == 0));
                } else if (selected == "id") {
                    multi_line_text.call(this, "#" + String(d.id));
                } else {
                    multi_line_text.call(this, "");
                }
            })
        }
        
        methods.append("button").attr("class", "node-labels-default").text("DEFAULT")
            .on("click", function() {
                switch_node_label("default");
                // Underline the current selection (could use different highlighting method here)
                d3.selectAll(div_selector + " .labelmethods button").style("text-decoration", "none");
                d3.select(this).style("text-decoration", "underline");
            });
        methods.append("button").attr("class", "node-labels-id").text("#ID")
            .on('click', function(){
                switch_node_label("id");
                // Underline the current selection (could use different highlighting method here)
                d3.selectAll(div_selector + " .labelmethods button").style("text-decoration", "none");
                d3.select(this).style("text-decoration", "underline");
            });
        methods.append("button").attr("class", "node-labels-none").text("NONE")
            .on('click', function(){
                switch_node_label("none");
                // Underline the current selection (could use different highlighting method here)
                d3.selectAll(div_selector + " .labelmethods button").style("text-decoration", "none");
                d3.select(this).style("text-decoration", "underline");
            });


        var svg = d3.select(div_selector).append("svg")
            .attr("width", width)
            .attr("height", height)
            .style("background-color", "white");

        var result = y_axis.ticks.map(function (x) { 
            return parseInt(x, 10); 
        });

        if (eval(y_axis.include_labels)) {
            var bottom = height - 50;
            if (tree_highlighting) {
                bottom = height - 125;
            }
            var top = 50;
            if (title != "None") {
                top = 100
            }
            var yscale = d3.scaleLinear() 
                .domain([y_axis.max_min[0], y_axis.max_min[1]]) 
                .range([y_axis.max_min[0], y_axis.max_min[1]]); 

            var y_axis_text = y_axis.text;

            var d3_y_axis = d3.axisRight().scale(yscale)
                .tickValues(result)
                .tickFormat((d, i) => y_axis_text[i]); 

            var y_axis_labels = svg
                .append("g")
                .attr("class", "yaxis")
                .attr("transform", "translate(25,0)")
                .call(d3_y_axis);
            
            if (y_axis.title != "None") {
                y_axis_labels.append("text")
                .attr("x", -15)
                .attr("y", (y_axis.max_min[0]+y_axis.max_min[1])/2)
                .attr("fill", "black")
                .attr("text-anchor", "middle")
                .attr("alignment-baseline", "middle")
                .attr("class", "label")
                .attr("transform", "rotate(-90, -15, " + (y_axis.max_min[0]+y_axis.max_min[1])/2 + ")")
                .text(y_axis.title);
            }
        }

        var simulation = d3
            .forceSimulation(graph.nodes)
            .force("link", d3.forceLink()
                .id(d => d.id)
                .links(graph.links)
            )
            //.force("center", d3.forceCenter(275,250).strength(-10))
            .force("charge", d3.forceManyBody().strength(-100))
            .on("tick", ticked);

        var link_container = svg
            .append("g")
            .attr("class", "links")
            .selectAll("path")
            .data(graph.links)
            .enter()
            .append("g")
            .attr("bounds", d => d.bounds);

        if ((edge_styles.type == "ortho") & eval(edge_styles.include_underlink)) {
            var underlink = link_container
                .append("path")
                .attr("class", "underlink");
        }

        var link = link_container
            .append("path")
            .attr("class", "link")
            .attr("stroke", d => d.stroke)
            .attr("stroke-width", "4px");
        
        if (eval(edge_styles.variable_width)) {
            link
                .style("stroke-width", d => d.region_fraction * 7 + 1);
        }

        if (tree_highlighting) {
            d3.selectAll(div_selector + " .link")
                .on('mouseover', function (event, d) {
                    if (!d3.select(div_selector + ">svg").classed("no-hover")) {
                        d3.select(this)
                            .style('stroke', '#1eebb1')
                            .style("cursor", "pointer");
                        d3.selectAll(div_selector + " .sites .e" + d.id).style("display", "block");
                        d3.selectAll(div_selector + " .endpoints")
                            .style('display', 'none'); /* hide other labels to avoid clashes */
                        const bars = d3.select(div_selector + " .breakpoints").selectAll(".included");
                        bars /* colour in all bars covered by these bounds */
                            .filter(function(j) {
                                return d.bounds.split(" ").some(function(region) {
                                    region = region.split("-");
                                    return (parseFloat(region[0]) <= j.start) & (parseFloat(region[1]) >= j.stop)
                                });
                            })
                            .selectAll("rect").style('fill', '#1eebb1');
                        bars /* show the leftmost position label */
                            .filter(function(j) {
                                return d.bounds.split(" ").some(function(region) {
                                    region = region.split("-");
                                    return (parseFloat(region[0]) == j.start)
                                });
                            })
                            .selectAll("text.start").style('display', 'block');
                        bars /* show the rightmost position label */
                            .filter(function(j) {
                                return d.bounds.split(" ").some(function(region) {
                                    region = region.split("-");
                                    return (parseFloat(region[1]) == j.stop)
                                });
                            })
                            .selectAll("text.stop").style('display', 'block');
                    }
                })
                .on('mouseout', function (event, d) {
                    if (!d3.select(div_selector + ">svg").classed("no-hover")) {
                        d3.select(this)
                            .style('stroke', d.stroke)
                            .style("cursor", "default");
                        const bars = d3.select(div_selector + " .breakpoints").selectAll(".included");
                        bars.selectAll("rect").style("fill", d.fill);
                        bars.selectAll("text").style("display", "none");
                        d3.selectAll(div_selector + " .endpoints")
                            .style('display', 'block');
                        d3.selectAll(div_selector + " .sites .e" + d.id).style("display", "none");
                    }
                });
        }

        var node_group = svg
            .append("g")
            .attr("class", "nodes")
            .selectAll("circle")
            .data(graph.nodes)
            .enter()
            .append("g");

        var missing_edges = node_group
            .filter(d => (d.not_included_parents>0) | (d.not_included_children>0))
            .append("g")
            .attr("class", "missing");

        var missing_parents = missing_edges
            .filter(d => d.not_included_parents>0)
            .append("g")
            .attr("class", "parents")
            .append("g");
        var missing_parents_paths = missing_parents.append("path");
        var missing_parents_texts = missing_parents
            .append("text")
                .attr("class", "label")
                .style("fill", "gray")
                .text(d => d.not_included_parents);

        var missing_children = missing_edges
            .filter(d => d.not_included_children>0)
            .append("g")
            .attr("class", "children")
            .append("g");
        var missing_children_paths = missing_children.append("path");
        var missing_children_texts = missing_children
            .append("text")
                .attr("class", "label")
                .style("fill", "gray")
                .text(d => d.not_included_children);

        function multi_line_text(text, top_align) {
            if (text != null) {
                // Split label text onto separate lines by newline characters, if they exist
                const lines = text.split("\n");
                const parentX = d3.select(this).attr("x") || "0";  // Get parent text's x position
                const initialDy = top_align ? "0em" : (-1 * (lines.length - 1)) + "em";

                d3.select(this).text(null); // clear existing text
                d3.select(this).selectAll('tspan')
                    .data(lines)
                    .enter()
                    .append('tspan')
                    .text(d => d)
                    .attr('x', parentX)  // Use parent's x position
                    .attr('dy', (d, i) => ((i === 0) ? initialDy : "1em"));
            }
        }
        var node = node_group
            .append("path")
            .attr("transform", d => "translate(" + d.x + "," + d.y + ")")
            .attr("d", d3.symbol().type(d => eval(d.symbol)).size(d => d.size))
            .attr("fill", d => d.fill)
            .attr("stroke", d => d.stroke)
            .attr("stroke-width", d => d.stroke_width)
            .attr("id", d => String(divnum) + "_node" + d.id)
            .attr("class", d => "node flag" + d.ts_flags + (d.ts_flags & NODE_IS_SAMPLE ? " sample" : ""))
            .attr("parents", d => d.child_of.toString().replace(",", " "))
            .attr("children", d => d.parent_of.toString().replace(",", " "))
            .call(
                d3
                    .drag()
                    .on("start", dragstarted)
                    .on("drag", dragged)
                    .on("end", dragended)
            )
            .on('mouseover', function (d, i) {
                d3.select(this)
                    .style("cursor", "pointer")
            });

        function highlight_mut(mutation_id, site_id, fill) {
            /* other mutations at the same site on the tree */
            d3.selectAll(div_selector + " .mutations .s" + site_id + " rect").style("stroke", fill);
            /* highlight only this mutation in the bar */
            d3.select(div_selector + " .sites .m" + mutation_id).style("display", "block");
        }

        function dehighlight_mut(mutation_id, site_id) {
            d3.selectAll(div_selector + " .mutations .s" + site_id + " rect")
                .each(function(d) {
                    d3.select(this)
                        .style("stroke", d.stroke)
                        .style("fill", d.fill);
                    });
            d3.select(div_selector + " .sites .m" + mutation_id).style("display", "none");
        }

        function highlight_mut(mutation_id, site_id, fill) {
            /* other mutations at the same site on the tree */
            d3.selectAll(div_selector + " .mutations .s" + site_id + " rect").style("stroke", fill);
            /* highlight only this mutation in the bar */
            d3.select(div_selector + " .sites .m" + mutation_id).style("display", "block");
        }

        function dehighlight_mut(mutation_id, site_id) {
            d3.selectAll(div_selector + " .mutations .s" + site_id + " rect")
                .each(function(d) {
                    d3.select(this)
                        .style("stroke", d.stroke)
                        .style("fill", d.fill);
                    });
            d3.select(div_selector + " .sites .m" + mutation_id).style("display", "none");
        }

        var mut_symbol = svg
            .append("g")
            .attr("class", "mutations")
            .selectAll("rect")
            .data(graph.mutations)
            .enter()
            .append("g")
            .attr("class", d => {
                if (condense_mutations) {
                    return (
                        d.site_id.map(id => "s" + id).join(" ") + " " +
                        d.mutation_id.map(id => "m" + id).join(" ")
                    )
                } else {
                    return "s" + d.site_id + " " + "m" + d.mutation_id;
                }}
            )
            .attr("class", d => {
                if (condense_mutations) {
                    return (
                        d.site_id.map(id => "s" + id).join(" ") + " " +
                        d.mutation_id.map(id => "m" + id).join(" ")
                    )
                } else {
                    return "s" + d.site_id + " " + "m" + d.mutation_id;
                }}
            )
            .on("mouseover", function(event, d) {
                if (!d3.select(div_selector + ">svg").classed("no-hover")) {
                    d3.select(this).style("cursor", "pointer");
                    /* highlight all mutations at the same site (easy to spot reversions etc) */
                    if (condense_mutations) {
                        d.mutation_id.forEach((id, i) => highlight_mut(id, d.site_id[i], d.fill));
                    } else {
                        highlight_mut(d.mutation_id, d.site_id, d.fill)
                    }
                    if (condense_mutations) {
                        d.mutation_id.forEach((id, i) => highlight_mut(id, d.site_id[i], d.fill));
                    } else {
                        highlight_mut(d.mutation_id, d.site_id, d.fill)
                    }
                    /* Show a tooltip with the mutation information */
                    var rect = d3.select(div_selector).node().getBoundingClientRect();
                    tip
                        .style("display", "block")
                        .html("<p style='margin: 0px;'>" + d.content + "</p>")
                        .style("border", d.fill + " solid 2px")
                        .style("left", (event.pageX - rect.x) + "px")
                        .style("top", (event.pageY - rect.y + 25) + "px")
                        .style("transform", "translateX(-50%)");
                }
            })
            .on("mouseout", function(event, d) {
                if (!d3.select(div_selector + ">svg").classed("no-hover")) {
                    if (!eval(d.active)) {
                        d3.select(this).style("cursor", "default");
                        if (condense_mutations) {
                            d.mutation_id.forEach((id, i) => dehighlight_mut(id, d.site_id[i]));
                        } else {
                            dehighlight_mut(d.mutation_id, d.site_id);
                        }
                    }
                    if (!eval(d.active)) {
                        d3.select(this).style("cursor", "default");
                        if (condense_mutations) {
                            d.mutation_id.forEach((id, i) => dehighlight_mut(id, d.site_id[i]));
                        } else {
                            dehighlight_mut(d.mutation_id, d.site_id);
                        } 
                        tip.style("display", "none");
                    }
                }
            });

        if (label_mutations) {
            var mut_symbol_label = mut_symbol
                .append("text")
                //.attr("class", "label")
                .style("font-size", d => (d.size * 2 + "px"))
                .attr("text-anchor", "middle")
                .attr("alignment-baseline", "middle")
                .attr("fill", d => {
                    var box = document.createElement("div");
                    box.style.color = d.fill;
                    document.body.appendChild(box);
                    var rgb = parseRgbString(window.getComputedStyle(box).color);
                    document.body.removeChild(box);
                    var lightness = 0.2126*rgb["r"] + 0.7152*rgb["g"] + 0.0722*rgb["b"];
                    if (lightness > 0.5) {
                        return "#053e4e"
                    }
                    return "white"
                })
                .text(d => d.label)
                .each(function(d) {
                    // Store the text width on the data object
                    d.textWidth = this.getComputedTextLength();
                });
        }

        var mut_symbol_rect = mut_symbol
            .append("rect")
            .attr("class", "symbol")
            .attr("fill", d => d.fill)
            .attr("stroke", d => d.stroke)
            .attr("stroke-width", 2)
            // Set the rect width / height based on the calculated text width
            .attr("width", function(d) {
                if (label_mutations && d.textWidth) {
                    d.computedWidth = d.textWidth + 6; // Add left/right padding
                } else {
                    d.computedWidth = d.size * 3; // aspect ratio is 3 (3 times wider than tall)
                }
                return d.computedWidth;  
            })
            .attr("height", function(d) {
                if (label_mutations) {
                    d.computedHeight = (d.size * 2) + 4; // Font size + top/bottom padding
                }
                else {
                    d.computedHeight = d.size;
                }
                return d.computedHeight;
            })
            .lower();

        function rotate_tip(d) {
            /* NB: why is there an "eval" here? */
            if ((d.parent_of.length == 0) & (eval(rotate_tip_labels))) {
                return "translate(-4, 0) rotate(90)"
            }
            return null
        }

        var label = svg
            .append("g")
            .attr("class", "node-labels")
            .selectAll("text")
            .data(graph.nodes)
            .enter()
            //.filter(d => eval(d.include_label))
            .append("g");

        var label_text = label
            .attr("class", d => "label n" + d.id)
            .append("text")
            .each(function(d) {
                multi_line_text.call(this, d.label, (d.parent_of.length == 0));
            })
            //.each(d => multi_line_text.call(this, d.label, (d.parent_of.length == 0)))
            .attr("transform", rotate_tip);

        function determine_path_type(d) {
            path_type = ""
            var start_position_x = d.source.x;
            var start_position_y = d.source.y;
            var stop_position_x = d.target.x;
            var stop_position_y = d.target.y;
            var vnub = Math.min((stop_position_y-start_position_y)/2, 20);
            if ("y_axis.scale" == "time" | "y_axis.scale" == "log_time") {
                vnub = 0;
            }
            var alt_child = document.getElementById(String(divnum) + "_node" + d.alt_child);
            if (alt_child != null) {
                var alt_child_x = alt_child.getAttribute("cx");
                var alt_child_y = alt_child.getAttribute("cy");
            }
            if (d.source.ts_flags & NODE_IS_RE_EVENT) {
                path_type += "r0";
                start_position_y = d.source.y + vnub;
            } else {
                if (d.target.y < alt_child_y) {
                    if (d.target.x < d.source.x) {
                        if (d.target.x < d.source.x - 40) {
                            path_type += "tL";
                        } else {
                            path_type += "fL";
                        }
                        start_position_x = d.source.x - 20;
                    } else {
                        if (d.target.x > d.source.x + 40) {
                            path_type += "tR";
                        } else {
                            path_type += "fR";
                        }
                        start_position_x = d.source.x + 20;
                    }
                } else if (d.target.y > alt_child_y) {
                    if (alt_child_x < d.source.x) {
                        if (d.target.x < d.source.x + 40) {
                            path_type += "fR";
                        } else {
                            path_type += "tR";
                        }
                        start_position_x = d.source.x + 20;
                    } else {
                        if (d.target.x > d.source.x - 40) {
                            path_type += "fL";
                        } else {
                            path_type += "tL";
                        }
                        start_position_x = d.source.x - 20;
                    }
                } else {
                    if (d.target.x < alt_child_x) {
                        if (d.target.x < d.source.x - 40) {
                            path_type += "tL";
                        } else {
                            path_type += "fL";
                        }
                        start_position_x = d.source.x - 20;
                    } else if (d.target.x > alt_child_x) {
                        if (d.target.x > d.source.x + 40) {
                            path_type += "tR";
                        } else {
                            path_type += "fR";
                        }
                        start_position_x = d.source.x + 20;
                    } else {
                        if (d.index % 2 == 0) {
                            path_type += "fL";
                            start_position_x = d.source.x - 20;
                        } else {
                            path_type += "fR";
                            start_position_x = d.source.x + 20;
                        }
                    }
                }
            }
            var alt_parent = document.getElementById(String(divnum) + "_node" + d.alt_parent);
            if (alt_parent != null) {
                var alt_parent_x = alt_parent.getAttribute("cx");
                var alt_parent_y = alt_parent.getAttribute("cy");
            }
            if (d.target.ts_flags & NODE_IS_RE_EVENT) {
                if (d.source.y < alt_parent_y) {
                    if (alt_parent_x < d.target.x) {
                        if (d.source.x < d.target.x + 40) {
                            path_type += "fR";
                        } else {
                            path_type += "tR";
                        }
                        stop_position_x = d.target.x + 20;
                    } else {
                        if (d.source.x > d.target.x - 40) {
                            path_type += "fL";
                        } else {
                            path_type += "tL";
                        }
                        stop_position_x = d.target.x - 20;
                    }
                } else if (d.source.y > alt_parent_y) {
                    if (d.source.x < d.target.x) {
                        if (d.source.x < d.target.x - 40) {
                            path_type += "tL";
                        } else {
                            path_type += "fL";
                        }
                        stop_position_x = d.target.x - 20;
                    } else {
                        if (d.source.x > d.target.x + 40) {
                            path_type += "tR";
                        } else {
                            path_type += "fR";
                        }
                        stop_position_x = d.target.x + 20;
                    }
                } else {
                    if (d.index % 2 == 0) {
                        path_type += "fL";
                        stop_position_x = d.target.x - 20;
                    } else {
                        path_type += "fR";
                        stop_position_x = d.target.x + 20;
                    }
                }
            } else {
                path_type += "b0";
                stop_position_y = d.target.y - vnub;
            }
            if (path_type == "fLb0" ) {
                if (start_position_x >= stop_position_x) {
                    path_type = "tLb0";
                }
            } else if (path_type == "fRb0") {
                if (start_position_x <= stop_position_x) {
                    path_type = "tRb0";
                }
            } else if (path_type == "r0fL") {
                if (start_position_x <= stop_position_x) {
                    path_type = "r0tL";
                }
            } else if (path_type == "r0fR") {
                if (start_position_x >= stop_position_x) {
                    path_type = "r0tR";
                }
            } else if (path_type == "fLfL") {
                if (start_position_x <= stop_position_x) {
                    path_type = "fLtL";
                } else {
                    path_type = "tLfL";
                }
            } else if (path_type == "fRfR") {
                if (start_position_x >= stop_position_x) {
                    path_type = "fRtR";
                } else {
                    path_type = "tRfR";
                }
            }
            return [path_type, start_position_x, start_position_y, stop_position_x, stop_position_y];
        }

        function ortho_pathing(d, path_info, underlink=false) {      
            const path_type = path_info[0];
            const simple_path_type = Array.from(path_type)[0] + Array.from(path_type)[2];
            const start_position_x = path_info[1];
            const start_position_y = path_info[2];
            const stop_position_x = path_info[3];
            const stop_position_y = path_info[4];

            const after_paths = ["rf", "tb", "tf"];
            const before_paths = ["rt", "fb", "ft"];
            const step_paths = ["tt"];
            const mid_paths = ["rb", "ff"];

            if (underlink) {
                if (after_paths.includes(simple_path_type)) {
                    return stepAfter([[start_position_x, start_position_y],[stop_position_x, stop_position_y]]);
                } else if (before_paths.includes(simple_path_type)) {
                    return stepBefore([[start_position_x, start_position_y],[stop_position_x, stop_position_y]]);
                } else if (step_paths.includes(simple_path_type)) {
                    return step([[start_position_x, start_position_y],[stop_position_x, stop_position_y]]);
                } else if (mid_paths.includes(simple_path_type)) {
                    return line([[start_position_x, start_position_y],[start_position_x, start_position_y + (stop_position_y - start_position_y)/2]]) + line([[start_position_x, start_position_y + (stop_position_y - start_position_y)/2],[stop_position_x, start_position_y + (stop_position_y - start_position_y)/2]]) + line([[stop_position_x, start_position_y + (stop_position_y - start_position_y)/2], [stop_position_x, stop_position_y]]);
                }
            } else {
                if (after_paths.includes(simple_path_type)) {
                    return line([[d.source.x, d.source.y],[start_position_x, start_position_y]]) + stepAfter([[start_position_x, start_position_y],[stop_position_x, stop_position_y]]) + line([[stop_position_x, stop_position_y], [d.target.x, d.target.y]]);
                } else if (before_paths.includes(simple_path_type)) {
                    return line([[d.source.x, d.source.y],[start_position_x, start_position_y]]) + stepBefore([[start_position_x, start_position_y],[stop_position_x, stop_position_y]]) + line([[stop_position_x, stop_position_y], [d.target.x, d.target.y]]);
                } else if (step_paths.includes(simple_path_type)) {
                    return line([[d.source.x, d.source.y],[start_position_x, start_position_y]]) + step([[start_position_x, start_position_y],[stop_position_x, stop_position_y]]) + line([[stop_position_x, stop_position_y], [d.target.x, d.target.y]]);
                } else if (mid_paths.includes(simple_path_type)) {
                    return line([[d.source.x, d.source.y],[start_position_x, start_position_y]]) + line([[start_position_x, start_position_y],[start_position_x, start_position_y + (stop_position_y - start_position_y)/2]]) + line([[start_position_x, start_position_y + (stop_position_y - start_position_y)/2],[stop_position_x, start_position_y + (stop_position_y - start_position_y)/2]]) + line([[stop_position_x, start_position_y + (stop_position_y - start_position_y)/2], [stop_position_x, stop_position_y]]) + line([[stop_position_x, stop_position_y], [d.target.x, d.target.y]]);
                }
            }
        }

        function ticked() {
            node
                .attr("transform", function(d) {
                    if (eval(y_axis.include_labels)) {
                        return "translate(" + Math.max(150, Math.min(width-50, d.x)) + "," + d.y + ")";
                    } else {
                        return "translate(" + Math.max(50, Math.min(width-50, d.x)) + "," + d.y + ")";
                    }
                })
                .attr("cx", function(d) {
                    if ((edge_styles.type == "ortho") & (d.x_pos_reference != -1)) {
                        var ref = document.getElementById(String(divnum) + "_node" + d.x_pos_reference);
                        if (ref != null) {
                            d.fx = ref.getAttribute("cx");
                        }
                    }
                    if (eval(y_axis.include_labels)) {
                        return d.x = Math.max(150, Math.min(width-50, d.x));
                    } else {
                        return d.x = Math.max(50, Math.min(width-50, d.x));
                    }
                })
                .attr("cy", d => d.y);
            
            link_container.each(function(d) {
                var path_info = determine_path_type(d);
                var path = "";
                if (edge_styles.type == "ortho") {
                    path = ortho_pathing(d, path_info);
                    underlink_path = ortho_pathing(d, path_info, underlink=true);
                } else if (d.source.id == d.alt_parent) {
                    var leftOrRight = 20;
                    if (d.index % 2 == 0) {
                        leftOrRight = -20;
                    }
                    path = "M " + d.source.x + " " + d.source.y + " C " + (d.source.x + leftOrRight).toString() + " " +  (d.source.y - 10).toString() + ", " + (d.target.x + leftOrRight).toString() + " " + (d.target.y + 10).toString() + ", " + d.target.x + " " + d.target.y;
                } else {
                    path = line([[d.source.x, d.source.y], [d.target.x, d.target.y]]);
                }
                if ((edge_styles.type == "ortho") & eval(edge_styles.include_underlink)) {
                    var u = d3.select(this).select(".underlink");
                    u.attr("d", underlink_path);
                }
                var l = d3.select(this).select(".link");
                l.attr("path_type", path_info[0]);
                l.attr("d", path)
                l.attr("fill", "none");
            });

            mut_symbol_rect
                .attr("x", function(d) {
                    var parent = document.getElementById(String(divnum) + "_node" + d.source);
                    if (parent != null) {
                        var parent_x = parseFloat(parent.getAttribute("cx"));
                        var parent_y = parseFloat(parent.getAttribute("cy"));
                        var child = document.getElementById(String(divnum) + "_node" + d.target);
                        if (child != null) {
                            var child_x = parseFloat(child.getAttribute("cx"));
                            var child_y = parseFloat(child.getAttribute("cy"));
                            if (parent_x - child_x == 0) {
                                return parent_x - d.computedWidth/2;
                            } else {
                                var slope = (parent_y - child_y) / (parent_x - child_x);
                                var intercept = parent_y - slope * parent_x;
                                return ((d.y - intercept) / slope) - d.computedWidth/2;
                            }
                        } else {
                            return 0;
                        }
                    } else {
                        return 0;
                    }
                })
                .attr("y", d => d.y - d.computedHeight/2);

            mut_symbol
                .attr("transform", function(d) {
                    var parent = document.getElementById(String(divnum) + "_node" + d.source);
                    if (parent != null) {
                        var parent_x = parseFloat(parent.getAttribute("cx"));
                        var parent_y = parseFloat(parent.getAttribute("cy"));
                        var child = document.getElementById(String(divnum) + "_node" + d.target);
                        if (child != null) {
                            var child_x = parseFloat(child.getAttribute("cx"));
                            var child_y = parseFloat(child.getAttribute("cy"));
                            var slope = (parent_y - child_y) / (parent_x - child_x);
                            var intercept = parent_y - slope * parent_x;
                            var rect = this.children[0];
                            return "rotate(" + String(-Math.atan((child_x-parent_x)/(child_y-parent_y))*180/Math.PI) + ", " + String(parseFloat(rect.getAttribute("x"))+parseFloat(rect.getAttribute("width"))/2) + ", " + String(parseFloat(rect.getAttribute("y"))+parseFloat(rect.getAttribute("height"))/2) + ")";
                        } else {
                            return "rotate(0)";
                        }
                    } else {
                        return "rotate(0)";
                    }
                });
            
            if (label_mutations) {
                mut_symbol_label
                    .attr("transform", function(d) {
                        var y = d.y + 1;
                        var x = 0;
                        var parent = document.getElementById(String(divnum) + "_node" + d.source);
                        if (parent != null) {
                            var parent_x = parseFloat(parent.getAttribute("cx"));
                            var parent_y = parseFloat(parent.getAttribute("cy"));
                            var child = document.getElementById(String(divnum) + "_node" + d.target);
                            if (child != null) {
                                var child_x = parseFloat(child.getAttribute("cx"));
                                var child_y = parseFloat(child.getAttribute("cy"));
                                if (parent_x - child_x == 0) {
                                    x = parent_x;
                                } else {
                                    var slope = (parent_y - child_y) / (parent_x - child_x);
                                    var intercept = parent_y - slope * parent_x;
                                    x = ((d.y - intercept) / slope);
                                }
                            } else {
                                x = 0;
                            }
                        } else {
                            x = 0;
                        }
                        return "translate(" + String(x) + "," + String(y) + ")";
                    });
            }

            function determine_label_positioning(d) {
                if (d.ts_flags & NODE_IS_RE_EVENT || d.parent_of.length == 0 || d.child_of.length == 0) {
                    return "c";
                } else if (d.child_of.length == 1) {
                    var parent = document.getElementById(String(divnum) + "_node" + d.child_of[0])
                    if (parent != null) {
                        var parent_x = parent.getAttribute("cx");
                        if (parent_x > d.x+1) {
                            return "l";
                        } else {
                            return "r";
                        }
                    } else {
                        return "r";
                    }
                } else {
                    return "r";
                }
            };

            label
                .each(function(d) {
                    var l = d3.select(this);
                    var positioning = determine_label_positioning(d);
                    var x = d.x;
                    var anchor = "middle";
                    // Find offsets from CSS
                    const cstyle = getComputedStyle(this)
                    const symbolSize = Math.sqrt(d.size);
                    const cssOffset = cstyle.getPropertyValue('--offset');
                    // default should depend on the symbol size (which is square pixels) and the font size
                    const offset = cssOffset ? parseInt(cssOffset) : symbolSize/2 + parseFloat(cstyle.fontSize)/2;
                    const cssTipoffset = cstyle.getPropertyValue('--tipoffset');
                    // default of 25 if not set: perhaps should be related to the tip symbol size?
                    const tipoffset = cssTipoffset ? parseInt(cssTipoffset) : symbolSize/2 + parseFloat(cstyle.fontSize);
                    if (positioning == "l") {
                        x = d.x - offset;
                        anchor = "end";
                    } else if (positioning == "r") {
                        x = d.x + offset;
                        anchor = "start";
                    }
                    l.attr("text-anchor", anchor);
                    l.attr("transform", function(d) {
                        // adding slightly more spacing in the y-axis when positioning is middle (c)
                        var y = d.y - offset;
                        if (positioning == "c") {
                            y = y - 3;
                        }
                        if (d.parent_of.length == 0) {
                            y = d.y + tipoffset;
                            if (positioning == "c") {
                                y = y + 3;
                            }
                        }
                        // only bother showing up to 4 d.p.
                        return "translate(" + parseFloat(x.toFixed(4)) + "," + parseFloat(y.toFixed(4)) + ")";
                    })
                });

            missing_parents_paths
                .each(function(d) {
                    var l = d3.select(this);
                    l.style("stroke-width", "4px");
                    l.style("stroke-dasharray", "5");
                    l.style("stroke", "gray");
                    l.attr("d", line([[d.x, d.y], [d.x, d.y-30]]));
                });
            
            missing_parents_texts
                .each(function(d) {
                    var l = d3.select(this);
                    l.attr("text-anchor", "middle");
                    l.attr("x", d.x);
                    l.attr("y", d.y-30);
                });

            missing_children_paths
                .each(function(d) {
                    var l = d3.select(this);
                    l.style("stroke-width", "4px");
                    l.style("stroke-dasharray", "5");
                    l.style("stroke", "gray");
                    l.attr("d", line([[d.x, d.y], [d.x, d.y+30]]));
                });
            
            missing_children_texts
                .each(function(d) {
                    var l = d3.select(this);
                    l.attr("text-anchor", "middle");
                    l.attr("x", d.x);
                    l.attr("y", d.y+40);
                });
        }

        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d3.selectAll(div_selector + " .node").classed("ref", function(j) {
                if ((edge_styles.type == "ortho") & (j.id == d.x_pos_reference)) {
                    j.fx = d.x;
                }
            });
            svg.attr("class", "no-hover");
        }

        function dragged(event, d) {
            d.fx = event.x;
            d3.selectAll(div_selector + " .node").classed("ref", function(j) {
                if ((edge_styles.type == "ortho") & (j.id == d.x_pos_reference)) {
                    j.fx = event.x;
                }
            });
        }

        function dragended(event, d) {
            svg.attr("class", null);
        }

        if (tree_highlighting) {
            
            var th_group = svg.append("g").attr("class", "tree_highlighting");
            
            var breakpoint_regions = th_group
                .append("g")
                .attr("class", "breakpoints")
                .selectAll("g")
                .data(graph.breakpoints)
                .enter()
                .append("g")
                .attr("class", d => eval(d.included) ? "included" : null)
                .attr("start", d => d.start)
                .attr("stop", d => d.stop);

            breakpoint_regions
                .append("rect")
                .attr("x", d => d.x_pos)
                .attr("y", height-60)
                .attr("width", d => d.width)
                .attr("height", 40)
                .attr("stroke", "#FFFFFF")
                .attr("stroke-width", 1)
                .attr("fill", d => eval(d.included) ? d.fill : "gray");

            breakpoint_regions
                .append("text")
                .attr("x", d => d.x_pos)
                .attr("y", height-5)
                .attr("class", "label start")
                .style("display", "none")
                .text(d => String(d.start));

            breakpoint_regions
                .append("text")
                .attr("x", d => d.x_pos + d.width)
                .attr("y", height-5)
                .attr("class", "label stop")
                .style("display", "none")
                .text(d => String(d.stop));

            breakpoint_regions
                .on('mouseover', function (event, d) {
                    if (!d3.select(div_selector + ">svg").classed("no-hover")) {
                        if (eval(d.included)) {
                            d3.select(this).selectAll("rect")
                                .style('fill', '#1eebb1')
                                .style("cursor", "pointer");
                            d3.select(this).selectAll("text")
                                .style('display', 'block');
                            d3.selectAll(div_selector + " .endpoints")
                                .style('display', 'none'); /* hide other labels to avoid clashes */
                            var highlight_links = d3.select(div_selector + " .links")
                                .selectAll("g")
                                    .filter(function(j) {
                                        return j.bounds.split(" ").some(function(region) {
                                            region = region.split("-");
                                            return (parseFloat(region[1]) > d.start) & (parseFloat(region[0]) < d.stop)
                                        });
                                    });
                            highlight_links.raise();
                            highlight_links
                                .select(".link")
                                .style("stroke", "#1eebb1");
                        }
                    }
                })
                .on('mouseout', function (event, d) {
                    if (!d3.select(div_selector + ">svg").classed("no-hover")) {
                        if (eval(d.included)) {
                            d3.select(this).selectAll("rect")
                                .style('fill', d.fill)
                                .style("cursor", "default");
                            d3.select(this).selectAll("text")
                                .style('display', 'none');
                            d3.selectAll(div_selector + " .endpoints")
                                .style('display', 'block');
                            d3.selectAll(div_selector + " .link")
                                .style("stroke", d => d.stroke);
                        }
                    }
                });
            
            var endpoints = th_group.append("g").attr("class", "endpoints");
            
            endpoints
                .append("text")
                    .attr("class", "label")
                    .style("text-anchor", "start")
                    .text(graph.breakpoints[0].start)
                    .attr("x", graph.breakpoints[0].x_pos)
                    .attr("y", height-5);
            
            endpoints
                .append("text")
                    .attr("class", "label")
                    .style("text-anchor", "end")
                    .text(graph.breakpoints[graph.breakpoints.length-1].stop)
                    .attr("x", width)
                    .attr("y", height-5);

            var mutation_data = graph.mutations;
            if (condense_mutations) { /* explode the graph.mutations df into one row per mut */
                mutation_data = [];
                graph.mutations.forEach(function(d) {
                    d.mutation_id.forEach(function(x, i) {
                        mutation_data.push({
                            mutation_id: x,
                            site_id: d.site_id[i],
                            edge: d.edge,
                            fill: d.fill,
                            x_pos: d.x_pos[i], 
                            position: d.position[i]
                        });
                    });
                });
            };

            var mutation_data = graph.mutations;
            if (condense_mutations) { /* explode the graph.mutations df into one row per mut */
                mutation_data = [];
                graph.mutations.forEach(function(d) {
                    d.mutation_id.forEach(function(x, i) {
                        mutation_data.push({
                            mutation_id: x,
                            site_id: d.site_id[i],
                            edge: d.edge,
                            fill: d.fill,
                            x_pos: d.x_pos[i], 
                            position: d.position[i]
                        });
                    });
                });
            };

            var site_pos = th_group
                .append("g")
                .attr("class", "sites")
                .selectAll("line")
                .data(mutation_data)  /* NB: one per mutation to allow different line colors */
                .data(mutation_data)  /* NB: one per mutation to allow different line colors */
                .enter()
                .append("g")
                .attr("class", d => "s" + d.site_id + " " + "e" + d.edge + " " + "m" + d.mutation_id)
                .attr("class", d => "s" + d.site_id + " " + "e" + d.edge + " " + "m" + d.mutation_id)
                .attr("transform", d => "translate(" + d.x_pos + "," + (height-60) + ")")
                .style("display", "none");

            function createSiteLine(selection) {
                return selection
                    .append("line")
                    .attr("y1", -5)
                    .attr("y2", 40+5)
                    .style("stroke-width", 3)
                    .style("fill", "none");
            }
                  
            function createSiteText(selection) {
                return selection
                    .append("text")
                    .attr("y", -8)  /* above the tick */
                    .attr("class", "label");
            }
            
            site_pos
                .each(function(d) {
                    const select = d3.select(this);
                    createSiteLine(select)
                        .style("stroke", d.fill);
                    createSiteText(select)
                        .text(String(d.position));
                });
            
            /*
            var mut_text = mut_pos
                .append("text")
                .attr("text-anchor", function(d) {
                    if (d.x_pos > (width*9/10)) {
                        return "end";
                    } else if (d.x_pos < width*1/10) {
                        return "start";
                    } else {
                        return "middle";
                    }
                })
                .style("font-size", "10px")
                .style("font-family", "Arial")
                .attr("fill", d => d.fill)
                .attr("transform", d => "translate(" + String(d.x_pos) + "," + String(height-60-10) + ")");
        
            mut_text
                .text(function(d) {
                    if (label_mutations) {
                        return String(d.site_id) + ":" + String(d.position);
                    } else {
                        return d.label;
                    }
                });
            */
        }

        if (title != "None") {
            svg.append("text")
                .style("font-size", "20px")
                .attr("x", width / 2)
                .attr("text-anchor", "middle")
                .attr("y", 30)
                .each(function() { 
                    multi_line_text.call(this, title, true); 
                });
        }
    }

    draw_force_diagram()
}

/* NB: the code below fires up the visualizer: templates in this call
    can be used to pass in the appropriate data
*/

ensureRequire()
    .then(require => {
        require.config({ paths: {d3: 'https://d3js.org/d3.v7.min'}});
        require(["d3"], function(d3) {
            main_visualizer(d3, 8823157229, {"nodes": [{"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 0, "ts_flags": 1, "time": 0.0, "child_of": [10], "parent_of": [], "x_pos_reference": -1, "label": "0", "fx": 207.0, "fy": 450.0, "y": 450.0}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 1, "ts_flags": 1, "time": 0.0, "child_of": [8], "parent_of": [], "x_pos_reference": -1, "label": "1", "fx": 264.0, "fy": 450.0, "y": 450.0}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 2, "ts_flags": 1, "time": 0.0, "child_of": [8], "parent_of": [], "x_pos_reference": -1, "label": "2", "fx": 321.0, "fy": 450.0, "y": 450.0}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 3, "ts_flags": 1, "time": 0.0, "child_of": [17], "parent_of": [], "x_pos_reference": -1, "label": "3", "fx": 150.0, "fy": 450.0, "y": 450.0}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 4, "ts_flags": 1, "time": 0.0, "child_of": [9], "parent_of": [], "x_pos_reference": -1, "label": "4", "fx": 493.0, "fy": 450.0, "y": 450.0}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 5, "ts_flags": 1, "time": 0.0, "child_of": [9], "parent_of": [], "x_pos_reference": -1, "label": "5", "fx": 550.0, "fy": 450.0, "y": 450.0}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 6, "ts_flags": 1, "time": 0.0, "child_of": [11], "parent_of": [], "x_pos_reference": -1, "label": "6", "fx": 379.0, "fy": 450.0, "y": 450.0}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 7, "ts_flags": 1, "time": 0.0, "child_of": [11], "parent_of": [], "x_pos_reference": -1, "label": "7", "fx": 436.0, "fy": 450.0, "y": 450.0}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 8, "ts_flags": 0, "time": 0.00523931699745691, "child_of": [10], "parent_of": [1, 2], "x_pos_reference": -1, "label": "8", "x": 350.0, "fy": 428.94736842105266, "y": 428.94736842105266}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 9, "ts_flags": 0, "time": 0.017557818091816682, "child_of": [21], "parent_of": [4, 5], "x_pos_reference": -1, "label": "9", "x": 350.0, "fy": 407.89473684210526, "y": 407.89473684210526}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 10, "ts_flags": 0, "time": 0.09416924140000202, "child_of": [12], "parent_of": [0, 8], "x_pos_reference": -1, "label": "10", "x": 350.0, "fy": 386.84210526315786, "y": 386.84210526315786}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 11, "ts_flags": 0, "time": 0.1024650871470267, "child_of": [14], "parent_of": [6, 7], "x_pos_reference": -1, "label": "11", "x": 350.0, "fy": 365.7894736842105, "y": 365.7894736842105}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 12, "ts_flags": 131072, "time": 0.11568803951902568, "child_of": [14, 17], "parent_of": [10], "x_pos_reference": 10, "label": "12/13", "x": 350.0, "fy": 344.7368421052632, "y": 344.7368421052632}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 14, "ts_flags": 0, "time": 0.12175435946697583, "child_of": [15], "parent_of": [11, 12], "x_pos_reference": -1, "label": "14", "x": 350.0, "fy": 323.6842105263158, "y": 323.6842105263158}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 15, "ts_flags": 131072, "time": 0.308460674409082, "child_of": [18, 20], "parent_of": [14], "x_pos_reference": 14, "label": "15/16", "x": 350.0, "fy": 302.63157894736844, "y": 302.63157894736844}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 17, "ts_flags": 0, "time": 0.39582244241347575, "child_of": [23], "parent_of": [3, 12], "x_pos_reference": -1, "label": "17", "x": 350.0, "fy": 281.57894736842104, "y": 281.57894736842104}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 18, "ts_flags": 131072, "time": 0.6941217594839495, "child_of": [20, 24], "parent_of": [15], "x_pos_reference": -1, "label": "18/19", "x": 350.0, "fy": 260.52631578947376, "y": 260.52631578947376}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 20, "ts_flags": 262144, "time": 0.8577976766058426, "child_of": [23], "parent_of": [15, 18], "x_pos_reference": -1, "label": "20", "x": 350.0, "fy": 239.47368421052633, "y": 239.47368421052633}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 21, "ts_flags": 131072, "time": 1.0255837873540103, "child_of": [27, 28], "parent_of": [9], "x_pos_reference": 9, "label": "21/22", "x": 350.0, "fy": 218.42105263157893, "y": 218.42105263157893}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 23, "ts_flags": 0, "time": 1.0987444051668527, "child_of": [24], "parent_of": [17, 20], "x_pos_reference": -1, "label": "23", "x": 350.0, "fy": 197.3684210526316, "y": 197.3684210526316}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 24, "ts_flags": 0, "time": 1.2059022164118993, "child_of": [25], "parent_of": [18, 23], "x_pos_reference": -1, "label": "24", "x": 350.0, "fy": 176.31578947368425, "y": 176.31578947368425}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 25, "ts_flags": 131072, "time": 1.5998364961174132, "child_of": [27, 31], "parent_of": [24], "x_pos_reference": 24, "label": "25/26", "x": 350.0, "fy": 155.26315789473688, "y": 155.26315789473688}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 27, "ts_flags": 0, "time": 1.721772254949798, "child_of": [28], "parent_of": [21, 25], "x_pos_reference": -1, "label": "27", "x": 350.0, "fy": 134.21052631578948, "y": 134.21052631578948}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 28, "ts_flags": 0, "time": 2.0490896096414075, "child_of": [29], "parent_of": [21, 27], "x_pos_reference": -1, "label": "28", "x": 350.0, "fy": 113.15789473684212, "y": 113.15789473684212}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 29, "ts_flags": 131072, "time": 2.087239695481809, "child_of": [31, 32], "parent_of": [28], "x_pos_reference": 28, "label": "29/30", "x": 350.0, "fy": 92.10526315789478, "y": 92.10526315789478}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 31, "ts_flags": 0, "time": 2.349570553333265, "child_of": [32], "parent_of": [25, 29], "x_pos_reference": -1, "label": "31", "x": 350.0, "fy": 71.0526315789474, "y": 71.0526315789474}, {"size": 150, "symbol": "d3.symbolCircle", "fill": "#1eebb1", "stroke": "#053e4e", "stroke_width": 4, "id": 32, "ts_flags": 0, "time": 3.367861146397306, "child_of": [], "parent_of": [29, 31], "x_pos_reference": -1, "label": "32", "x": 350.0, "fy": 50.0, "y": 50.0}], "links": [{"id": 0, "source": 8, "source_time": 0.00523931699745691, "target": 1, "target_time": 0.0, "bounds": "0.0-1000.0", "alt_parent": -1, "alt_child": 2, "region_fraction": 1.0, "stroke": "#053e4e"}, {"id": 1, "source": 8, "source_time": 0.00523931699745691, "target": 2, "target_time": 0.0, "bounds": "0.0-1000.0", "alt_parent": -1, "alt_child": 1, "region_fraction": 1.0, "stroke": "#053e4e"}, {"id": 2, "source": 9, "source_time": 0.017557818091816682, "target": 4, "target_time": 0.0, "bounds": "0.0-1000.0", "alt_parent": -1, "alt_child": 5, "region_fraction": 1.0, "stroke": "#053e4e"}, {"id": 3, "source": 9, "source_time": 0.017557818091816682, "target": 5, "target_time": 0.0, "bounds": "0.0-1000.0", "alt_parent": -1, "alt_child": 4, "region_fraction": 1.0, "stroke": "#053e4e"}, {"id": 4, "source": 10, "source_time": 0.09416924140000202, "target": 0, "target_time": 0.0, "bounds": "0.0-1000.0", "alt_parent": -1, "alt_child": 8, "region_fraction": 1.0, "stroke": "#053e4e"}, {"id": 5, "source": 10, "source_time": 0.09416924140000202, "target": 8, "target_time": 0.00523931699745691, "bounds": "0.0-1000.0", "alt_parent": -1, "alt_child": 0, "region_fraction": 1.0, "stroke": "#053e4e"}, {"id": 6, "source": 11, "source_time": 0.1024650871470267, "target": 6, "target_time": 0.0, "bounds": "0.0-1000.0", "alt_parent": -1, "alt_child": 7, "region_fraction": 1.0, "stroke": "#053e4e"}, {"id": 7, "source": 11, "source_time": 0.1024650871470267, "target": 7, "target_time": 0.0, "bounds": "0.0-1000.0", "alt_parent": -1, "alt_child": 6, "region_fraction": 1.0, "stroke": "#053e4e"}, {"id": 8, "source": 12, "source_time": 0.11568803951902568, "target": 10, "target_time": 0.09416924140000202, "bounds": "0.0-763.0 763.0-1000.0", "alt_parent": -1, "alt_child": -1, "region_fraction": 1.0, "stroke": "#053e4e"}, {"id": 9, "source": 14, "source_time": 0.12175435946697583, "target": 11, "target_time": 0.1024650871470267, "bounds": "0.0-1000.0", "alt_parent": -1, "alt_child": 12, "region_fraction": 1.0, "stroke": "#053e4e"}, {"id": 10, "source": 14, "source_time": 0.12175435946697583, "target": 12, "target_time": 0.11568803951902568, "bounds": "0.0-763.0", "alt_parent": 17, "alt_child": 11, "region_fraction": 0.763, "stroke": "#053e4e"}, {"id": 11, "source": 15, "source_time": 0.308460674409082, "target": 14, "target_time": 0.12175435946697583, "bounds": "0.0-461.0 461.0-1000.0", "alt_parent": -1, "alt_child": -1, "region_fraction": 1.0, "stroke": "#053e4e"}, {"id": 12, "source": 17, "source_time": 0.39582244241347575, "target": 3, "target_time": 0.0, "bounds": "0.0-1000.0", "alt_parent": -1, "alt_child": 12, "region_fraction": 1.0, "stroke": "#053e4e"}, {"id": 13, "source": 17, "source_time": 0.39582244241347575, "target": 12, "target_time": 0.11568803951902568, "bounds": "763.0-1000.0", "alt_parent": 14, "alt_child": 3, "region_fraction": 0.237, "stroke": "#053e4e"}, {"id": 14, "source": 18, "source_time": 0.6941217594839495, "target": 15, "target_time": 0.308460674409082, "bounds": "461.0-533.0 533.0-1000.0", "alt_parent": 20, "alt_child": -1, "region_fraction": 0.539, "stroke": "#053e4e"}, {"id": 15, "source": 20, "source_time": 0.8577976766058426, "target": 15, "target_time": 0.308460674409082, "bounds": "0.0-461.0", "alt_parent": 18, "alt_child": 18, "region_fraction": 0.461, "stroke": "#053e4e"}, {"id": 16, "source": 20, "source_time": 0.8577976766058426, "target": 18, "target_time": 0.6941217594839495, "bounds": "533.0-1000.0", "alt_parent": 24, "alt_child": 15, "region_fraction": 0.467, "stroke": "#053e4e"}, {"id": 17, "source": 21, "source_time": 1.0255837873540103, "target": 9, "target_time": 0.017557818091816682, "bounds": "0.0-166.0 166.0-1000.0", "alt_parent": -1, "alt_child": -1, "region_fraction": 1.0, "stroke": "#053e4e"}, {"id": 18, "source": 23, "source_time": 1.0987444051668527, "target": 17, "target_time": 0.39582244241347575, "bounds": "0.0-1000.0", "alt_parent": -1, "alt_child": 20, "region_fraction": 1.0, "stroke": "#053e4e"}, {"id": 19, "source": 23, "source_time": 1.0987444051668527, "target": 20, "target_time": 0.8577976766058426, "bounds": "0.0-461.0 533.0-1000.0", "alt_parent": -1, "alt_child": 17, "region_fraction": 0.928, "stroke": "#053e4e"}, {"id": 20, "source": 24, "source_time": 1.2059022164118993, "target": 18, "target_time": 0.6941217594839495, "bounds": "461.0-533.0", "alt_parent": 20, "alt_child": 23, "region_fraction": 0.072, "stroke": "#053e4e"}, {"id": 21, "source": 24, "source_time": 1.2059022164118993, "target": 23, "target_time": 1.0987444051668527, "bounds": "0.0-1000.0", "alt_parent": -1, "alt_child": 18, "region_fraction": 1.0, "stroke": "#053e4e"}, {"id": 22, "source": 25, "source_time": 1.5998364961174132, "target": 24, "target_time": 1.2059022164118993, "bounds": "0.0-726.0 726.0-1000.0", "alt_parent": -1, "alt_child": -1, "region_fraction": 1.0, "stroke": "#053e4e"}, {"id": 23, "source": 27, "source_time": 1.721772254949798, "target": 21, "target_time": 1.0255837873540103, "bounds": "166.0-1000.0", "alt_parent": 28, "alt_child": 25, "region_fraction": 0.834, "stroke": "#053e4e"}, {"id": 24, "source": 27, "source_time": 1.721772254949798, "target": 25, "target_time": 1.5998364961174132, "bounds": "0.0-726.0", "alt_parent": 31, "alt_child": 21, "region_fraction": 0.726, "stroke": "#053e4e"}, {"id": 25, "source": 28, "source_time": 2.0490896096414075, "target": 21, "target_time": 1.0255837873540103, "bounds": "0.0-166.0", "alt_parent": 27, "alt_child": 27, "region_fraction": 0.166, "stroke": "#053e4e"}, {"id": 26, "source": 28, "source_time": 2.0490896096414075, "target": 27, "target_time": 1.721772254949798, "bounds": "0.0-166.0 726.0-1000.0", "alt_parent": -1, "alt_child": 21, "region_fraction": 0.44, "stroke": "#053e4e"}, {"id": 27, "source": 29, "source_time": 2.087239695481809, "target": 28, "target_time": 2.0490896096414075, "bounds": "726.0-804.0 804.0-1000.0", "alt_parent": -1, "alt_child": -1, "region_fraction": 0.274, "stroke": "#053e4e"}, {"id": 28, "source": 31, "source_time": 2.349570553333265, "target": 25, "target_time": 1.5998364961174132, "bounds": "726.0-1000.0", "alt_parent": 27, "alt_child": 29, "region_fraction": 0.274, "stroke": "#053e4e"}, {"id": 29, "source": 31, "source_time": 2.349570553333265, "target": 29, "target_time": 2.087239695481809, "bounds": "804.0-1000.0", "alt_parent": 32, "alt_child": 25, "region_fraction": 0.196, "stroke": "#053e4e"}, {"id": 30, "source": 32, "source_time": 3.367861146397306, "target": 29, "target_time": 2.087239695481809, "bounds": "726.0-804.0", "alt_parent": 31, "alt_child": 31, "region_fraction": 0.078, "stroke": "#053e4e"}, {"id": 31, "source": 32, "source_time": 3.367861146397306, "target": 31, "target_time": 2.349570553333265, "bounds": "726.0-804.0", "alt_parent": -1, "alt_child": 29, "region_fraction": 0.078, "stroke": "#053e4e"}], "mutations": [], "breakpoints": [{"id": 0, "start": 0.0, "stop": 166.0, "x_pos_01": 0.0, "width_01": 0.166, "fill": "#053e4e", "x_pos": 100.0, "width": 83.0, "included": "true"}, {"id": 1, "start": 166.0, "stop": 461.0, "x_pos_01": 0.166, "width_01": 0.295, "fill": "#053e4e", "x_pos": 183.0, "width": 147.5, "included": "true"}, {"id": 2, "start": 461.0, "stop": 533.0, "x_pos_01": 0.461, "width_01": 0.072, "fill": "#053e4e", "x_pos": 330.5, "width": 36.0, "included": "true"}, {"id": 3, "start": 533.0, "stop": 726.0, "x_pos_01": 0.533, "width_01": 0.193, "fill": "#053e4e", "x_pos": 366.5, "width": 96.5, "included": "true"}, {"id": 4, "start": 726.0, "stop": 763.0, "x_pos_01": 0.726, "width_01": 0.037, "fill": "#053e4e", "x_pos": 463.0, "width": 18.5, "included": "true"}, {"id": 5, "start": 763.0, "stop": 804.0, "x_pos_01": 0.763, "width_01": 0.041, "fill": "#053e4e", "x_pos": 481.5, "width": 20.5, "included": "true"}, {"id": 6, "start": 804.0, "stop": 1000.0, "x_pos_01": 0.804, "width_01": 0.196, "fill": "#053e4e", "x_pos": 502.0, "width": 98.0, "included": "true"}], "evenly_distributed_positions": [150.0, 207.0, 264.0, 321.0, 379.0, 436.0, 493.0, 550.0]}, 600, 575, {"title": "Time ago (generations)", "units": "generations", "include_labels": "true", "ticks": [450.0, 428.94736842105266, 407.89473684210526, 386.84210526315786, 365.7894736842105, 344.7368421052632, 323.6842105263158, 302.63157894736844, 281.57894736842104, 260.52631578947376, 239.47368421052633, 218.42105263157893, 197.3684210526316, 176.31578947368425, 155.26315789473688, 134.21052631578948, 113.15789473684212, 92.10526315789478, 71.0526315789474, 50.0], "text": [0.0, 0.005, 0.018, 0.094, 0.102, 0.116, 0.122, 0.308, 0.396, 0.694, 0.858, 1.026, 1.099, 1.206, 1.6, 1.722, 2.049, 2.087, 2.35, 3.368], "max_min": [450.0, 50.0], "scale": "rank"}, {"type": "ortho", "variable_width": false, "include_underlink": true}, false, false, true, null, false, "full", null, "{\"data\": {\"nodes\": [{\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 0, \"ts_flags\": 1, \"time\": 0.0, \"child_of\": [10], \"parent_of\": [], \"x_pos_reference\": -1, \"label\": \"0\", \"fx\": 207.0, \"fy\": 450.0, \"y\": 450.0}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 1, \"ts_flags\": 1, \"time\": 0.0, \"child_of\": [8], \"parent_of\": [], \"x_pos_reference\": -1, \"label\": \"1\", \"fx\": 264.0, \"fy\": 450.0, \"y\": 450.0}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 2, \"ts_flags\": 1, \"time\": 0.0, \"child_of\": [8], \"parent_of\": [], \"x_pos_reference\": -1, \"label\": \"2\", \"fx\": 321.0, \"fy\": 450.0, \"y\": 450.0}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 3, \"ts_flags\": 1, \"time\": 0.0, \"child_of\": [17], \"parent_of\": [], \"x_pos_reference\": -1, \"label\": \"3\", \"fx\": 150.0, \"fy\": 450.0, \"y\": 450.0}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 4, \"ts_flags\": 1, \"time\": 0.0, \"child_of\": [9], \"parent_of\": [], \"x_pos_reference\": -1, \"label\": \"4\", \"fx\": 493.0, \"fy\": 450.0, \"y\": 450.0}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 5, \"ts_flags\": 1, \"time\": 0.0, \"child_of\": [9], \"parent_of\": [], \"x_pos_reference\": -1, \"label\": \"5\", \"fx\": 550.0, \"fy\": 450.0, \"y\": 450.0}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 6, \"ts_flags\": 1, \"time\": 0.0, \"child_of\": [11], \"parent_of\": [], \"x_pos_reference\": -1, \"label\": \"6\", \"fx\": 379.0, \"fy\": 450.0, \"y\": 450.0}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 7, \"ts_flags\": 1, \"time\": 0.0, \"child_of\": [11], \"parent_of\": [], \"x_pos_reference\": -1, \"label\": \"7\", \"fx\": 436.0, \"fy\": 450.0, \"y\": 450.0}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 8, \"ts_flags\": 0, \"time\": 0.00523931699745691, \"child_of\": [10], \"parent_of\": [1, 2], \"x_pos_reference\": -1, \"label\": \"8\", \"x\": 350.0, \"fy\": 428.94736842105266, \"y\": 428.94736842105266}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 9, \"ts_flags\": 0, \"time\": 0.017557818091816682, \"child_of\": [21], \"parent_of\": [4, 5], \"x_pos_reference\": -1, \"label\": \"9\", \"x\": 350.0, \"fy\": 407.89473684210526, \"y\": 407.89473684210526}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 10, \"ts_flags\": 0, \"time\": 0.09416924140000202, \"child_of\": [12], \"parent_of\": [0, 8], \"x_pos_reference\": -1, \"label\": \"10\", \"x\": 350.0, \"fy\": 386.84210526315786, \"y\": 386.84210526315786}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 11, \"ts_flags\": 0, \"time\": 0.1024650871470267, \"child_of\": [14], \"parent_of\": [6, 7], \"x_pos_reference\": -1, \"label\": \"11\", \"x\": 350.0, \"fy\": 365.7894736842105, \"y\": 365.7894736842105}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 12, \"ts_flags\": 131072, \"time\": 0.11568803951902568, \"child_of\": [14, 17], \"parent_of\": [10], \"x_pos_reference\": 10, \"label\": \"12/13\", \"x\": 350.0, \"fy\": 344.7368421052632, \"y\": 344.7368421052632}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 14, \"ts_flags\": 0, \"time\": 0.12175435946697583, \"child_of\": [15], \"parent_of\": [11, 12], \"x_pos_reference\": -1, \"label\": \"14\", \"x\": 350.0, \"fy\": 323.6842105263158, \"y\": 323.6842105263158}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 15, \"ts_flags\": 131072, \"time\": 0.308460674409082, \"child_of\": [18, 20], \"parent_of\": [14], \"x_pos_reference\": 14, \"label\": \"15/16\", \"x\": 350.0, \"fy\": 302.63157894736844, \"y\": 302.63157894736844}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 17, \"ts_flags\": 0, \"time\": 0.39582244241347575, \"child_of\": [23], \"parent_of\": [3, 12], \"x_pos_reference\": -1, \"label\": \"17\", \"x\": 350.0, \"fy\": 281.57894736842104, \"y\": 281.57894736842104}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 18, \"ts_flags\": 131072, \"time\": 0.6941217594839495, \"child_of\": [20, 24], \"parent_of\": [15], \"x_pos_reference\": -1, \"label\": \"18/19\", \"x\": 350.0, \"fy\": 260.52631578947376, \"y\": 260.52631578947376}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 20, \"ts_flags\": 262144, \"time\": 0.8577976766058426, \"child_of\": [23], \"parent_of\": [15, 18], \"x_pos_reference\": -1, \"label\": \"20\", \"x\": 350.0, \"fy\": 239.47368421052633, \"y\": 239.47368421052633}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 21, \"ts_flags\": 131072, \"time\": 1.0255837873540103, \"child_of\": [27, 28], \"parent_of\": [9], \"x_pos_reference\": 9, \"label\": \"21/22\", \"x\": 350.0, \"fy\": 218.42105263157893, \"y\": 218.42105263157893}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 23, \"ts_flags\": 0, \"time\": 1.0987444051668527, \"child_of\": [24], \"parent_of\": [17, 20], \"x_pos_reference\": -1, \"label\": \"23\", \"x\": 350.0, \"fy\": 197.3684210526316, \"y\": 197.3684210526316}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 24, \"ts_flags\": 0, \"time\": 1.2059022164118993, \"child_of\": [25], \"parent_of\": [18, 23], \"x_pos_reference\": -1, \"label\": \"24\", \"x\": 350.0, \"fy\": 176.31578947368425, \"y\": 176.31578947368425}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 25, \"ts_flags\": 131072, \"time\": 1.5998364961174132, \"child_of\": [27, 31], \"parent_of\": [24], \"x_pos_reference\": 24, \"label\": \"25/26\", \"x\": 350.0, \"fy\": 155.26315789473688, \"y\": 155.26315789473688}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 27, \"ts_flags\": 0, \"time\": 1.721772254949798, \"child_of\": [28], \"parent_of\": [21, 25], \"x_pos_reference\": -1, \"label\": \"27\", \"x\": 350.0, \"fy\": 134.21052631578948, \"y\": 134.21052631578948}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 28, \"ts_flags\": 0, \"time\": 2.0490896096414075, \"child_of\": [29], \"parent_of\": [21, 27], \"x_pos_reference\": -1, \"label\": \"28\", \"x\": 350.0, \"fy\": 113.15789473684212, \"y\": 113.15789473684212}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 29, \"ts_flags\": 131072, \"time\": 2.087239695481809, \"child_of\": [31, 32], \"parent_of\": [28], \"x_pos_reference\": 28, \"label\": \"29/30\", \"x\": 350.0, \"fy\": 92.10526315789478, \"y\": 92.10526315789478}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 31, \"ts_flags\": 0, \"time\": 2.349570553333265, \"child_of\": [32], \"parent_of\": [25, 29], \"x_pos_reference\": -1, \"label\": \"31\", \"x\": 350.0, \"fy\": 71.0526315789474, \"y\": 71.0526315789474}, {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4, \"id\": 32, \"ts_flags\": 0, \"time\": 3.367861146397306, \"child_of\": [], \"parent_of\": [29, 31], \"x_pos_reference\": -1, \"label\": \"32\", \"x\": 350.0, \"fy\": 50.0, \"y\": 50.0}], \"links\": [{\"id\": 0, \"source\": 8, \"source_time\": 0.00523931699745691, \"target\": 1, \"target_time\": 0.0, \"bounds\": \"0.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 2, \"region_fraction\": 1.0, \"stroke\": \"#053e4e\"}, {\"id\": 1, \"source\": 8, \"source_time\": 0.00523931699745691, \"target\": 2, \"target_time\": 0.0, \"bounds\": \"0.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 1, \"region_fraction\": 1.0, \"stroke\": \"#053e4e\"}, {\"id\": 2, \"source\": 9, \"source_time\": 0.017557818091816682, \"target\": 4, \"target_time\": 0.0, \"bounds\": \"0.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 5, \"region_fraction\": 1.0, \"stroke\": \"#053e4e\"}, {\"id\": 3, \"source\": 9, \"source_time\": 0.017557818091816682, \"target\": 5, \"target_time\": 0.0, \"bounds\": \"0.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 4, \"region_fraction\": 1.0, \"stroke\": \"#053e4e\"}, {\"id\": 4, \"source\": 10, \"source_time\": 0.09416924140000202, \"target\": 0, \"target_time\": 0.0, \"bounds\": \"0.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 8, \"region_fraction\": 1.0, \"stroke\": \"#053e4e\"}, {\"id\": 5, \"source\": 10, \"source_time\": 0.09416924140000202, \"target\": 8, \"target_time\": 0.00523931699745691, \"bounds\": \"0.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 0, \"region_fraction\": 1.0, \"stroke\": \"#053e4e\"}, {\"id\": 6, \"source\": 11, \"source_time\": 0.1024650871470267, \"target\": 6, \"target_time\": 0.0, \"bounds\": \"0.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 7, \"region_fraction\": 1.0, \"stroke\": \"#053e4e\"}, {\"id\": 7, \"source\": 11, \"source_time\": 0.1024650871470267, \"target\": 7, \"target_time\": 0.0, \"bounds\": \"0.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 6, \"region_fraction\": 1.0, \"stroke\": \"#053e4e\"}, {\"id\": 8, \"source\": 12, \"source_time\": 0.11568803951902568, \"target\": 10, \"target_time\": 0.09416924140000202, \"bounds\": \"0.0-763.0 763.0-1000.0\", \"alt_parent\": -1, \"alt_child\": -1, \"region_fraction\": 1.0, \"stroke\": \"#053e4e\"}, {\"id\": 9, \"source\": 14, \"source_time\": 0.12175435946697583, \"target\": 11, \"target_time\": 0.1024650871470267, \"bounds\": \"0.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 12, \"region_fraction\": 1.0, \"stroke\": \"#053e4e\"}, {\"id\": 10, \"source\": 14, \"source_time\": 0.12175435946697583, \"target\": 12, \"target_time\": 0.11568803951902568, \"bounds\": \"0.0-763.0\", \"alt_parent\": 17, \"alt_child\": 11, \"region_fraction\": 0.763, \"stroke\": \"#053e4e\"}, {\"id\": 11, \"source\": 15, \"source_time\": 0.308460674409082, \"target\": 14, \"target_time\": 0.12175435946697583, \"bounds\": \"0.0-461.0 461.0-1000.0\", \"alt_parent\": -1, \"alt_child\": -1, \"region_fraction\": 1.0, \"stroke\": \"#053e4e\"}, {\"id\": 12, \"source\": 17, \"source_time\": 0.39582244241347575, \"target\": 3, \"target_time\": 0.0, \"bounds\": \"0.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 12, \"region_fraction\": 1.0, \"stroke\": \"#053e4e\"}, {\"id\": 13, \"source\": 17, \"source_time\": 0.39582244241347575, \"target\": 12, \"target_time\": 0.11568803951902568, \"bounds\": \"763.0-1000.0\", \"alt_parent\": 14, \"alt_child\": 3, \"region_fraction\": 0.237, \"stroke\": \"#053e4e\"}, {\"id\": 14, \"source\": 18, \"source_time\": 0.6941217594839495, \"target\": 15, \"target_time\": 0.308460674409082, \"bounds\": \"461.0-533.0 533.0-1000.0\", \"alt_parent\": 20, \"alt_child\": -1, \"region_fraction\": 0.539, \"stroke\": \"#053e4e\"}, {\"id\": 15, \"source\": 20, \"source_time\": 0.8577976766058426, \"target\": 15, \"target_time\": 0.308460674409082, \"bounds\": \"0.0-461.0\", \"alt_parent\": 18, \"alt_child\": 18, \"region_fraction\": 0.461, \"stroke\": \"#053e4e\"}, {\"id\": 16, \"source\": 20, \"source_time\": 0.8577976766058426, \"target\": 18, \"target_time\": 0.6941217594839495, \"bounds\": \"533.0-1000.0\", \"alt_parent\": 24, \"alt_child\": 15, \"region_fraction\": 0.467, \"stroke\": \"#053e4e\"}, {\"id\": 17, \"source\": 21, \"source_time\": 1.0255837873540103, \"target\": 9, \"target_time\": 0.017557818091816682, \"bounds\": \"0.0-166.0 166.0-1000.0\", \"alt_parent\": -1, \"alt_child\": -1, \"region_fraction\": 1.0, \"stroke\": \"#053e4e\"}, {\"id\": 18, \"source\": 23, \"source_time\": 1.0987444051668527, \"target\": 17, \"target_time\": 0.39582244241347575, \"bounds\": \"0.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 20, \"region_fraction\": 1.0, \"stroke\": \"#053e4e\"}, {\"id\": 19, \"source\": 23, \"source_time\": 1.0987444051668527, \"target\": 20, \"target_time\": 0.8577976766058426, \"bounds\": \"0.0-461.0 533.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 17, \"region_fraction\": 0.928, \"stroke\": \"#053e4e\"}, {\"id\": 20, \"source\": 24, \"source_time\": 1.2059022164118993, \"target\": 18, \"target_time\": 0.6941217594839495, \"bounds\": \"461.0-533.0\", \"alt_parent\": 20, \"alt_child\": 23, \"region_fraction\": 0.072, \"stroke\": \"#053e4e\"}, {\"id\": 21, \"source\": 24, \"source_time\": 1.2059022164118993, \"target\": 23, \"target_time\": 1.0987444051668527, \"bounds\": \"0.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 18, \"region_fraction\": 1.0, \"stroke\": \"#053e4e\"}, {\"id\": 22, \"source\": 25, \"source_time\": 1.5998364961174132, \"target\": 24, \"target_time\": 1.2059022164118993, \"bounds\": \"0.0-726.0 726.0-1000.0\", \"alt_parent\": -1, \"alt_child\": -1, \"region_fraction\": 1.0, \"stroke\": \"#053e4e\"}, {\"id\": 23, \"source\": 27, \"source_time\": 1.721772254949798, \"target\": 21, \"target_time\": 1.0255837873540103, \"bounds\": \"166.0-1000.0\", \"alt_parent\": 28, \"alt_child\": 25, \"region_fraction\": 0.834, \"stroke\": \"#053e4e\"}, {\"id\": 24, \"source\": 27, \"source_time\": 1.721772254949798, \"target\": 25, \"target_time\": 1.5998364961174132, \"bounds\": \"0.0-726.0\", \"alt_parent\": 31, \"alt_child\": 21, \"region_fraction\": 0.726, \"stroke\": \"#053e4e\"}, {\"id\": 25, \"source\": 28, \"source_time\": 2.0490896096414075, \"target\": 21, \"target_time\": 1.0255837873540103, \"bounds\": \"0.0-166.0\", \"alt_parent\": 27, \"alt_child\": 27, \"region_fraction\": 0.166, \"stroke\": \"#053e4e\"}, {\"id\": 26, \"source\": 28, \"source_time\": 2.0490896096414075, \"target\": 27, \"target_time\": 1.721772254949798, \"bounds\": \"0.0-166.0 726.0-1000.0\", \"alt_parent\": -1, \"alt_child\": 21, \"region_fraction\": 0.44, \"stroke\": \"#053e4e\"}, {\"id\": 27, \"source\": 29, \"source_time\": 2.087239695481809, \"target\": 28, \"target_time\": 2.0490896096414075, \"bounds\": \"726.0-804.0 804.0-1000.0\", \"alt_parent\": -1, \"alt_child\": -1, \"region_fraction\": 0.274, \"stroke\": \"#053e4e\"}, {\"id\": 28, \"source\": 31, \"source_time\": 2.349570553333265, \"target\": 25, \"target_time\": 1.5998364961174132, \"bounds\": \"726.0-1000.0\", \"alt_parent\": 27, \"alt_child\": 29, \"region_fraction\": 0.274, \"stroke\": \"#053e4e\"}, {\"id\": 29, \"source\": 31, \"source_time\": 2.349570553333265, \"target\": 29, \"target_time\": 2.087239695481809, \"bounds\": \"804.0-1000.0\", \"alt_parent\": 32, \"alt_child\": 25, \"region_fraction\": 0.196, \"stroke\": \"#053e4e\"}, {\"id\": 30, \"source\": 32, \"source_time\": 3.367861146397306, \"target\": 29, \"target_time\": 2.087239695481809, \"bounds\": \"726.0-804.0\", \"alt_parent\": 31, \"alt_child\": 31, \"region_fraction\": 0.078, \"stroke\": \"#053e4e\"}, {\"id\": 31, \"source\": 32, \"source_time\": 3.367861146397306, \"target\": 31, \"target_time\": 2.349570553333265, \"bounds\": \"726.0-804.0\", \"alt_parent\": -1, \"alt_child\": 29, \"region_fraction\": 0.078, \"stroke\": \"#053e4e\"}], \"mutations\": [], \"breakpoints\": [{\"id\": 0, \"start\": 0.0, \"stop\": 166.0, \"x_pos_01\": 0.0, \"width_01\": 0.166, \"fill\": \"#053e4e\", \"x_pos\": 100.0, \"width\": 83.0, \"included\": \"true\"}, {\"id\": 1, \"start\": 166.0, \"stop\": 461.0, \"x_pos_01\": 0.166, \"width_01\": 0.295, \"fill\": \"#053e4e\", \"x_pos\": 183.0, \"width\": 147.5, \"included\": \"true\"}, {\"id\": 2, \"start\": 461.0, \"stop\": 533.0, \"x_pos_01\": 0.461, \"width_01\": 0.072, \"fill\": \"#053e4e\", \"x_pos\": 330.5, \"width\": 36.0, \"included\": \"true\"}, {\"id\": 3, \"start\": 533.0, \"stop\": 726.0, \"x_pos_01\": 0.533, \"width_01\": 0.193, \"fill\": \"#053e4e\", \"x_pos\": 366.5, \"width\": 96.5, \"included\": \"true\"}, {\"id\": 4, \"start\": 726.0, \"stop\": 763.0, \"x_pos_01\": 0.726, \"width_01\": 0.037, \"fill\": \"#053e4e\", \"x_pos\": 463.0, \"width\": 18.5, \"included\": \"true\"}, {\"id\": 5, \"start\": 763.0, \"stop\": 804.0, \"x_pos_01\": 0.763, \"width_01\": 0.041, \"fill\": \"#053e4e\", \"x_pos\": 481.5, \"width\": 20.5, \"included\": \"true\"}, {\"id\": 6, \"start\": 804.0, \"stop\": 1000.0, \"x_pos_01\": 0.804, \"width_01\": 0.196, \"fill\": \"#053e4e\", \"x_pos\": 502.0, \"width\": 98.0, \"included\": \"true\"}], \"evenly_distributed_positions\": [150.0, 207.0, 264.0, 321.0, 379.0, 436.0, 493.0, 550.0]}, \"width\": 600, \"height\": 575, \"y_axis\": {\"title\": \"Time ago (generations)\", \"units\": \"generations\", \"include_labels\": \"true\", \"ticks\": [450.0, 428.94736842105266, 407.89473684210526, 386.84210526315786, 365.7894736842105, 344.7368421052632, 323.6842105263158, 302.63157894736844, 281.57894736842104, 260.52631578947376, 239.47368421052633, 218.42105263157893, 197.3684210526316, 176.31578947368425, 155.26315789473688, 134.21052631578948, 113.15789473684212, 92.10526315789478, 71.0526315789474, 50.0], \"text\": [0.0, 0.005, 0.018, 0.094, 0.102, 0.116, 0.122, 0.308, 0.396, 0.694, 0.858, 1.026, 1.099, 1.206, 1.6, 1.722, 2.049, 2.087, 2.35, 3.368], \"max_min\": [450.0, 50.0], \"scale\": \"rank\"}, \"edges\": {\"type\": \"ortho\", \"variable_width\": false, \"include_underlink\": true}, \"condense_mutations\": false, \"label_mutations\": false, \"tree_highlighting\": true, \"rotate_tip_labels\": false, \"plot_type\": \"full\", \"default_node_style\": {\"size\": 150, \"symbol\": \"d3.symbolCircle\", \"fill\": \"#1eebb1\", \"stroke\": \"#053e4e\", \"stroke_width\": 4}, \"title\": null, \"preamble\": null, \"save_filename\": \"tskit_arg_visualizer\"}", "tskit_arg_visualizer")
        });
    })
    .catch(err => console.error('Failed to load require.js:', err));

</script></div></div>
</div>
<p>For more general graph plots, it can be helpful convert the tree sequence to a
<a class="reference external" href="https://networkx.org">networkx</a> graph first, as described in the
<a class="reference internal" href="args.html#sec-args-other-analysis"><span class="std std-ref">Other graph analysis</span></a> section of the <a class="reference internal" href="args.html#sec-args"><span class="std std-ref">ARGs as tree sequences</span></a> tutorial.
This provides interfaces to graph plotting software such as
<a class="reference external" href="https://graphviz.org">graphviz</a>, which provides the <code class="docutils literal notranslate"><span class="pre">dot</span></code> layout engine for
directed graphs:</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Networkx conversion code taken from the ARG tutorial</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">networkx</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nx</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tskit</span>

<span class="k">def</span><span class="w"> </span><span class="nf">to_networkx_graph</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">interval_lists</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make an nx graph from a tree sequence. If `intervals_lists` is True, then</span>
<span class="sd">    each graph edge will have an ``intervals`` attribute containing a *list*</span>
<span class="sd">    of tskit.Intervals per parent/child combination. Otherwise each graph edge</span>
<span class="sd">    will correspond to a tskit edge, with a ``left`` and ``right`` attribute.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">D</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">ts</span><span class="o">.</span><span class="n">edges_parent</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">ts</span><span class="o">.</span><span class="n">edges_child</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="n">ts</span><span class="o">.</span><span class="n">edges_left</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">ts</span><span class="o">.</span><span class="n">edges_right</span><span class="p">)</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">from_pandas_edgelist</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">D</span><span class="p">),</span> <span class="n">edge_attr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">create_using</span><span class="o">=</span><span class="n">nx</span><span class="o">.</span><span class="n">MultiDiGraph</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">interval_lists</span><span class="p">:</span>
        <span class="n">GG</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>  <span class="c1"># Mave a new graph with one edge that can contai</span>
        <span class="k">for</span> <span class="n">parent</span><span class="p">,</span> <span class="n">children</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">adjacency</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">child</span><span class="p">,</span> <span class="n">edict</span> <span class="ow">in</span> <span class="n">children</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">ilist</span> <span class="o">=</span> <span class="p">[</span><span class="n">tskit</span><span class="o">.</span><span class="n">Interval</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">edict</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
                <span class="n">GG</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">intervals</span><span class="o">=</span><span class="n">ilist</span><span class="p">)</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">GG</span>
    <span class="n">nx</span><span class="o">.</span><span class="n">set_node_attributes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="p">{</span><span class="n">n</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;flags&#39;</span><span class="p">:</span><span class="n">n</span><span class="o">.</span><span class="n">flags</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">n</span><span class="o">.</span><span class="n">time</span><span class="p">}</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ts</span><span class="o">.</span><span class="n">nodes</span><span class="p">()})</span>
    <span class="k">return</span> <span class="n">G</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">networkx</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">SVG</span>

<span class="k">def</span><span class="w"> </span><span class="nf">graphviz_svg</span><span class="p">(</span><span class="n">networkx_graph</span><span class="p">):</span>
    <span class="n">AG</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">drawing</span><span class="o">.</span><span class="n">nx_agraph</span><span class="o">.</span><span class="n">to_agraph</span><span class="p">(</span><span class="n">networkx_graph</span><span class="p">)</span>  <span class="c1"># Convert to graphviz &quot;agraph&quot;</span>
    <span class="n">nodes_at_time_0</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">networkx_graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">AG</span><span class="o">.</span><span class="n">add_subgraph</span><span class="p">(</span><span class="n">nodes_at_time_0</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)</span>  <span class="c1"># put time=0 at same rank</span>
    <span class="k">return</span> <span class="n">AG</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="s2">&quot;dot&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;svg&quot;</span><span class="p">)</span>

<span class="n">G</span> <span class="o">=</span> <span class="n">to_networkx_graph</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">interval_lists</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Function from the ARG tutorial</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Converted `ts` to a networkx graph named `G`&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Plotting using graphviz...&quot;</span><span class="p">)</span>
<span class="n">SVG</span><span class="p">(</span><span class="n">graphviz_svg</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Converted `ts` to a networkx graph named `G`
Plotting using graphviz...
</pre></div>
</div>
<img alt="_images/acb153e64e86280ae05d28010e7335c69e195a4e63be9344b2bd363c5bcdaace.svg" src="_images/acb153e64e86280ae05d28010e7335c69e195a4e63be9344b2bd363c5bcdaace.svg" />
</div>
</div>
<p>Alternatively, you can read the <code class="docutils literal notranslate"><span class="pre">graphviz</span></code> positions back into <code class="docutils literal notranslate"><span class="pre">networkx</span></code>
and use the <code class="docutils literal notranslate"><span class="pre">networkx</span></code> drawing functionality, which
relies upon the <a class="reference external" href="https://matplotlib.org">matplotlib</a> library. This
allows modification of node colours and symbols, labels, rotations,
annotations, etc., as shown below:</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">string</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_graphviz_positions</span><span class="p">(</span><span class="n">networkx_graph</span><span class="p">):</span>
    <span class="n">AG</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">drawing</span><span class="o">.</span><span class="n">nx_agraph</span><span class="o">.</span><span class="n">to_agraph</span><span class="p">(</span><span class="n">networkx_graph</span><span class="p">)</span>  <span class="c1"># Convert to graphviz &quot;agraph&quot;</span>
    <span class="n">nodes_at_time_0</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">networkx_graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">AG</span><span class="o">.</span><span class="n">add_subgraph</span><span class="p">(</span><span class="n">nodes_at_time_0</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)</span>  <span class="c1"># put time=0 at same rank</span>
    <span class="n">AG</span><span class="o">.</span><span class="n">layout</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="s2">&quot;dot&quot;</span><span class="p">)</span>  <span class="c1"># create the layout, storing positions in the &quot;pos&quot; attribute</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">AG</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">attr</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">()}</span>

<span class="n">pos</span><span class="o">=</span><span class="n">get_graphviz_positions</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">edge_labels</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]:</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">left</span><span class="p">)</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">right</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">edge</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s2">&quot;intervals&quot;</span><span class="p">]])</span>
    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">samples</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">samples</span><span class="p">())</span>
<span class="n">nonsamples</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">))</span> <span class="o">-</span> <span class="n">samples</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="c1"># Sample nodes as dark green squares with white text</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="s2">&quot;#007700&quot;</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">node_shape</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">nodelist</span><span class="o">=</span><span class="n">samples</span><span class="p">,</span> <span class="n">edgelist</span><span class="o">=</span><span class="p">[])</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_labels</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="n">u</span><span class="p">:</span> <span class="n">u</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">},</span> <span class="n">font_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
<span class="c1"># Others as blue circles with alphabetic labels</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="s2">&quot;#22CCFF&quot;</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">nodelist</span><span class="o">=</span><span class="n">nonsamples</span><span class="p">,</span> <span class="n">edgelist</span><span class="o">=</span><span class="p">[])</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_labels</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="n">u</span><span class="p">:</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">nonsamples</span><span class="p">})</span>

<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s2">&quot;lightgrey&quot;</span><span class="p">,</span> <span class="n">arrows</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">);</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edge_labels</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">edge_labels</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">rotate</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/a0a85e2de22c7ba2e8164d975459a3082cd454eb37d81b3ec40be96d16a43a9a.png" src="_images/a0a85e2de22c7ba2e8164d975459a3082cd454eb37d81b3ec40be96d16a43a9a.png" />
</div>
</div>
<p>Note, however, that finding node and edge layout positions that avoid too much overlap
can be tricky, even for the graphviz layout engine, and there is no easy functionality
to place nodes at specific vertical (time) positions.</p>
</section>
<section id="demographic-processes">
<span id="sec-tskit-viz-other-demographic"></span><h3>Demographic processes<a class="headerlink" href="#demographic-processes" title="Link to this heading">#</a></h3>
<p>If you are generating a tree sequence via a <a class="reference external" href="https://tskit.dev/msprime/docs/stable/demography.html#sec-demography-importing" title="(in Project name not set)"><span class="xref std std-ref">Demes</span></a>
model, then you can visualize a schematic of the demography itself (rather than the
resulting tree sequence) using the <a class="reference external" href="https://grahamgower.github.io/demesdraw/">DemesDraw</a>
software. For example, here’s the plotting code to generate the
<a class="reference internal" href="what_is.html#sec-what-is-ancestry"><span class="std std-ref">demography plot</span></a> from the “<a class="reference internal" href="what_is.html#sec-what-is"><span class="std std-ref">What is a tree sequence?</span></a>” tutorial:</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib_inline</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">matplotlib_inline</span><span class="o">.</span><span class="n">backend_inline</span><span class="o">.</span><span class="n">set_matplotlib_formats</span><span class="p">(</span><span class="s1">&#39;svg&#39;</span><span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">demes</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">demesdraw</span>

<span class="k">def</span><span class="w"> </span><span class="nf">size_max</span><span class="p">(</span><span class="n">graph</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span>
        <span class="nb">max</span><span class="p">(</span><span class="n">epoch</span><span class="o">.</span><span class="n">start_size</span><span class="p">,</span> <span class="n">epoch</span><span class="o">.</span><span class="n">end_size</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">deme</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">demes</span>
        <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="n">deme</span><span class="o">.</span><span class="n">epochs</span>
    <span class="p">)</span>

<span class="c1"># See https://popsim-consortium.github.io/demes-docs/ for the yml spec for the file below</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">demes</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;data/whatis_example.yml&quot;</span><span class="p">)</span>
<span class="n">w</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">size_max</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
<span class="n">positions</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Ancestral_population</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">A</span><span class="o">=-</span><span class="n">w</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">demesdraw</span><span class="o">.</span><span class="n">tubes</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="n">positions</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/7aa834fe6112b51ddaae417e36a15589aee4a378bc38de1ab7be1cd45d06c305.svg" src="_images/7aa834fe6112b51ddaae417e36a15589aee4a378bc38de1ab7be1cd45d06c305.svg" />
</div>
</div>
</section>
<section id="geography">
<h3>Geography<a class="headerlink" href="#geography" title="Link to this heading">#</a></h3>
<div class="admonition-todo admonition" id="id3">
<p class="admonition-title">Todo</p>
<p>How to get lat/long information out of a tree sequence and plot ancestors (or a tree)
on a geographical landscape.</p>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="simplification.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><em>Simplification</em></p>
      </div>
    </a>
    <a class="right-next"
       href="metadata.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Working with Metadata</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#text-format">Text format</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#svg-format">SVG format</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#axes-and-scales">Axes and scales</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#larger-tree-sequences">Larger tree sequences</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-mutations">Plotting mutations</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#which-mutations-are-shown">Which mutations are shown?</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#labelling">Labelling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#styling">Styling</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#available-css-classes">Available css classes</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#within-the-plotting-area">Within the plotting area</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#outside-the-plotting-area">Outside the plotting area</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id-based-classes">ID-based classes</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#css-selector-quick-reference">CSS selector quick reference</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#styling-graphical-elements">Styling graphical elements</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-effects">Dynamic effects</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#transforming-and-masking-elements">Transforming and masking elements</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#styling-and-svg-structure">Styling and SVG structure</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#styling-subtrees">Styling subtrees</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#restricting-styling">Restricting styling</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#more-about-styling">More about styling</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#converting-and-editing-svg">Converting and editing SVG</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#converting">Converting</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#editing-the-svg">Editing the SVG</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#examples">Examples</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#text-examples">Text examples</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#tree-orientation">Tree orientation</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#svg-examples">SVG examples</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#a-standard-ts-plot">A standard ts plot</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#highlighted-mutations">Highlighted mutations</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#leaf-sample-isolated-nodes">Leaf, sample &amp; isolated nodes</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#a-fancy-formatted-plot">A fancy formatted plot</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ticks-labels-and-gridlines">Ticks, labels, and gridlines</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#simplifying-larger-plots">Simplifying larger plots</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#d-effects">3D effects</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#animation">Animation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#other-visualizations">Other visualizations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#graph-representations">Graph representations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#demographic-processes">Demographic processes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#geography">Geography</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Tskit Developers
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>